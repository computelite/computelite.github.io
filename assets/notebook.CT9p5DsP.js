import"./pixel.CyAMObzi.js";/* empty css              */import{e as executeQuery,y as executePython,b as get_cl_element,G as consoleNotebookOutput,H as drawImageFromPython,v as fetchSchema,c as confirmBox$1,w as fetchData,x as addDefaultModel}from"./scc.C0KxU-5h.js";import{C as CodeMirror}from"./codemirror.i0qkzkfX.js";import"./python.CZbrtjhd.js";import{n as nanoid}from"./index.browser.B1VcazSC.js";import"https://webr.r-wasm.org/latest/webr.mjs";const isPyProxy=t=>{var l;return!!t&&((l=t.$$)==null?void 0:l.type)==="PyProxy"};function createCodeMirrorEditor(t,l,i,u,n){const a=document.getElementById(t);var o=CodeMirror(a.querySelector("div.computelite-text-editor"),{lineNumbers:!0,lineWrapping:!0,mode:"python",autoRefresh:!0,autofocus:!0,tabSize:4,indentUnit:4,smartIndent:!0,matchBrackets:!0,autoCloseBrackets:!0,extraKeys:{"Ctrl-/":"toggleComment","Ctrl-Enter":async s=>executeCode(o,a,l,i,t,n),"Shift-Enter":async s=>runAndMoveToNextCell(o,a,l,i,t,n)}});return o.addKeyMap({Backspace:function(s){const c=s.getCursor(),d=s.getLine(c.line),r=s.getOption("indentUnit"),m=d.slice(0,c.ch);if(/^\s*$/.test(m)&&c.ch>0){const y=Math.max(0,c.ch-r);s.setCursor({line:c.line,ch:y})}else s.execCommand("delCharBefore")}}),a.querySelector("button.cell-controls-button").onclick=function(){executeCode(o,a,l,i,t)},setTimeout(()=>{o.refresh(),u&&o.setValue(u)},10),o}async function runAndMoveToNextCell(t,l,i,u,n,a){var c;await executeCode(t,l,i,u,n,a);const o=document.querySelectorAll("computelite-cell");if(o[o.length-1]===l){const d=document.getElementById("jsListDiv").querySelector("li.selectedValue"),r=d.getAttribute("id");if(!i){confirmBox("Alert!","Model Name not found in the URL.");return}try{const m=await executeQuery("insertData",i,"INSERT INTO S_NotebookContent (CellContent, Name, NotebookId, CellType) VALUES (?, ?, ?, ?)",["",d.innerText,r,"python"]),y=createCodeEditor(m,r);setTimeout(()=>{var h;const p=document.querySelectorAll(".computelite-cell .CodeMirror"),f=p[p.length-1];(h=f==null?void 0:f.CodeMirror)==null||h.focus()},50)}catch(m){console.error("Failed to add new cell:",m)}}else for(let d=0;d<o.length-1;d++)if(o[d]===l){const r=o[d+1].querySelector(".CodeMirror");(c=r==null?void 0:r.CodeMirror)==null||c.focus();break}}async function executeCode(editor,cell,modelName,CellId,kernelId,notebookId){editor.getInputField().blur();const query=editor.getValue();cell.querySelector(".cell-bottom").innerHTML="",cell.querySelector(".sidebar-inner")&&(cell.querySelector(".sidebar-inner").innerHTML="");const btn=cell.querySelector("span.fa-regular");btn!=null&&btn.classList.contains("fa-play-circle")&&btn.classList.replace("fa-play-circle","fa-hourglass");const updateQuery="UPDATE S_NotebookContent SET CellContent = ? WHERE CellId = ? AND CellType = ? AND NotebookId = ?";await executeQuery("updateData",modelName,updateQuery,[query,CellId,"python",notebookId]);let res=await executePython("execute","notebook",query,"Default",modelName,[],null,[],[],kernelId);btn!=null&&btn.classList.contains("fa-hourglass")&&btn.classList.replace("fa-hourglass","fa-play-circle");const htmlOutput=get_cl_element("div");if(cell.querySelector(".cell-bottom").appendChild(htmlOutput),res.result!==void 0){let val=await convertResult(res.result.display,res.result.value);if(val!==void 0)if(val instanceof HTMLElement)htmlOutput.appendChild(val),val.querySelectorAll('script[type|="text/javascript"]').forEach(function(e){e.textContent!==null&&eval(e.textContent)});else if(isPyProxy(val)){let hadHTMLOutput=!1;if(val._repr_html_!==void 0){let result=val._repr_html_();if(typeof result=="string"){let div=get_cl_element("div","rendered_html cell-output-html");div.appendChild(new DOMParser().parseFromString(result,"text/html").body.firstChild),htmlOutput.appendChild(div),div.querySelectorAll('script[type|="text/javascript"]').forEach(function(e){e.textContent!==null&&eval(e.textContent)}),hadHTMLOutput=!0}}hadHTMLOutput||consoleNotebookOutput(cell,[val])}else val instanceof Uint8Array?drawImageFromPython(val):consoleNotebookOutput(cell,[res.result.value])}else res.stderr!=null&&consoleNotebookOutput(cell,[res.stderr],"error")}async function convertResult(t,l){if(t==="html"){let i=get_cl_element("div","rendered_html cell-output-html");return i.appendChild(new DOMParser().parseFromString(l,"text/html").body.firstChild),i}return l}let schema={};const params=new URLSearchParams(window.location.search);let modelName=params.get("modelName");const container=document.getElementById("cellContainer");window.onload=async function(){schema=await fetchSchema();let t=await executeQuery("init");if(!t||t.msg!="Success"){confirmBox$1("Alert!","Some error occured while initializing sqlite.");return}else if(!modelName)if((await fetchData("home","getUserModels")).some(r=>r[0]==="Default_DB"))modelName="Default_DB";else{let r=await addDefaultModel(schema);if(r.length>0)modelName=r[0];else{confirmBox$1("Alert!","Model Name not found in the URL.");return}}await fetchNotebookName();let l=document.getElementById("jsListDiv").querySelector("li.selectedValue");await populateCells(l.innerText);const u=await executeQuery("fetchData",modelName,"SELECT FilePath,FileData FROM S_ExecutionFiles WHERE Filename is NOT NULL AND Status = 'Active' "),a=await executeQuery("fetchData",modelName,"SELECT FileName,FileBlob FROM S_DataFiles WHERE FileType = 'Input'"),s=await executeQuery("fetchData",modelName,"SELECT WheelName,WheelBlob FROM S_PackageWheels");document.getElementById("loadingOverlay").classList.remove("hidden"),await executePython("init","notebook","","Default",modelName,u,"",a,s),document.getElementById("loadingOverlay").classList.add("hidden")};async function populateCells(t){try{(await executeQuery("fetchData",modelName,"SELECT CellId,CellContent,NotebookId FROM S_NotebookContent WHERE Name = ? AND CellType = ?",[t,"python"])).forEach(([u,n,a])=>createCodeEditor(u,a,n))}catch(l){console.error("Error populating cells:",l)}}function createCodeEditor(t,l,i=""){const u=nanoid(),n=get_cl_element("computelite-cell","cell-grid cell-container celltype-python",u);n.setAttribute("tabindex","0");const a=get_cl_element("div","cell-controls cell-controls-left cell-controls-left-top"),o=get_cl_element("button","btn cell-controls-button py-1");o.title="Run Cell";const s=get_cl_element("span","fa-regular fa-play-circle");s.style.fontSize="16px",o.appendChild(s),a.appendChild(o);const c=get_cl_element("div","cell-top flush");let d=get_cl_element("div");d.style="position: relative;width: 100%;height: 0;";const r=get_cl_element("div","computelite-text-editor-controls",null,get_cl_element("div"));r.firstChild.appendChild(get_cl_element("button","btn btn-small transparent p-1 px-1 me-1",null,get_cl_element("span","fa-solid fa-trash-alt"))),r.querySelector("button").title="Delete Cell",r.querySelector("span").style="color: #00000066;",r.querySelector("button").onclick=async function(){await executeQuery("deleteData",modelName,"DELETE FROM S_NotebookContent WHERE CellId = ? AND CellType = ? AND NotebookId = ?",[t,"python",l])&&n.remove()};const m=get_cl_element("computelite-text-editor"),y=get_cl_element("div","computelite-text-editor");d.appendChild(r),m.appendChild(d),m.appendChild(y),c.appendChild(m),n.appendChild(a),n.appendChild(c);const p=get_cl_element("div","cell-bottom");n.appendChild(p),container.appendChild(n),createCodeMirrorEditor(u,modelName,t,i,l)}document.getElementById("addCell").onclick=async function(){let t=document.getElementById("jsListDiv").querySelector("li.selectedValue"),l=t.getAttribute("id");if(!modelName){confirmBox$1("Alert!","Model Name not found in the URL.");return}try{const u=await executeQuery("insertData",modelName,"INSERT INTO S_NotebookContent (CellContent, Name, NotebookId, CellType) VALUES (?, ?, ?, ?)",["",t.innerText,l,"python"]);createCodeEditor(u,l)}catch(i){console.error("Error adding cell:",i)}};async function fetchNotebookName(){try{let t=document.getElementById("jsListDiv"),i=await executeQuery("fetchData",modelName,"SELECT Name, NotebookId FROM S_Notebooks WHERE Status = 'Active' AND Type = 'Python'"),u=new Set;if(i.length>0){for(let n of i)if(n[0]&&!u.has(n[0])){u.add(n[0]);let a=get_cl_element("li","py-0 ps-1",n[1],null),o=get_cl_element("label","checkBox-label",null,get_cl_element("span","fas fa-file-alt"),null);o.appendChild(document.createTextNode(n[0])),a.appendChild(o),t.appendChild(a),a.onclick=async function(s){for(let c of document.getElementById("jsListDiv").querySelectorAll("li.selectedValue"))c.classList.remove("selectedValue");this.classList.add("selectedValue"),container.innerHTML="",await populateCells(this.innerText)}}t.firstElementChild.classList.add("selectedValue")}else{let a=await executeQuery("insertData",modelName,"INSERT INTO S_Notebooks (Name,Type,Status) VALUES (?, ?, ?) RETURNING NotebookId",["Default","Python","Active"]);await executeQuery("insertData",modelName,"INSERT INTO S_NotebookContent (Name,CellContent,CellType,NotebookId) VALUES (?, ?, ?, ?)",["Default","","python",a]);let s=get_cl_element("li","py-0 ps-1",a,null),c=get_cl_element("label","checkBox-label",null,get_cl_element("span","fas fa-file-alt"),null);c.appendChild(document.createTextNode("Default")),s.appendChild(c),t.appendChild(s),s.classList.add("selectedValue"),container.innerHTML="",s.onclick=async function(d){for(let r of t.querySelectorAll("li.selectedValue"))r.classList.remove("selectedValue");this.classList.add("selectedValue"),container.innerHTML="",await populateCells(this.innerText)}}}catch(t){confirmBox$1("Alert!",`Error during execution:, ${t}`),console.error("Error during execution:",t);return}}document.getElementById("addNotebook").onclick=async function(){document.getElementById("inputDiv").classList.remove("d-none"),document.getElementById("notebookName").focus()};document.getElementById("notebookName").onkeydown=async function(t){try{if(t.key==="Enter"){t.preventDefault();const l=t.target.value.trim();if(l===""){confirmBox$1("Alert!","Please enter Notebook Name.");return}if(!/^[^\s]+$/.test(l)){confirmBox$1("Alert!","Please enter a valid Notebook Name.");return}if((await executeQuery("fetchData",modelName,"SELECT name FROM S_Notebooks WHERE name = ? AND Type = 'Python'",[l])).length>0){confirmBox$1("Alert!","Notebook Name Already Exists");return}let o=await executeQuery("insertData",modelName,"INSERT INTO S_Notebooks (Name,Type,Status) VALUES (?, ?, ?) RETURNING NotebookId",[l,"Python","Active"]);await executeQuery("insertData",modelName,"INSERT INTO S_NotebookContent (CellContent, Name, NotebookId, CellType) VALUES (?, ?, ?, ?)",["",l,o,"python"]),document.getElementById("inputDiv").classList.add("d-none");let c=document.getElementById("jsListDiv"),d=get_cl_element("li","py-0 ps-1",o,null),r=get_cl_element("label","checkBox-label",null,get_cl_element("span","fas fa-file-alt"),null);r.appendChild(document.createTextNode(l)),d.appendChild(r),c.appendChild(d);for(let m of c.querySelectorAll("li.selectedValue"))m.classList.remove("selectedValue");d.classList.add("selectedValue"),container.innerHTML="",await populateCells(l),t.target.value="",d.onclick=async function(m){for(let y of c.querySelectorAll("li.selectedValue"))y.classList.remove("selectedValue");this.classList.add("selectedValue"),container.innerHTML="",await populateCells(this.innerText)}}}catch(l){console.error("Error adding notebook:",l)}};document.getElementById("deleteNotebook").onclick=function(){let t=document.getElementById("jsListDiv").querySelector("li.selectedValue");t?confirmBox$1("",`Are You Sure Want to Delete ${t.innerText}`,deleteNoteBookLi.bind(null,t),1):confirmBox$1("Alert!","No Notebook Selected to delete")};async function deleteNoteBookLi(t){let l=t.getAttribute("id");await executeQuery("deleteData",modelName,"DELETE FROM S_Notebooks WHERE NotebookId = ? AND Type = 'Python'",[l]);const n=await executeQuery("deleteData",modelName,"DELETE FROM S_NotebookContent WHERE NotebookId = ? AND CellType = 'python'",[l]);for(let o of document.querySelectorAll("computelite-cell"))n&&o.remove();document.getElementById("jsListDiv").innerHTML="",await fetchNotebookName();let a=document.getElementById("jsListDiv").querySelector("li.selectedValue");await populateCells(a.innerText)}document.getElementById("toggleSidebar").onclick=function(){document.getElementById("sidebarMenu").classList.toggle("contracted"),container.classList.toggle("cell-position"),document.getElementById("inputDiv").classList.add("d-none")};
