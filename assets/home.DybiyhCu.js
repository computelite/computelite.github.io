import"./pixel.CTdmvz-a.js";import{e as y,c as m,w as j,x as _,b as n,z as G,A as Y,u as Z,d as J}from"./scc.Dvg64kKt.js";import{M as f}from"./bootstrap.esm.CkDf0L-y.js";const g=document.getElementById("scc-one-modal");let S={},A=null,D=null;const P={"Sample DB":"fas fa-database","Supply Planning":"fas fa-database"};function K(t,l){let a=t.replace(/\s/g,"_"),o=n("div","accordion-item border-light mb-0",null,n("h2","accordion-header",a+"_head",n("button","accordion-button collapsed",null,n("span","h6 mb-0 font-weight-bold",null,document.createTextNode(t)))));o.querySelector("button").setAttribute("type","button"),o.querySelector("button").setAttribute("data-bs-toggle","collapse"),o.querySelector("button").setAttribute("aria-expanded","false"),o.querySelector("button").setAttribute("data-bs-target","#"+a),o.querySelector("button").setAttribute("aria-controls",a);let d=n("div","accordion-collapse collapse",a,n("div","accordion-body",null,n("table","table table-hover",null,n("tbody",null,null,null))));d.setAttribute("aria-labelledby",a+"_head"),d.setAttribute("data-bs-parent","#tableGroup");for(let e of l){let i=n("tr",null,null,n("td",null,null,document.createTextNode(e[1])));i.onclick=function(){const c=document.getElementById("availableModal").querySelector("li.selectedValue");window.open(`/tableDisplay.html?tableName=${e[0]}&modelName=${c.innerText}`)},i.setAttribute("tableName",e[0]),d.querySelector("tbody").appendChild(i)}return o.appendChild(d),o}document.addEventListener("DOMContentLoaded",async function(){let t=await y("init");if(!t||t.msg!="Success"){m("Alert!","Some error occured while initializing sqlite.");return}const l=document.getElementById("shareBtn");l.classList.add("blink"),document.querySelectorAll(".modal").forEach(o=>{f.getInstance(o)||new f(o)}),X(),document.getElementById("modal-createView").addEventListener("hide.bs.modal",function(){document.getElementById("viewName").value="",document.getElementById("query-input").value=""}),document.getElementById("editorBtn").onclick=async function(){const o=document.getElementById("availableModal").querySelector("li.selectedValue").innerText;if(!o){m("Alert!","Please select a model");return}window.open(`/sqlEditor.html?tableName=V_TEMPV&modelName=${o}`)},document.getElementById("availInpFiles").onclick=function(){document.getElementById("modal-input-files").querySelector("h2").innerText="Input Files",q()},document.getElementById("availOutFiles").onclick=function(){document.getElementById("modal-input-files").querySelector("h2").innerText="Output Files",ye()},document.getElementById("shareBtn").onclick=function(){const o=document.getElementById("availableModal").querySelector("li.selectedValue");if(!o){m("Alert!","Please select a model");return}const d=o.innerText,e=o.getAttribute("project");window.open(`/editorPage.html?projectName=${e}&modelName=${d}`)},document.getElementById("closeOutput").onclick=function(){document.getElementById("outputDiv").style.display="none"},document.getElementById("ok-view").onclick=re,document.getElementById("deleteModel").onclick=R.bind(null,!0),document.getElementById("removeModel").onclick=R.bind(null,!1),document.getElementById("addNew").onclick=te.bind(null,"Add New Model",!1),document.getElementById("downloadAllFiles").onclick=be,document.getElementById("addExisting").onclick=le,document.getElementById("saveAs").onclick=ne,document.getElementById("uploadModel").onclick=oe,document.getElementById("downloadModel").onclick=ae,document.getElementById("uploadExcel").onclick=de,document.getElementById("downloadExcel").onclick=ce,document.getElementById("vacuum").onclick=se,document.getElementById("saveFiles").onclick=fe,document.getElementById("uploadPackage").onclick=ge,document.getElementById("downloadOutput").onclick=_e,await j("init"),l.classList.remove("blink")});async function X(){document.getElementById("tableGroup").innerHTML="";let t=await _("home","getUserModels");t.length==0&&(await _("home","addNewModel",{model_name:"Default_DB",model_template:"Sample DB",project_name:"Default",db_user:"",password:"",host:"",port:0,db_type:"SQLITE"})).msg==="Success"&&t.push(["Default_DB","Sample DB","Default","SQLITE"]),ee(t)}function ee(t){let l=document.getElementById("availableModal");l.innerHTML="";for(let a of t)l.appendChild(M(a));l.firstChild&&l.firstChild.click()}function M(t){let l=n("li","nav-item mb-0",null,null),a=n("a","nav-link p-2 rounded-0");return a.appendChild(n("span","d-block text-left",null,null)),a.firstChild.appendChild(n("span",`${P[t[1]]} pe-2`)),a.firstChild.appendChild(document.createTextNode(t[0])),l.appendChild(a),l.setAttribute("project",t[2]),l.setAttribute("template",t[1]),l.setAttribute("dbtype",t[3]),l.onclick=async function(o){if(l.getAttribute("project"),document.getElementById("outputTxt").innerHTML="",!this.classList.contains("selectedValue")){for(let d of this.parentNode.querySelectorAll("li.selectedValue"))d.classList.remove("selectedValue");N(this.innerText,t[1]),this.classList.add("selectedValue"),o.preventDefault()}await me(this.innerText)},l}async function N(t,l){document.getElementById("tableGroup").innerHTML="";const a=await _("home","fetchTableGroups",{model_name:t});for(let o in a)document.getElementById("tableGroup").appendChild(K(o,a[o]))}function V(t,l="fa-server",a=null){let o=n("ul","tree");for(let d in t){o.appendChild(document.createElement("li"));let e=U(d,l);o.appendChild(e),e.onclick=function(){let i=e.nextElementSibling;if(e.firstChild.checked){e.firstChild.checked=!1;for(let c of i.childNodes)c.firstChild.checked&&(c.firstChild.checked=!1)}else{e.firstChild.checked=!0;for(let c of i.childNodes)c.firstChild.checked||(c.firstChild.checked=!0)}},o.appendChild(n("ul","childList TreeMembers"));for(let i of t[d]){let c=U(i[0],P[i[1]]);a||(c.onclick=function(s){if(c.firstChild.checked)c.firstChild.checked=!1,e.firstChild.checked&&(e.firstChild.checked=!1);else{c.firstChild.checked=!0,e.firstChild.checked=!0;for(let r of this.parentNode.childNodes)r.firstChild.checked||(e.firstChild.checked=!1)}}),o.lastChild.appendChild(c)}}return n("div","card-body scc-box",null,o)}function U(t,l){let a=n("li",null,null,n("input","inputcheckbox"));a.firstChild.setAttribute("type","checkbox");let o=n("label","checkBox-label",null,n("span",`fas ${l}`));return o.appendChild(document.createTextNode(t)),a.appendChild(o),a}function E(t,l){const a=g.querySelector(".modal-header h2");a.innerHTML="",a.innerText=t;const o=g.querySelector(".modal-body");o.innerHTML="";const d=g.querySelector(".modal-footer");d.innerHTML="";const e=n("button","btn btn-tertiary",null,document.createTextNode("Cancel"));e.setAttribute("type","button"),e.setAttribute("data-bs-dismiss","modal");const i=n("button","btn btn-primary ml-auto",null,document.createTextNode(l));return i.setAttribute("type","button"),d.appendChild(e),d.appendChild(i),[o,i]}function B(t,l,a,o,d=[],e="",i="",c="text"){let s;const r=n("div","row row-header align-items-center mb-4",t);let u=n("div","col-12 col-sm-4 align-self-center",null,n("label","my-2",null,document.createTextNode(l)));if(s=n("div","col-12 col-sm"),o=="select"){const p=n("select","form-select",a);(d.includes("Default")||d.length==0)&&p.appendChild(n("option",null,null,document.createTextNode("Default")));for(let h of d)if(h!="Default"){let b=n("option",null,null,document.createTextNode(h));p.appendChild(b)}p.firstChild&&(p.firstChild.setAttribute("selected",""),s.appendChild(p))}else{const p=n("div","input-group",null,n("input","form-control",a));p.firstChild.setAttribute("type",c),p.firstChild.setAttribute("placeholder",e),i.trim()!=""&&p.appendChild(n("span","input-group-text",null,n("span",i))),s.appendChild(p)}return r.appendChild(u),r.appendChild(s),r}function te(t,l=!1){const[a,o]=E(t,"Add"),d=n("div","form-group");d.appendChild(B("name_div","Model Name","db_name","normal",[],"","fas fa-database")),l?d.appendChild(B("path_div","Model Path","db_path","normal")):d.appendChild(B("template_div","Model Template","model_template","select",["Sample DB"])),a.appendChild(d),o.onclick=async function(e){const i=document.getElementById("db_name").value;if(i.trim()==""||!Q(i)){m("Alert!","Please enter valid model name");return}for(let b of document.getElementById("availableModal").querySelectorAll("li"))if(i.trim()==b.innerText){m("Alert!",`Model already active with same name ${i}`);return}let c=document.getElementById("model_template"),s="Sample DB";c&&(s=c.value);let r="Default";f.getInstance(g).hide();const h=await _("home","addNewModel",{model_name:i,model_template:s,project_name:r,db_user:"",password:"",host:"",port:0,db_type:"SQLITE"});if(h.msg==="Success"){let b=document.getElementById("availableModal");b.appendChild(M([i,s,r,"SQLITE"])),b.lastChild.click(),m("Success!","New Model added")}else m("Alert!",h.msg)}}async function le(){const[t,l]=E("Add Existing Models","Add"),a=new Object,o=await _("home","getExistingModels");let d=new Object;for(let e of o){let i=e[1],c=e[0];a[c]=[i,e[2],e[3]],i in d?d[i].push([c,e[2]]):d[i]=[[c,e[2]]]}t.appendChild(V(d)),l.onclick=async function(){let e=[];for(let s of document.getElementById("availableModal").querySelectorAll("li"))e.push(s.innerText);let i={},c=[];for(let s of t.querySelectorAll(".TreeMembers li"))if(s.parentNode.classList.contains("childList")&&s.firstChild.checked){if(e.includes(s.innerText)){m("Alert!",`Model Already Active with name ${s.innerText}`);return}let r=s.parentNode.previousElementSibling.innerText;if(r in i||(i[r]=[]),i[r].push(s.innerText),c.includes(s.innerText)){m("Alert!","You Cannot Add more than one model of same name");return}c.push(s.innerText)}if(Object.keys(i).length>0){f.getInstance(g).hide(),await _("home","addExistingModels",{model_list:c,projects_dict:i});let r=document.getElementById("availableModal");for(let u of c)r.appendChild(M([u,a[u][1],a[u][0],a[u][2]]))}else f.getInstance(g).hide()}}function R(t){let l="Hide",a="Hide Models";t&&(l="Delete",a="Delete Models");const[o,d]=E(a,l);let e=new Object;for(let i of document.getElementById("availableModal").childNodes){let c=i.getAttribute("project"),s=i.getAttribute("template"),r=i.innerText;c in e?e[c].push([r,s]):e[c]=[[r,s]]}o.appendChild(V(e)),d.onclick=async function(){let i=[],c={};for(let s of o.querySelectorAll(".TreeMembers li"))if(s.parentNode.classList.contains("childList")&&s.firstChild.checked){i.push(s.innerText);let r=s.parentNode.previousElementSibling.innerText;r in c||(c[r]=[]),c[r].push(s.innerText)}if(Object.keys(c).length>0){f.getInstance(g).hide(),await _("home","deleteModel",{projects_dict:c,del_opt:t});let r=document.getElementById("availableModal");for(let u of r.querySelectorAll("li"))i.indexOf(u.innerText)>-1&&u.remove();r.firstChild?r.firstChild.click():document.getElementById("tableGroup").innerHTML="",m("Success!","Model removed successfully")}else m("Alert!","Please select atleast one model")}}function ne(t){const l=document.getElementById("availableModal").querySelector("li.selectedValue");if(!l){m("Alert!","Please select a model");return}if(l.getAttribute("dbtype")!="SQLITE"){m("Alert!","Method is applicable only for SQLITE type models");return}else{const a=l.innerText,o=l.getAttribute("project"),d=l.getAttribute("template"),e=l.getAttribute("dbtype"),[i,c]=E("Save As","Save"),s=n("div","form-group mb-4");s.appendChild(B("new_modelName_div","New Model Name","new_model_name","normal",[],"","fas fa-database")),i.appendChild(s),c.onclick=async function(r){const u=document.getElementById("new_model_name").value;if(u.trim()==""||!Q(u)){m("Alert!","Please enter valid model name");return}for(let x of document.getElementById("availableModal").querySelectorAll("li"))if(u.trim()==x.innerText){m("Alert!",`Model already active with same name ${u}`);return}f.getInstance(g).hide();const h=await _("home","saveAsModel",{new_model_name:u,new_model_template:d,project_name:o,model_name:a});if(h.message.indexOf("Invalid")>-1){m("Alert",h.message);return}let b=document.getElementById("availableModal");b.appendChild(M([u,d,o,e])),b.lastChild.click(),m("Success!","Save As Model added")}}}function oe(t){const l=document.getElementById("availableModal").querySelector("li.selectedValue");if(!l){m("Alert!","Please select a model");return}const a=l.innerText;l.getAttribute("template");const[o,d]=E("Restore Model","Upload"),e=n("input","form-control"),i=n("div","input-group",null,e);e.setAttribute("type","file"),e.setAttribute("accept",".db, .sqlite3"),o.appendChild(i),d.onclick=async function(c){e.files[0]?(d.setAttribute("disabled",""),d.innerHTML='<span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>',await G("home","uploadModel",e.files[0],{model_name:a}),e.value=null,d.removeAttribute("disabled",""),d.innerHTML="Upload",f.getInstance(g).hide(),m("Success!","Model uploaded successfully"),N(a)):m("Alert!","Please choose a model")}}async function ae(t){let l=document.getElementById("data-loader");const a=document.getElementById("availableModal").querySelector("li.selectedValue");if(!a){m("Alert!","Please select a model");return}const o=a.innerText,d=a.getAttribute("project");l.style.display="",await _("home","downloadModel",{model_name:o,project_name:d}),l.style.display="none"}function de(t){const l=document.getElementById("availableModal").querySelector("li.selectedValue");if(!l){m("Alert!","Please select a model");return}const a=l.innerText,[o,d]=E("Upload Excel","Upload"),e=n("input","form-control"),i=n("div","input-group",null,e);e.setAttribute("type","file"),e.setAttribute("accept","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),o.appendChild(i),d.onclick=async function(c){A=e.files[0],A?(d.setAttribute("disabled",""),d.innerHTML='<span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>',S={},S=await Y(a,[],A),f.getInstance(document.getElementById("scc-one-modal")).hide(),new f(document.getElementById("modal-uploadExcel-info")).show(),e.value=null,d.innerHTML="Upload",d.removeAttribute("disabled","")):m("Alert!","Please choose a file")}}document.getElementById("modal-uploadExcel-info").addEventListener("show.bs.modal",function(){const t=this.querySelector(".modal-body");t.innerHTML="";const l=n("tr"),a=n("div","form-group",null,n("table","table table-bordered table-sm",null,n("thead",null,null,l)));a.style.maxHeight="300px",a.style.overflowY="auto",l.appendChild(n("td","text-center",null,n("h6","m-0",null,document.createTextNode("Sheet Name")))),l.appendChild(n("td","text-center",null,n("h6","m-0",null,document.createTextNode("Upload Option"))));const o=n("tbody");a.firstChild.appendChild(o),t.appendChild(a);for(let d in S){let e=n("tr","");e.appendChild(n("td",null,null,document.createTextNode(d)));const i=n("select","form-select");i.style="line-height:1 !important;";const c=[{value:"purgeAndUpload",text:"Purge and Upload"},{value:"createAndUpload",text:"Drop Table and Upload"},{value:"ignore",text:"Ignore"}],s=[{value:"ignore",text:"Ignore"},{value:"createAndUpload",text:"Create and Upload"}];S[d][0]==="New"?s.forEach(u=>{const p=n("option");p.value=u.value,p.textContent=u.text,i.appendChild(p)}):c.forEach(u=>{const p=document.createElement("option");p.value=u.value,p.textContent=u.text,u.value=="ignore"&&S[d][1]!="Input"&&p.setAttribute("Selected",""),i.appendChild(p)});let r=n("td","text-center",null,i);e.appendChild(r),o.appendChild(e)}});document.getElementById("saveFileName").onclick=async function(){this.setAttribute("disabled",""),this.innerHTML='<span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>';const t=document.getElementById("availableModal").querySelector("li.selectedValue"),l=t.innerText;t.getAttribute("template");const a=document.getElementById("modal-uploadExcel-info").querySelector("tbody"),o={};for(let e of a.querySelectorAll("tr")){const i=e.firstElementChild.innerText,c=e.querySelector("select").value;o[i]=c}const d=await Z(l,Object.keys(o),A,o);f.getInstance(document.getElementById("modal-uploadExcel-info")).hide(),m("Success!","Excel uploaded successfully"),ie(d,o),N(l),this.innerText="Upload",this.removeAttribute("disabled")};function ie(t,l){const[a,o]=E("Status","OK"),d=n("tr",null,null,n("td",null,null,document.createTextNode("SheetName"))),e=n("div","form-group mb-4",null,n("table","table table-bordered table-sm",null,n("thead",null,null,d)));e.style.maxHeight="300px",e.style.overflowY="auto",e.style.overflowX="auto",d.appendChild(n("td",null,null,document.createTextNode("Status"))),d.appendChild(n("td",null,null,document.createTextNode("Msg")));const i=n("tbody");e.firstChild.appendChild(i);for(let c in t){let s=n("tr");s.appendChild(n("td",null,null,document.createTextNode(c)));let r,u;!isNaN(t[c])&&l[c]=="createAndUpload"?(r="Create And Uploaded",u=`${t[c]} rows inserted`):isNaN(t[c]&&l[c]=="purgeAndUpload")?(r="Errored",u=t[c]):(r="Purge And Uploaded",u=`${t[c]} rows inserted`),s.appendChild(n("td",null,null,document.createTextNode(r))),s.appendChild(n("td",null,null,document.createTextNode(u))),i.appendChild(s)}a.appendChild(e),new f(document.getElementById("scc-one-modal")).show(),o.onclick=function(){f.getInstance(g).hide()}}function ce(t){const l=document.getElementById("availableModal").querySelector("li.selectedValue");if(!l){m("Alert!","Please select a model");return}const a=[];for(let s of document.getElementById("tableGroup").querySelectorAll("button.accordion-button"))a.push(s.innerText);const o=l.innerText,[d,e]=E("Download Excel","Download"),i=n("input","form-check-input round-check"),c=n("div","form-check",null,i);i.setAttribute("type","checkbox"),i.checked=!0,c.appendChild(n("label","form-check-label",null,document.createTextNode("Input Tables Only")));for(let s of a){let r=c.cloneNode(!0);r.lastChild.innerText=s,d.appendChild(r)}e.onclick=async function(s){let r=[];for(let h of d.querySelectorAll("input:checked"))r.push(h.parentNode.lastChild.innerText);f.getInstance(g).hide();let p=document.getElementById("dl_progress_div");p.querySelector("div").innerText="Downloading",p.style.display="",await J(o,[],r),p.querySelector("div").innerText="Running",p.style.display="none"}}async function se(t){let l=document.getElementById("data-loader");const a=document.getElementById("availableModal").querySelector("li.selectedValue");if(!a){m("Alert!","Please select a model");return}const o=a.innerText;l.style.display="",await y("executeQuery",o,"VACUUM"),l.style.display="none",m("Success!","Model vacuumed successfully")}async function re(){const t=document.getElementById("viewName").value,l=document.getElementById("query-input").value,a=document.getElementById("availableModal").querySelector("li.selectedValue").innerText;if(!a){m("Alert!","Please select a model");return}(t.trim()==""||l.trim()=="")&&m("Alert!","Please make sure that View Name and Query was entered"),await _("home","checkOrCreateView",{view_name:t,view_query:l,model_name:a,isExist:!1}),f.getInstance(document.getElementById("modal-createView")).hide(),m("Success","View created successfully"),N(a)}function Q(t){var l=/^[a-zA-Z0-9_]+$/;return l.test(t)}function ue(t){const l=document.getElementById("outputTxt");if(t){const a=document.createElement("div");a.textContent=`Error: ${t}`,a.style.color="red",l.appendChild(a)}}async function me(t){const l=document.getElementById("taskDiv");l.innerHTML="";const o=await y("fetchData",t,"SELECT TaskId,TaskName,TaskDisplayName FROM S_TaskMaster");for(const[d,e,i]of o){const c=n("li",null,null,n("a","dropdown-item",null,document.createTextNode(i)));c.onclick=async function(){const s=document.getElementById("myCanvas");document.getElementById("loadingOverlay").classList.remove("hidden"),document.getElementById("outputDiv").style.display="",document.getElementById("outputTxt").innerHTML="",D=null;const r=document.getElementById("availableModal").querySelector("li.selectedValue"),u=r.getAttribute("project"),h=await y("fetchData",r.innerText,"SELECT FilePath,FileData,FileName FROM S_ExecutionFiles WHERE FileName IS NOT NULL AND Status = 'Active' ");let b=null;h.forEach(I=>{I[0]===e&&(b=I[1])});const C=await y("fetchData",r.innerText,"SELECT FileName,FileBlob FROM S_DataFiles WHERE FileType = 'Input'"),W=await y("fetchData",r.innerText,"SELECT WheelName,WheelBlob FROM S_PackageWheels");await y("updateData",r.innerText,"UPDATE S_Taskmaster SET TaskLastRunDate = ? WHERE TaskId = ? ",[pe(),d]);const L=await F(e,"Started",null,null,d);let T=await j("executeScript",b,u,r.innerText,h,null,C,W);if(T.stderr)F(e,"Errored",T.stderr,L);else{if(T.blob){const I=s.getContext("2d");I.clearRect(0,0,s.width,s.height),D=T.blob;const w=await createImageBitmap(T.blob),v=Math.min(s.width/w.width,s.height/w.height),O=(s.width-w.width*v)/2,z=(s.height-w.height*v)/2;I.drawImage(w,O,z,w.width*v,w.height*v),new f(document.getElementById("modal-show-output")).show()}F(e,"Completed",null,L),T.outputFiles&&T.outputFiles.length>0&&(await y("deleteData",r.innerText,"DELETE FROM S_DataFiles WHERE FileType = 'Output'"),T.outputFiles.forEach(async([w,v])=>{await y("insertData",r.innerText,`INSERT INTO S_DataFiles (FileName,FileType,FileBlob) 
                                            VALUES (?, ?, ?) ON CONFLICT (FileName,FileType) DO UPDATE SET FileBlob = ? `,[w,"Output",v,v])}))}document.getElementById("loadingOverlay").classList.add("hidden"),ue(T.stderr)},l.appendChild(c)}}function pe(){const t=new Date,l=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),d=String(t.getHours()).padStart(2,"0"),e=String(t.getMinutes()).padStart(2,"0"),i=String(t.getSeconds()).padStart(2,"0");return`${l}-${a}-${o} ${d}:${e}:${i}`}async function F(t,l,a=null,o=null,d=null){const e=document.getElementById("availableModal").querySelector("li.selectedValue");if(o)await y("updateData",e.innerText,`UPDATE T_TaskLogs SET TaskStatus = ?,ErrorMsg = ?, EndDate = datetime('now', 'localtime')
                     WHERE TaskName = ? AND Id = ? `,[l,a,t,o]);else return await y("insertData",e.innerText,"INSERT INTO T_TaskLogs (TaskId,TaskName,TaskStatus,EndDate) VALUES (?, ?, ?, datetime('now', 'localtime'))",[d,t,l])}async function fe(){this.setAttribute("disabled",""),this.innerHTML='<span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>';const t=document.getElementById("availableModal").querySelector("li.selectedValue"),l=document.getElementById("inpFiles");if(l.files.length>0){await y("executeQuery",t.innerText,"DELETE FROM S_DataFiles;",["script"]);for(const o of l.files){const d=await o.arrayBuffer();await y("insertData",t.innerText,`INSERT INTO S_DataFiles (FileName,FileType,FileBlob) 
                            VALUES (?, ?, ?) ON CONFLICT (FileName,FileType) DO UPDATE SET FileBlob = ? `,[o.name,"Input",new Uint8Array(d),new Uint8Array(d)])}this.removeAttribute("disabled",""),this.innerHTML="Upload",f.getInstance(document.getElementById("modal-upload-files")).hide(),m("Success","Files Upload Successfully.")}l.value=null}async function q(){const t=document.getElementById("modal-input-files").querySelector(".modal-body");t.innerHTML="";const l=document.getElementById("availableModal").querySelector("li.selectedValue"),o=await y("fetchData",l.innerText,"SELECT FileId,FileName FROM S_DataFiles WHERE FileType = 'Input' "),d=n("tr"),e=n("div","form-group",null,n("table","table table-bordered table-sm",null,n("thead",null,null,d)));e.style.maxHeight="300px",e.style.overflowY="auto";const i=n("tbody");e.firstChild.appendChild(i),t.appendChild(e);for(let r of o){const u=n("tr","d-flex align-items-center");u.appendChild(n("td","w-100",null,document.createTextNode(r[1])));const p=n("td","input-file-icon m-0 px-2");let h=n("span","fa fa-trash");h.onclick=he.bind(null,r[1],r[0]),p.appendChild(h);const b=n("td","input-file-icon m-0 px-2");let x=n("span","fa fa-download");x.onclick=$.bind(null,r[1],r[0]),b.appendChild(x);const C=n("td","input-file-icon m-0 px-2");let k=n("span","fa fa-upload");k.onclick=H.bind(null,r[1],r[0]),C.appendChild(k),u.appendChild(p),u.appendChild(C),u.appendChild(b),i.appendChild(u)}const c=n("div","d-flex justify-content-end");let s=n("button","btn btn-primary",null,document.createTextNode("Add File"));c.appendChild(s),t.appendChild(c),s.onclick=H}async function ye(){const t=document.getElementById("modal-input-files").querySelector(".modal-body");t.innerHTML="";const l=document.getElementById("availableModal").querySelector("li.selectedValue"),o=await y("fetchData",l.innerText,"SELECT FileId,FileName FROM S_DataFiles WHERE FileType = 'Output' "),d=n("tr"),e=n("div","form-group",null,n("table","table table-bordered table-sm",null,n("thead",null,null,d)));e.style.maxHeight="300px",e.style.overflowY="auto";const i=n("tbody");e.firstChild.appendChild(i),t.appendChild(e);for(let c of o){const s=n("tr","d-flex align-items-center");s.appendChild(n("td","w-100",null,document.createTextNode(c[1])));const r=n("td","input-file-icon m-0 px-2");let u=n("span","fa fa-download");u.onclick=$.bind(null,c[1],c[0]),r.appendChild(u),s.appendChild(r),i.appendChild(s)}}async function he(t,l){const a=document.getElementById("availableModal").querySelector("li.selectedValue");await y("deleteData",a.innerText,"DELETE FROM S_DataFiles WHERE FileType = 'Input' AND FileId = ? AND FileName = ? ",[l,t]),q()}async function $(t,l){let a=document.getElementById("modal-input-files").querySelector("h2").innerText.indexOf("Input")>-1?"Input":"Output";const o=document.getElementById("availableModal").querySelector("li.selectedValue"),e=await y("fetchData",o.innerText,"SELECT FileName,FileBlob FROM S_DataFiles WHERE FileType = ? AND FileID = ? AND FileName = ?",[a,l,t]);if(e){const c=new Blob([e[0][1]]);if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(c);return}const s=window.URL.createObjectURL(c);var i=document.createElement("a");i.href=s,i.download=t,i.click(),setTimeout(function(){window.URL.revokeObjectURL(s)},1e3)}else m("Alert!","No File Exists")}function H(t=null,l=null){f.getInstance(document.getElementById("modal-input-files")).hide();const a=document.getElementById("availableModal").querySelector("li.selectedValue"),[o,d]=E("Upload Excel","Upload"),e=n("input","form-control"),i=n("div","input-group",null,e);e.setAttribute("type","file"),o.appendChild(i),d.onclick=async function(c){if(e.files[0]){d.setAttribute("disabled",""),d.innerHTML='<span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>';const s=await e.files[0].arrayBuffer();t&&l?await y("updateData",a.innerText,"UPDATE S_DataFiles SET FileBlob = ? WHERE FileType = 'Input' AND FileName = ? AND FileId = ? ",[e.files[0].name,new Uint8Array(s),t,l]):await y("insertData",a.innerText,"INSERT INTO S_DataFiles (FileName,FileType,FileBlob) VALUES (?, ?, ?) ON CONFLICT (FileName,FileType) DO UPDATE SET FileBlob = ?",[e.files[0].name,"Input",new Uint8Array(s),new Uint8Array(s)]),f.getInstance(document.getElementById("scc-one-modal")).hide(),new f(document.getElementById("modal-input-files")).show(),e.value=null,d.innerHTML="Upload",d.removeAttribute("disabled",""),q()}else m("Alert!","Please choose a file")},new f(document.getElementById("scc-one-modal")).show()}async function be(){let t=document.getElementById("modal-input-files").querySelector("h2").innerText.indexOf("Input")>-1?"Input":"Output";const l=document.getElementById("availableModal").querySelector("li.selectedValue");try{const o=await y("fetchData",l.innerText,"SELECT FileName,FileBlob FROM S_DataFiles WHERE FileType = ?",[t]);if(!o||o.length===0){m("Alert!","No files found to download.");return}const d=new JSZip;o.forEach(c=>{d.file(c[0],c[1])});const e=await d.generateAsync({type:"blob"}),i=document.createElement("a");i.href=window.URL.createObjectURL(e),i.download="InputFiles.zip",i.click(),setTimeout(function(){window.URL.revokeObjectURL(i.href)},1e3)}catch(a){console.error("Error creating zip file for download:",a)}}async function ge(t){const l=document.getElementById("availableModal").querySelector("li.selectedValue");if(!l){m("Alert!","Please select a model");return}const[a,o]=E("Upload Package","Upload"),d=n("input","form-control"),e=n("div","input-group",null,d);d.setAttribute("type","file"),d.setAttribute("accept",".whl"),a.appendChild(e),o.onclick=async function(i){if(d.files[0]){o.setAttribute("disabled",""),o.innerHTML='<span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>';const s=await d.files[0].arrayBuffer();try{await y("insertData",l.innerText,"INSERT INTO S_PackageWheels (WheelName,WheelBlob) VALUES (?, ?) ON CONFLICT (WheelName) DO UPDATE SET WheelBlob = ?",[d.files[0].name,new Uint8Array(s),new Uint8Array(s)]),m("Success","Package uploaded successfully!")}catch(r){console.error("Error saving file:",r)}f.getInstance(document.getElementById("scc-one-modal")).hide(),d.value=null,o.innerHTML="Upload",o.removeAttribute("disabled","")}else m("Alert!","Please choose a file")}}async function _e(){const t=document.createElement("a");t.href=window.URL.createObjectURL(D),t.download="output.jpg",t.click(),setTimeout(function(){window.URL.revokeObjectURL(t.href)},1e3)}
