import"./pixel.CyAMObzi.js";import{f as Z}from"./flatpickr.min.Cwadf_CE.js";import{e as be,f as Ee,d as we,u as xe,c as p,s as K,g as Ie,a as Ne,b as u,h as me,i as Se,j as Ae,k as Le,r as Y,l as ie,m as Be,n as ke,o as Te,p as qe,q as Oe,t as Pe}from"./scc.2HUkD3uG.js";import{M as $,D as ne}from"./bootstrap.esm.CkDf0L-y.js";import"https://webr.r-wasm.org/latest/webr.mjs";const A=document.getElementById("currentPage"),y=document.getElementById("displayTable"),X=1e3;var U=!1,x=new Object,I=new Object,k=new Object,O=[],n=new Object;let pe={};var j,q=1,r,P=[],R=0,F={};const se=new URLSearchParams(window.location.search),_=se.get("modelName"),C=se.get("tableName");C&&(document.title=C);let Q={},V=null,D;Ke();document.addEventListener("DOMContentLoaded",async function(){let l=await be("init");l&&l.msg=="Success"&&De(),document.querySelectorAll(".modal").forEach(e=>{$.getInstance(e)||new $(e)})});async function De(){document.getElementById("resetSort").onclick=ze;const l=await Ee(_,C);n=l[0][0],D=l[0][2],l[0][1]&&(document.getElementById("viewQuery").style.display="",document.getElementById("queryInput").value=l[0][1]),l[1]&&(j=!0,y.classList.add("no_user_select")),_e(),ee(),j||(document.getElementById("deleteRecordsBtn").parentNode.style.display="none",document.getElementById("excelUploadBtn").parentNode.style.display="none",document.getElementById("addNewColBtn").parentNode.style.display="none",document.getElementById("delNewColBtn").parentNode.style.display="none",document.getElementById("multiUpdate").parentNode.style.display="none")}function $e(l){je(l),r=l.reduce((i,s)=>i.concat(s[0]),[]),l[0][1].toLowerCase()=="primary"&&(U=!0),T(r);const t=y.querySelector("thead");t.innerHTML="";const e=u("tr","headers",null,null),o=u("tr","lovRow",null,null);for(let i of l){pe[i[0]]=i[1];let s=u("th",null,null,null);l.indexOf(i)<D&&(s.classList.add("ZDX_H"),s.classList.add(`C${l.indexOf(i)}`)),s.setAttribute("nowrap","");const a=u("input","form-control p-1",null,null),c=u("th",null,null,u("div","input-group",null,a));a.setAttribute("type","text"),a.addEventListener("keydown",function(m){const g=this.nextElementSibling,w=g.nextElementSibling;if(g.classList.contains("show")){if(m.keyCode=="27")new ne(g).toggle();else if(m.keyCode=="40"){let b=w.querySelector("a.selected");if(b)if(b.parentNode.tagName=="FORM"){const L=w.querySelector("div.lov-values a");L&&(b.classList.remove("selected"),L.classList.add("selected"))}else{const L=b.nextElementSibling;L&&(b.classList.remove("selected"),L.classList.add("selected"))}else w.querySelector("a.dropdown-item").classList.add("selected")}else if(m.keyCode=="38"){let b=w.querySelector("a.selected");if(b&&b.parentNode.tagName!="FORM"){const L=b.previousElementSibling;L?(b.classList.remove("selected"),L.classList.add("selected")):(b.classList.remove("selected"),w.firstChild.firstChild.classList.add("selected"))}}else m.keyCode=="32"&&(w.querySelector("a.selected").firstChild.click(),m.preventDefault());return m.key==="Enter"&&(de(c,i[0]),new ne(g).toggle(),m.preventDefault()),!1}else{if(m.key==="Enter")return Re()&&T(r),!1;if(m.altKey&&m.keyCode=="40")return new ne(g).toggle(),w.querySelector("a.dropdown-item").classList.add("selected"),!1}});const d=u("span","input-group-text dropdown-toggle px-1",null,u("span","fas fa-chevron-down",null,null));d.addEventListener("show.bs.dropdown",async function(){const m=c.querySelector("div.lov-values");i[0]in x||(x[i[0]]=[]),i[0]in I||(I[i[0]]=[]),x[i[0]].length==0&&I[i[0]].length==0&&(m.parentNode.querySelector("input").checked=!0),m.innerHTML="";let g=Object.assign({},x),w=Object.assign({},I);delete g[i[0]],delete w[i[0]],document.getElementById("data-loader").style.display="";const b=await ie(_,C,[i[0]],{...g,...Q},w,k,1,[],!0,!0);document.getElementById("data-loader").style.display="none";const L=b[0].length;for(let H of b[0]){let B=u("a","dropdown-item",null,u("input","form-check-input",null,null));B.firstChild.setAttribute("type","checkbox"),x[i[0]].length>0?H[0]!==null?x[i[0]].indexOf(H[0].toString())>-1&&(B.firstChild.checked=!0):x[i[0]].indexOf("null")>-1&&(B.firstChild.checked=!0):I[i[0]].length>0?H[0]!==null?I[i[0]].indexOf(H[0].toString())==-1&&(B.firstChild.checked=!0):I[i[0]].indexOf("null")==-1&&(B.firstChild.checked=!0):B.firstChild.checked=!0,B.appendChild(u("label","form-check-label",null,document.createTextNode(M(i[0],H[0])))),B.querySelector("label").setAttribute("value",H[0]),m.appendChild(B),B.firstChild.onchange=function(et){!B.firstChild.checked&&m.parentNode.querySelector("input").checked?m.parentNode.querySelector("input").checked=!1:B.firstChild.checked&&!m.parentNode.querySelector("input").checked&&m.querySelectorAll("input:checked").length==L&&(m.parentNode.querySelector("input").checked=!0)}}m.querySelectorAll("input:checked").length==L&&(m.parentNode.querySelector("input").checked=!0)}),d.setAttribute("type","button"),d.setAttribute("data-bs-toggle","dropdown"),d.setAttribute("aria-haspopup","true"),d.setAttribute("aria-expanded","false"),c.querySelector("div").appendChild(d);const f=u("div","multiselect-container dropdown-menu dropdown",null,u("form",null,null,u("a","dropdown-item",null,u("input","form-check-input",null,null))));f.querySelector("a").appendChild(u("label","form-check-label",null,document.createTextNode("Select All"))),f.querySelector("input").setAttribute("type","checkbox"),f.firstChild.appendChild(u("div","dropdown-divider")),f.firstChild.appendChild(u("div","lov-values")),f.firstChild.appendChild(u("div","dropdown-divider"));const v=f.querySelector("input");v.onchange=function(m){if(v.checked)for(let g of c.querySelectorAll("div.lov-values input"))g.checked||(g.checked=!0);else for(let g of c.querySelectorAll("div.lov-values input"))g.checked&&(g.checked=!1)};const h=u("button","btn btn-sm btn-primary",null,document.createTextNode("OK")),S=u("button","btn btn-sm btn-tertiary",null,document.createTextNode("CLEAR"));f.firstChild.appendChild(u("div","dropdown-item",null,h)),h.parentNode.appendChild(S),S.style.float="left",S.setAttribute("type","button"),h.setAttribute("type","button"),c.querySelector("div").appendChild(f),h.addEventListener("mousedown",function(m){let g=c.querySelectorAll("div.lov-values input:checked").length,w=c.querySelectorAll("div.lov-values input").length;setTimeout(function(){g==w?d.childNodes[1]&&(d.removeChild(d.childNodes[0]),d.firstChild.style=""):!g==0&&(d.childNodes[1]||(d.firstChild.style="position:relative;top:4px;",d.insertBefore(u("span","fas fa-filter"),d.childNodes[0])))},600),de(c,i[0])}),S.addEventListener("mousedown",function(m){let g=!1;x[i[0]].length>0?(g=!0,x[i[0]]=[]):I[i[0]].length>0&&(g=!0,I[i[0]]=[]),g&&T(r),setTimeout(function(){d.childNodes[1]&&(d.removeChild(d.childNodes[0]),d.firstChild.style="")},200)});let E=Ge(i[0]);if(U&&l.indexOf(i)==0){let m=u("input","form-check-input","selectAll",null);m.setAttribute("type","checkbox"),s.appendChild(m),s.id=i[0],o.appendChild(u("th","ZDX_H",null,null)),m.onchange=function(g){for(let w of y.querySelectorAll("tbody tr"))w.firstChild.firstChild&&(w.firstChild.firstChild.checked=m.checked)}}else if(i[2]==1){s.classList.add("min-width");let m=u("u",null,null,document.createTextNode(i[0]));m.appendChild(u("span",`fa ${E}`,null,null)),s.appendChild(m),o.appendChild(c)}else s.classList.add("min-width"),s.appendChild(document.createTextNode(i[0])),s.appendChild(u("span",`fa ${E}`,null,null)),o.appendChild(c);l.indexOf(i)<D&&(c.classList.add("ZDX_H"),c.classList.add(`C${l.indexOf(i)}`));const N=s.querySelector(`span.${E}`);N&&(N.addEventListener("click",function(){const m=O.reduce((w,b)=>w.concat(b[0]),[]);let g=m.indexOf(i[0]);g<0&&(g=m.length),this.classList.contains("fa-sort-down")?(O[g]=[i[0],"desc"],this.classList.remove("fa-sort-down"),this.classList.add("fa-sort-up")):(this.classList.remove("fa-sort-up"),this.classList.remove("fa-sort"),this.classList.add("fa-sort-down"),O[g]=[i[0],"asc"]),T(r)}),s.addEventListener("click",function(m){if(m.target.classList.contains("fa"))return!1;{const g=r.indexOf(this.firstChild.textContent);if(this.classList.contains("selected_col"))for(let w of y.querySelectorAll("tr"))w.childNodes[g].classList.remove("selected_col");else{const w=this.parentNode.querySelector(".selected_col");if(w){const b=r.indexOf(w.firstChild.textContent);for(let L of y.querySelectorAll("tr"))L.childNodes[b].classList.remove("selected_col")}for(let b of y.querySelectorAll("tr"))b.childNodes[g].classList.add("selected_col")}}})),e.appendChild(s)}t.appendChild(e),t.appendChild(o)}async function T(l,t=1){R=0,P=[],q=t;let e=!1;U&&document.getElementById("selectAll")&&(e=document.getElementById("selectAll").checked);const o=y.querySelector("thead .selected_col");let i=0;o&&(i=l.indexOf(o.firstChild.textContent)),document.getElementById("data-loader").style.display="";const s=await ie(_,C,l,{...x,...Q},I,k,t,O);document.getElementById("data-loader").style.display="none";const a=y.querySelector("tbody"),c=s[0].length;a.innerHTML="";for(let v of s[0]){let h=le(v,i,e,t);a.appendChild(h)}if(Ce(),j&&a.appendChild(te()),c>-5){let v=u("tr","footer");for(let h of l){let S=document.createElement("td");v.appendChild(S)}v.style.display="none",a.appendChild(v)}let d="",f="";s[1]>=X?(d=((t-1)*X+1).toString()+"-"+Math.min(t*X,s[1]).toString()+" of "+s[1],f="of "+(parseInt(s[1]/X)+1).toString()):(d="1-"+s[1].toString()+" of "+s[1].toString(),f="of 1"),document.getElementById("totalRecordsPanel").innerText=d,A.parentNode.childNodes[2].textContent=f,A.setAttribute("maxPages",parseInt(s[1]/X)+1),A.value=q}const z=function(l,t){if(l.length!==t.length)return!0;for(let e of l)if(t.indexOf(e)==-1)return!0;return!1};function Re(){let l=0;U&&(l=1);let t=!1;for(let[e,o]of document.querySelectorAll("tr.lovRow th input[type=text]").entries()){let i=o.value,s=r[e+l];if(s in k)k[s]!=i&&(t=!0,i==""?delete k[s]:k[s]=i);else{if(i=="")continue;k[s]=i}}return Object.keys(k).length>0&&(t=!0),t}A.addEventListener("keyup",function(l){if(l.key==="Enter"){const t=A.value;if(isNaN(t))A.value=q;else{const e=parseInt(A.getAttribute("maxPages"));let o=parseInt(A.value);o<=1?o=1:o>=e&&(o=e),A.value=o,o!==q&&T(r,o)}}});document.getElementById("firstPageBtn").onclick=function(l){q>1&&(A.value=1,T(r,1))};document.getElementById("prevPageBtn").onclick=function(l){q>1&&(A.value=q-1,T(r,q-1))};document.getElementById("nextPageBtn").onclick=function(l){const t=parseInt(A.getAttribute("maxPages"));q<t&&(A.value=q+1,T(r,q+1))};document.getElementById("lastPageBtn").onclick=function(l){const t=parseInt(A.getAttribute("maxPages"));q<t&&(A.value=t,T(r,t))};document.getElementById("refreshBtn").parentNode.onclick=function(l){Promise.resolve(_e()).then(J)};function J(){Fe(),x=new Object,I=new Object,k=new Object,document.getElementById("selectAll")&&(document.getElementById("selectAll").checked=!1),T(r,1);for(let e of y.querySelectorAll(".lovRow input.form-control"))e.value="";let t=y.querySelector("thead").querySelectorAll("span.input-group-text");for(let e of t)e.childNodes[1]&&(e.removeChild(e.childNodes[0]),e.firstChild.style="")}function Fe(){for(let l of y.querySelectorAll("thead span.fa-sort-down"))Object.keys(F).includes(l.parentNode.innerText.trim())?F[l.parentNode.innerText.trim()]=="desc"&&(l.classList.remove("fa-sort-down"),l.classList.add("fa-sort-up")):(l.classList.add("fa-sort"),l.classList.remove("fa-sort-down"));for(let l of y.querySelectorAll("thead span.fa-sort-up"))Object.keys(F).includes(l.parentNode.innerText.trim())?F[l.parentNode.innerText.trim()]=="asc"&&(l.classList.remove("fa-sort-up"),l.classList.add("fa-sort-down")):(l.classList.add("fa-sort"),l.classList.remove("fa-sort-up"));for(let l of y.querySelectorAll("th.selected_col"))l.classList.remove("selected_col")}function de(l,t){const e=[],o=[];for(let s of l.querySelectorAll("div.lov-values input"))s.checked?e.push(s.nextElementSibling.getAttribute("value")):o.push(s.nextElementSibling.getAttribute("value"));let i=!1;e.length>o.length?(z(x[t],[])&&(i=!0,x[t]=[]),z(I[t],o)&&(i=!0,I[t]=o)):(z(x[t],e)&&(i=!0,x[t]=e),z(I[t],[])&&(i=!0,I[t]=[])),i&&T(r)}document.getElementById("excelDownloadBtn").onclick=async function(l){document.getElementById("data-loader").style.display="",await we(_,[C]),document.getElementById("data-loader").style.display="none"};document.getElementById("importExcel").onclick=async function(l){if(document.getElementById("fileUpload").files[0]){document.getElementById("data-loader").style.display="";const e=await document.getElementById("fileUpload").files[0].arrayBuffer(),o=await xe(_,[C.toLowerCase()],e);document.getElementById("data-loader").style.display="none";let i=Object.keys(o),a=i.map(c=>c.toLowerCase()).indexOf(C.toLowerCase());a>-1?isNaN(o[i[a]])?p("Error!",o[i[a]]):(J(),p("Success!","Total Rows: "+o[i[a]]+" Imported")):p("Error!","No sheet matches with table name")}else p("Alert!","Please choose a file to upload")};async function je(l){let t=["NUMERIC","INTEGER"],e={decimals:2,comma:0,locale:0,currency:0,aggregate:"SUM"};const o={};for(let s in e){o[s]=new Object;for(let a of l){let c=a[0];if(t.indexOf(a[1])>-1)if(s in n)if(c in n[s]){let d=n[s][c];!isNaN(d)&&parseInt(d)>-1?o[s][c]=parseInt(d):["locale","currency","aggregate"].indexOf(s)>-1?o[s][c]=d:o[s][c]=e[s]}else s.toLowerCase()==="decimals"&&a[1]==="INTEGER"?o[s][c]=0:o[s][c]=e[s];else s.toLowerCase()==="decimals"&&a[1]==="INTEGER"?o[s][c]=0:o[s][c]=e[s]}}r=l.reduce((s,a)=>s.concat(a[0]),[]);for(let s in e)n[s]=o[s];"autofiller"in n||(n.autofiller=new Object),"query"in n||(n.query=new Object),"lov"in n||(n.lov=new Object),n.date=new Object,n.datetime=new Object;const i=Object.keys(n.lov);for(let s of i){let a=r.indexOf(s);if(a>-1&&!Array.isArray(n.lov[s])){let c=n.lov[s].split("|");const d=l[a][0];if(c[0].trim().toLowerCase()=="select")if(c[1].trim().toLowerCase().substring(0,6)=="select"){delete n.lov[s];let f=c.slice(1).join("_").trim();n.query[d]=f;const v=await Y(_,f);n.lov[d]=v}else{let f=c[1].trim().split(";"),v=[];for(let h of f)h.trim().length>0&&v.push(h.trim());delete n.lov[s],n.lov[d]=v}else if(c[0].trim().toLowerCase()=="autofiller")if(c[1].trim().toLowerCase().substring(0,6)=="select"){delete n.lov[s];let f=c.slice(1).join("|").trim(),v=y.querySelector("tbody");n.query[d]=f;const h=await Y(_,f);n.autofiller[d]=h,document.getElementById("dataList_div").appendChild(G(`${d}_dataList`,h));let S=v.getElementsByClassName("insert");S&&S[0]&&(S[0].remove(),v.appendChild(te()))}else{let f=c[1].trim().split(";"),v=[];for(let S of f)S.trim().length>0&&v.push(S.trim());delete n.lov[s],n.autofiller[d]=v;let h=document.getElementById(`${d}_dataList`);h&&h.remove(),document.getElementById("dataList_div").appendChild(G(`${d}_dataList`,v))}else c[0].trim().toLowerCase()=="date"?(delete n.lov[s],n.date[d]=1):c[0].trim().toLowerCase()=="datetime"?(delete n.lov[s],n.datetime[d]=1):console.log("Neither LOV nor Autofiller, please check")}}}document.getElementById("incrDecimals").onclick=async function(l){const t=y.querySelector("thead .selected_col");if(t){const e=t.innerText;if(e in n.decimals){n.decimals[e]+=1,await K(_,C,e,{Decimals:n.decimals[e]});for(let o of y.querySelectorAll("td.selected_col")){let i=parseFloat(o.getAttribute("title"));isNaN(i)||(o.innerText=M(e,i))}}else p("Alert!","Please select a numeric column")}else p("Alert!","Please select a column")};document.getElementById("decrDecimals").onclick=async function(l){const t=y.querySelector("thead .selected_col");if(t){const e=t.innerText;if(e in n.decimals){const o=n.decimals[e]-1;if(o>-1){n.decimals[e]=o,await K(_,C,e,{Decimals:o});for(let i of y.querySelectorAll("td.selected_col")){let s=parseFloat(i.getAttribute("title"));isNaN(s)||(i.innerText=M(e,s))}}}else p("Alert!","Please select a numeric column")}else p("Alert!","Please select a column")};document.getElementById("showSummaryBtn").onclick=async function(l){const t=Object.keys(n.decimals);let e=y.querySelector("tr.footer");if(t.length>0)if(e.style.display==="none"){document.getElementById("data-loader").style.display="";const o=await Ie(_,C,t,x,I,k);document.getElementById("data-loader").style.display="none";for(let i of t){let s=o[t.indexOf(i)],a=1;j||(a=0);let c=r.indexOf(i,a);e.childNodes[c].innerText=M(i,s),e.childNodes[c].setAttribute("title",s)}e.style.removeProperty("display")}else e.style.display="none"};document.getElementById("thousandSepBtn").onclick=async function(l){const t=y.querySelector("thead .selected_col");if(t){const e=t.innerText;if(e in n.decimals){n.comma[e]=1-n.comma[e],await K(_,C,e,{Comma:n.comma[e]});for(let o of y.querySelectorAll("td.selected_col")){let i=parseFloat(o.getAttribute("title"));isNaN(i)||(o.innerText=M(e,i))}}else p("Alert!","Please select a numeric column")}else p("Alert!","Please select a column")};function W(l,t,e){if(l=="all")for(let o of document.getElementById(t).querySelectorAll("li"))document.getElementById(e).appendChild(o);else if(l=="one")for(let o of document.getElementById(t).querySelectorAll("li.selectedValue"))document.getElementById(e).appendChild(o),o.classList.remove("selectedValue")}document.getElementById("allLeft").onclick=function(l){W(this.getAttribute("bttype"),this.getAttribute("src"),this.getAttribute("dest"))};document.getElementById("allRight").onclick=function(l){W(this.getAttribute("bttype"),this.getAttribute("src"),this.getAttribute("dest"))};document.getElementById("selectedLeft").onclick=function(l){W(this.getAttribute("bttype"),this.getAttribute("src"),this.getAttribute("dest"))};document.getElementById("selectedRight").onclick=function(l){W(this.getAttribute("bttype"),this.getAttribute("src"),this.getAttribute("dest"))};function Me(l,t){document.getElementById("availableColumn").innerHTML="",document.getElementById("selectedColumn").innerHTML="";for(let e of l)document.getElementById("availableColumn").appendChild(re(e));for(let e of t)document.getElementById("selectedColumn").appendChild(re(e))}function re(l){let t=u("li","dropzone",null,document.createTextNode(l));return t.setAttribute("draggable",!0),t.onclick=function(e){if(!e.ctrlKey)for(let o of this.parentNode.querySelectorAll("li.selectedValue"))o.classList.remove("selectedValue");this.classList.add("selectedValue"),e.preventDefault()},t.ondblclick=function(){let e=this.parentNode.getAttribute("dest");document.getElementById(e).appendChild(this),this.classList.remove("selectedValue")},t}async function ee(){const l=await Ne(_,C);if(l.length==0||l[1].length==0){p("Alert!",`No table exists with tablename ${C} `);return}$e(l[1]);let t;j?t=l[1].reduce((i,s)=>i.concat(s[0]),[]).splice(1):t=l[1].reduce((i,s)=>i.concat(s[0]),[]),Me(l[0],t);let e=document.getElementById("removeColumnSelect");e.innerHTML="";let o=u("option",null,null,document.createTextNode("Select a Column to Remove"));o.setAttribute("value",0),o.setAttribute("selected",""),e.appendChild(o);for(const[i,s]of t.entries())if(l[1][i][1]!="PRIMARY"||l[1][i][2]!=1||l[1][i][3]!=1){let a=u("option",null,null,document.createTextNode(s));e.appendChild(a)}for(let i of l[0]){let s=u("option",null,null,document.createTextNode(i));e.appendChild(s)}}document.getElementById("saveColumnSelection").onclick=async function(l){const t=[];for(let o of document.getElementById("selectedColumn").childNodes)t.push(o.innerText);await me(_,C,t)&&ee()};document.getElementById("addNewColumn").onclick=async function(l){const t=document.getElementById("newColName").value,e=document.getElementById("addColumnSelect").value,o="*|,\":<>[]{} `';()@&$#%",i=r;if(t){const a=t.length;if(a==0){p("Alert!","Please Enter Column Name");return}if(a>=50){p("Alert!","Please Enter Column Name upto 50 characters");return}for(var s=0;s<a;s++){if(o.indexOf(t.charAt(s))>-1){p("Alert!","Please remove special characters from column name");return}if(e==0){p("Alert!","Please Select valid column type");return}}for(let d of document.getElementById("availableColumn").childNodes)i.push(d.innerText);if(i.indexOf(t)>-1){p("Alert!","Column name already exist, please choose another name");return}await Se(_,C,t,e)&&(ee(),$.getInstance(document.getElementById("modal-add-column")).hide())}else{p("Alert!","Please Enter Column Name");return}};document.getElementById("removeColumn").onclick=async function(l){const t=document.getElementById("removeColumnSelect").value;if(t==0)p("Alert!","Please Select a column to proceed");else{const e=await Ae(_,C,t);e&&(e.message=="Success"?ee():p("Alert!",e.message)),$.getInstance(document.getElementById("modal-remove-column")).hide()}};document.getElementById("delNewColBtn").onclick=async function(l){const t=y.querySelector("thead .selected_col");if(t){const e=r.indexOf(t.firstChild.textContent);for(let s of y.querySelectorAll("tr"))s.childNodes[e].remove();r.splice(e,1);let o=document.getElementById("selectedColumn").childNodes[e-1];document.getElementById("availableColumn").appendChild(o);const i=r.filter(function(s,a,c){return a>0});await me(_,C,i)}else new $(document.getElementById("modal-remove-column")).show()};const oe=async function(l){const[t,e]=ye(),o=await Oe(_,C,x,I,k,e,t,document.getElementById("selectAll").parentNode.id);o&&(J(),p("Success!",`Total of ${o} rows deleted`))};document.getElementById("deleteRecordsBtn").onclick=function(l){if(j)if(document.getElementById("selectAll").checked)p("Alert!","Are you sure, you want to delete all the records?",oe,1);else{const e=y.querySelector("tbody"),o=e.childNodes.length-2,i=e.querySelectorAll("input:checked").length;if(i==0)p("Alert!","Please select atleast one row to proceed?");else if(i<o/2)p("Alert!",`This will delete ${i} records`,oe,1);else{const s=parseInt(document.getElementById("totalRecordsPanel").innerText.split(" ").pop());p("Alert!",`This will delete ${s-o+i} records except ${o-i} not selected records`,oe,1)}}};document.getElementById("multiUpdate").onclick=function(l){if(document.getElementById("modal-update-column").style.display=="none"){const t=y.querySelector("thead .selected_col");t?he(t.innerText):p("Alert!","Please select a column")}};document.getElementById("updateColumn").onclick=async function(l){const t=document.getElementById("ColValueLabel").innerText;let e=document.getElementById("colValue").value;if(t in n.lov)e=document.getElementById("colSelectValue").value;else if(t in n.decimals){if(isNaN(e)){p("Alert!","Please enter numeric value");return}}else if(n.date&&t in n.date){let a=e.split(" ");a[1]==="00:00:00"&&(e=a[0])}e.trim()==""&&(e=null);const[o,i]=ye(),s=await Le(_,C,x,I,k,i,o,document.getElementById("selectAll").parentNode.id,t,e);if(s){let a=!1;i.length==0&&(a=!0);for(let d of y.querySelectorAll("td.selected_col"))!d.parentNode.classList.contains("insert")&&!d.parentNode.classList.contains("footer")&&(a||d.parentNode.firstChild.firstChild.checked)&&(d.setAttribute("title",e),t in n.decimals?d.innerText=M(t,e):d.innerText=e);$.getInstance(document.getElementById("modal-update-column")).hide(),p("Success!",`Total of ${s} rows updated`)}};function ye(){const l=document.getElementById("selectAll").checked;let t=[],e=!1;if(!l){const o=y.querySelector("tbody"),i=o.childNodes.length-1;if(o.querySelectorAll("input:checked").length<i/2){e=!0;for(let a of o.querySelectorAll("input:checked"))t.push(a.parentNode.id)}else{e=!1;for(let a of o.childNodes)a.firstChild.firstChild&&(a.firstChild.firstChild.checked||t.push(a.firstChild.id))}}return[e,t]}document.addEventListener("keydown",Ve);function Ve(l){if(l.key=="F2"&&j){const t=y.querySelector("thead .selected_col");t?document.getElementById("modal-update-column").style.display=="none"&&(he(t.innerText),l.preventDefault()):p("Alert!","Please select a column")}}function he(l){let t=document.getElementById("colValue");if(t.setAttribute("Autocomplete","off"),t.style.borderBottomRightRadius=0,t.style.borderTopRightRadius=0,t.parentNode.classList.contains("awesomplete")){let o=t.cloneNode(!0),i=t.parentNode.parentNode;t.parentNode.remove(),i.insertBefore(o,i.firstChild),t=o}if(t.value="",V&&(V.destroy(),V=null),t.classList.remove("datepicker-input"),t.removeAttribute("list"),t.parentNode.style.display="flex",document.getElementById("colSelectValue").parentNode.style.display="none",document.getElementById("ColValueLabel").innerText=l,l in n.autofiller)t.setAttribute("list",`${l}_dataList`),t.parentNode.style.flex=1;else if(l in n.lov){let o=document.getElementById("colSelectValue");if(t.parentNode.style.display="none",o.parentNode.style.display="flex",o.innerHTML="",n.lov[l].length>0){for(let i of n.lov[l]){let s=u("option",null,null,document.createTextNode(i));o.appendChild(s)}o.firstChild.setAttribute("selected","")}else t.setAttribute("list",`${l}_dataList`)}else l in n.decimals?t.type="number":n.date&&l in n.date?V=Z(t,{dateFormat:"Y-m-d H:i:S",allowInput:!0}):t.type="text";new $(document.getElementById("modal-update-column")).show()}function ue(l){P=[];let t=l.parentNode;for(const[e,o]of t.childNodes.entries()){let i=!1;if(e==0)R=o.id,P.push(o.id);else{let s,a;if(o.innerText==""?s=null:r[e]in n.decimals&&!(r[e]in n.date)&&!(r[e]in n.datetime)?o.getAttribute("title")===null?s="":isNaN(parseFloat(o.getAttribute("title")))?s=o.getAttribute("title"):s=parseFloat(o.getAttribute("title")):s=o.innerText,o.firstChild&&o.firstChild.remove(),P.push(s),r[e]in n.lov){a=u("select","form-select p-1",null);let c=!1;for(let d of n.lov[r[e]]){let f=u("option",null,null,document.createTextNode(d));a.appendChild(f),d==s&&(f.setAttribute("selected",""),c=!0)}if(!c){let d=u("option",null,null,document.createTextNode(s));a.appendChild(d)}}else r[e]in n.autofiller?(a=u("input","form-control p-1",null),i=!0):r[e]in n.decimals&&!(r[e]in n.date)&&!r[e]in n.datetime?(a=u("input","form-control p-1",null),a.type="number"):n.datetime&&r[e]in n.datetime?(a=u("input","form-control datepicker-input p-1",null),V=Z(a,{dateFormat:"Y-m-d H:i:S",allowInput:!0,defaultDate:s}),a.type="text"):n.date&&r[e]in n.date?(a=u("input","form-control datepicker-input p-1",null),a.value=s,V=Z(a,{dateFormat:"Y-m-d",allowInput:!0,defaultDate:s}),a.type="text"):(a=u("input","form-control p-1",null),a.type="text");a.addEventListener("keydown",function(c){c.keyCode=="27"?ae(t):c.keyCode=="13"&&(He(t),c.preventDefault())}),a.value=s,o.appendChild(a),i&&a.setAttribute("list",`${r[e]}_dataList`)}}l.firstChild.focus()}function G(l,t){let e=u("datalist",null,l);for(let o of t){let i=u("option");i.setAttribute("value",o),e.appendChild(i)}return e}function ae(l){l.parentNode.replaceChild(le(P),l),P=[],R=0}function ge(l){return JSON.stringify(l)!=JSON.stringify(P)}async function He(l){let t=ce(l);if(t&&t.length>0)if(ge(t)){let i=new Object;for(const[c,d]of t.entries())if(d!==P[c])if(n.date&&r[c]in n.date){let f=Qe(d);i[r[c]]=f}else if(n.datetime&&r[c]in n.datetime){let f=Je(d);i[r[c]]=f}else i[r[c]]=d;P=[],R=0,await Pe(_,C,t[0],i,document.getElementById("selectAll").parentNode.id);const s=y.querySelector("table");let a=le(t);for(var e=0,o=0;o<D;o++){e+=s.rows[0].cells[o].clientWidth+1;for(let c of a.cells)o==0&&c.classList.contains(`C${o}`)?c.style.left="0px":c.classList.contains(`C${o+1}`)&&(c.style.left=e+"px")}l.parentNode.replaceChild(a,l)}else ae(l)}function te(){let l=u("tr","insert"),t;for(const[e,o]of r.entries()){let i=!1,s=document.createElement("td");if(l.appendChild(s),e==0)s.id=0;else if(e>0){if(o in n.lov&&n.lov[o].toLowerCase()!="freetext"){t=u("select","form-select p-1",null);for(let a of n.lov[o]){let c=u("option",null,null,document.createTextNode(a));t.appendChild(c)}}else o in n.autofiller?(t=u("input","form-control p-1",null),i=!0):o in n.decimals?(t=u("input","form-control p-1",null),t.type="number"):n.date&&o in n.date?(t=u("input","form-control datepicker-input p-1",null),V=Z(t,{dateFormat:"Y-m-d H:i:S",allowInput:!0}),t.type="text"):(t=u("input","form-control p-1",null),t.type="text");t.addEventListener("keydown",function(a){if(a.keyCode=="27")for(let c of this.parentNode.parentNode.childNodes){let d=c.firstChild;d&&d.classList.contains("form-control")&&(d.value="")}else a.keyCode=="13"&&(Xe(this.parentNode.parentNode),a.preventDefault())}),s.appendChild(t),i&&t.setAttribute("list",`${o}_dataList`)}}return l}async function Xe(l){let t={};const e=ce(l);if(e){for(const[i,s]of e.entries())i>0&&(t[r[i]]=s);const o=await qe(_,C,t);if("Success"in o){e[0]=o.Success;const i=l.parentNode,s=i.lastChild,a=le(e);l.remove(),i.appendChild(a),i.appendChild(te()),i.appendChild(s)}else p("Error!",`Error:  ${o.Error}`)}}function le(l,t,e=!1,o=1){let i=u("tr");const s=y.querySelector("tbody");let a;for(const[c,d]of l.entries()){if(U&&c==0){let f=u("input","form-check-input");f.setAttribute("type","checkbox"),e&&(f.checked=!0),o>1?f.disabled=!0:f.onchange=function(){const v=document.getElementById("selectAll");if(!this.checked&&v.checked)v.checked=!1;else if(this.checked&&!v.checked){v.checked=!0;for(let h of s.querySelectorAll("input[type=checkbox]"))if(!h.checked){v.checked=!1;break}}},a=u("td",null,d,f),i.appendChild(a)}else d===null?a=u("td"):r[c]in n.decimals&&!(r[c]in n.date)&&!(r[c]in n.datetime)?(a=u("td"),a.style="text-align:right;",isNaN(d)?(a.appendChild(document.createTextNode(d)),a.style.backgroundColor="red",a.setAttribute("title","Expecting Numeric Value")):(a.appendChild(document.createTextNode(M(r[c],d))),a.setAttribute("title",d))):(a=u("td",null,null,document.createTextNode(d)),a.setAttribute("title",d)),a.ondblclick=function(f){j&&(R==0?ue(this):R!==this.parentNode.firstChild.id&&(ge(ce(document.getElementById(R).parentNode))?p("Alert!","You have unsaved changes"):(ae(document.getElementById(R).parentNode),ue(this))))},i.appendChild(a);c<D&&(a.classList.add(`C${c}`),a.classList.add("ZDX_R"),a.classList.add("STX"),a.classList.add("FXC"))}return t>0&&t<l.length&&i.childNodes[t].classList.add("selected_col"),i}document.getElementById("formatColumn").onclick=function(l){const t=y.querySelector("thead .selected_col");if(t){const e=document.getElementById("decimalPlaces"),o=document.getElementById("commaSeparator"),i=document.getElementById("localeString"),s=document.getElementById("displayCurrency"),a=document.getElementById("aggregateFunction"),c=document.getElementById("fieldType"),d=t.innerText;d in n.decimals?lovText.style.display="none":lovText.style.display="",e.parentElement.style.display="none",o.parentElement.style.display="none",i.parentElement.style.display="none",s.parentElement.style.display="none",a.parentElement.style.display="none",c.parentElement.style.display="";const f={freetext:"Free Text",autofiller:"Auto Filler",date:"Date",datetime:"Date Time",lov:"LOV",numeric:"Numeric"};if(c.innerHTML="",d in n.decimals&&!(d in n.date)&&!(d in n.datetime))c.add(new Option(f.numeric,"numeric")),c.add(new Option(f.date,"date")),c.add(new Option(f.datetime,"datetime"));else for(let h in f)h!=="numeric"&&c.add(new Option(f[h],h));if(d in n.date||d in n.datetime)c.add(new Option("Numeric","numeric")),c.value="date",d in n.datetime&&(c.value="datetime"),lovText.style.display="none";else if(d in n.decimals){e.parentElement.style.display="",o.parentElement.style.display="",i.parentElement.style.display="",s.parentElement.style.display="",a.parentElement.style.display="",c.value="numeric";const h=n.decimals[d],S=n.comma[d],E=n.locale[d],N=n.currency[d],m=n.aggregate[d];e.value=h,o.value=S,i.value=E,s.value=N,a.value=m}else{let h=[];d in n.lov&&n.lov[d].toLowerCase()!="freetext"?(c.value="lov",h=n.lov[d]):d in n.autofiller?(c.value="autofiller",h=n.autofiller[d]):d in n.date?(c.value="date",lovText.style.display="none"):(c.value="freetext",lovText.style.display="none"),n.query&&d in n.query?(lovText.value=n.query[d],lovText.style.display=""):h.length>0?(lovText.value=h.join(";"),lovText.style.display=""):lovText.value=""}new $(document.getElementById("modal-format-column")).show()}else p("Alert!","Please select a column")};const Ue=document.querySelector("#fieldType"),fe=document.querySelector("#lovText");Ue.addEventListener("change",l=>{decimalPlaces.parentElement.style.display="none",commaSeparator.parentElement.style.display="none",localeString.parentElement.style.display="none",displayCurrency.parentElement.style.display="none",aggregateFunction.parentElement.style.display="none",l.target.value=="date"||l.target.value=="datetime"||l.target.value=="freetext"||l.target.value=="numeric"?(fe.style.display="none",l.target.value=="numeric"&&(decimalPlaces.parentElement.style.display="",commaSeparator.parentElement.style.display="",localeString.parentElement.style.display="",displayCurrency.parentElement.style.display="",aggregateFunction.parentElement.style.display="")):fe.style.display=""});document.getElementById("updateFormats").onclick=async function(l){const t=new Object,e=y.querySelector("thead .selected_col").innerText,o=parseInt(document.getElementById("decimalPlaces").value),i=document.getElementById("aggregateFunction").value,s=parseInt(document.getElementById("commaSeparator").value),a=document.getElementById("fieldType").value,c=document.getElementById("lovText").value;let d=document.getElementById("localeString").value,f=document.getElementById("displayCurrency").value;if(f=="0"&&(f=0),d=="0"&&(d=0),a=="date"||a=="datetime")e in n.decimals&&(delete n.decimals[e],delete n.comma[e],delete n.locale[e],delete n.currency[e],delete n.aggregate[e]),t.LOV=a[0].toUpperCase()+a.slice(1),e in n.lov&&delete n.lov[e],e in n.autofiller&&delete n.autofiller[e],e in n.query&&delete n.query[e],e in n.date&&a!="date"?delete n.date[e]:e in n.datetime&&a!="date"&&delete n.datetime[e],n[a][e]=1;else if(a=="autofiller"){if(c!=="")if(t.LOV=`Autofiller | ${c}`,e in n.lov&&delete n.lov[e],n.query[e]=c,c.trim().toLowerCase().substring(0,6)=="select"){const E=await Y(_,c);n.autofiller[e]=E;let N=document.getElementById(`${e}_dataList`);N&&N.remove(),document.getElementById("dataList_div").appendChild(G(`${e}_dataList`,E))}else{let E=[];for(let m of c.trim().split(";"))m.trim().length>0&&E.push(m.trim());n.autofiller[e]=E;let N=document.getElementById(`${e}_dataList`);N&&N.remove(),document.getElementById("dataList_div").appendChild(G(`${e}_dataList`,E))}}else if(a=="lov"){if(c!=="")if(t.LOV=`Select | ${c}`,e in n.lov&&delete n.lov[e],c.trim().toLowerCase().substring(0,6)=="select"){n.query[e]=c;const E=await Y(_,c);n.lov[e]=E}else{let E=[];for(let N of c.trim().split(";"))N.trim().length>0&&E.push(N.trim());delete n.lov[e],n.lov[e]=E}}else if(a=="freetext")t.LOV="Freetext",e in n.lov&&delete n.lov[e],e in n.autofiller&&delete n.autofiller[e],e in n.date&&delete n.date[e],e in n.datetime&&delete n.datetime[e],e in n.query&&delete n.query[e];else if(pe[e]=="NUMERIC")e in n.lov&&delete n.lov[e],e in n.autofiller&&delete n.autofiller[e],e in n.date&&delete n.date[e],e in n.datetime&&delete n.datetime[e],e in n.query&&delete n.query[e],t.Decimals=o,t.Comma=s,t.Locale=d,t.Currency=f,t.Aggregate=i,n.decimals[e]=o,n.comma[e]=s,n.locale[e]=d,n.currency[e]=f,n.aggregate[e]=i;else{p("Alert","You can't convert text column to Numeric.");return}$.getInstance(document.getElementById("modal-format-column")).hide(),await K(_,C,e,t),J(),y.querySelector("tr.insert").remove(),y.querySelector("tbody").appendChild(te());for(let E of y.querySelectorAll("td.selected_col"))if(E.firstChild&&E.firstChild.tagName!=="INPUT")if(e in n.decimals){let N=parseFloat(E.getAttribute("title"));E.innerText=M(e,N)}else{let N=E.getAttribute("title");E.innerText=N}};function M(l,t){if(t==null)return"";const e=n.decimals[l],o={maximumFractionDigits:e,minimumFractionDigits:e,useGrouping:!1};let i=n.currency[l];const s=n.comma[l],a=n.locale[l];return i&&(o.style="currency",o.currency=i),s&&(o.useGrouping=!0),t.toLocaleString(a,o)}function ce(l){let t=[],e=y.querySelector("tr.headers").childNodes;for(const[o,i]of l.childNodes.entries())if(o==0)t.push(i.id);else{let s=i.firstChild.value;if(i.firstChild.classList.contains("awesomplete")&&(s=i.firstChild.firstChild.value),r[o]in n.decimals&&isNaN(s)&&!(r[o]in n.date)&&!(r[o]in n.datetime)){p("Alert!",`Please enter numeric value in ${r[o]} Column`);return}else if(s.trim()==""&&e[o].querySelector("u")){p("Alert!",`Please enter not null value in ${r[o]} Column`);return}else if(n.date&&r[o]in n.date){let a=s.split(" ");a[1]==="00:00:00"&&(s=a[0])}s.trim()==""||s.trim()=="null"&&r[o]in n.lov?s=null:r[o]in n.decimals&&!(r[o]in n.date)&&!(r[o]in n.datetime)&&(s=parseFloat(s)),t.push(s)}return t}function ze(){let l=!1;for(let t of document.querySelector(".headers").childNodes){let e=t.querySelector("span");e&&(e.classList.contains("fa-sort")||(l=!0,e.classList.contains("fa-sort-down")?e.classList.remove("fa-sort-down"):e.classList.contains("fa-sort-up")&&e.classList.remove("fa-sort-up"),e.classList.add("fa-sort")))}l&&(O=[],F={},T(r),ve())}document.getElementById("copyTable").onclick=async function(){document.getElementById("data-loader").style.display="";const l=await ie(_,C,r,Q,{},{},1,[],!1);if(l){if(document.getElementById("data-loader").style.display="none",l[1]>1e5){p("Alert!","Sorry! , Data exceeded maximum Limit");return}Ye(l[0])}};function Ze(l){navigator.clipboard.writeText(l).then(function(){document.getElementById("data-loader").style.display="none",p("Success","Copied to clipboard")},function(t){document.getElementById("data-loader").style.display="none",p("Alert!",`Error occured : ${t}`)})}function Ye(l){var t="",e,o;for(e=0;e<l.length;e++){for(o=0;o<l[e].length;o++)t+=(l[e][o]+"").replace(/[\n\t]+/g," "),o+1<l[e].length&&(t+="	");e+1<l.length&&(t+=`
`)}Ze(t)}document.getElementById("modal-file-upload").addEventListener("show.bs.modal",function(){document.getElementById("fileUpload").value=""});function Ge(l){let t="fa-sort";for(let e of O)if(l===e[0]){e[1]==="asc"?t="fa-sort-down":t="fa-sort-up";break}return t}document.getElementById("saveSort").onclick=ve;async function ve(){await Be(_,C,O),F={};for(let l of O)F[l[0]]=l[1];this&&p("Success","Sort saved successfully")}async function _e(){let l=await ke(_,C);O=l;for(let t of l)F[t[0]]=t[1]}function Ke(){for(let l of se.entries())["tablename","modelname"].includes(l[0].toLowerCase())||(Q[l[0]]=l[1].split(","))}function Ce(){const l=y.querySelector("table");for(var t=0,e=0;e<D;e++){t+=l.rows[0].cells[e].clientWidth+1;for(let o of l.rows)for(let i of o.cells)e==0&&i.classList.contains(`C${e}`)?i.style.left="0px":i.classList.contains(`C${e+1}`)&&(i.style.left=t+"px")}}document.getElementById("saveFreeze").onclick=async function(){const l=y.querySelector("thead .selected_col");if(l){const t=l.innerText;let e=r.indexOf(t)+1;e==D&&(e=0),await Te(_,C,e),D=e;for(let o of y.querySelectorAll("tr")){o.childNodes[r.indexOf(t)].classList.remove("selected_col");for(let[i,s]of o.childNodes.entries())i<D?(s.classList.add(`C${i}`),o.classList.contains("headers")||o.classList.contains("lovRow")?s.classList.add("ZDX_H"):s.classList.add("ZDX_R","STX","FXC")):o.classList.contains("headers")||o.classList.contains("lovRow")?(s.style.left="",s.classList.remove(`C${i}`,"ZDX_H")):s.classList.remove("ZDX_R","STX","FXC")}Ce()}else p("Alert!","Please select a column")};function Qe(l){l=new Date(l);const t=new Date(1899,11,30),o=(l-t)/(1e3*60*60*24);return Math.floor(o)}function Je(l){l=new Date(l),l.setHours(0,0,0,0);const t=new Date(1899,11,30),e=(l-t)/(1e3*60*60*24);return Math.floor(e+1)}
