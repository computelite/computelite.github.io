import"./pixel.PHV1U_RE.js";/* empty css              */import{e as executeQuery,x as executePython,b as get_cl_element,C as consoleNotebookOutput,D as drawImageFromPython,c as confirmBox,v as fetchData,w as addDefaultModel}from"./scc.CetyKaGn.js";import{C as CodeMirror}from"./codemirror.BeiFTLV5.js";import"./python.CRxt_0kd.js";const isPyProxy=function(t){return!!t&&t.$$!==void 0&&t.$$.type==="PyProxy"};function createCodeMirrorEditor(kernelId,modelName,CellId,content){const cell=document.getElementById(kernelId);var editor=CodeMirror(cell.querySelector("div.computelite-text-editor"),{lineNumbers:!0,lineWrapping:!0,mode:"python",autoRefresh:!0,autofocus:!0,tabSize:4,indentUnit:4,extraKeys:{"Ctrl-Enter":async cm=>{cm.getInputField().blur();const query=editor.getValue(),cell=document.getElementById(kernelId);cell.querySelector(".cell-bottom").innerHTML="",cell.querySelector(".sidebar-inner")&&(cell.querySelector(".sidebar-inner").innerHTML="");const btn=cell.querySelector("span.fa-regular");btn&&btn.classList.contains("fa-play-circle")&&(btn.classList.remove("fa-play-circle"),btn.classList.add("fa-hourglass"));const updateQuery="UPDATE S_Notebook SET CellContent = ? WHERE CellId = ?";await executeQuery("updateData",modelName,updateQuery,[query,CellId]);let res=await executePython("execute","notebook",query,"Default",modelName,[],null,[],[],kernelId);btn&&btn.classList.contains("fa-hourglass")&&(btn.classList.add("fa-play-circle"),btn.classList.remove("fa-hourglass"));const htmlOutput=get_cl_element("div");if(cell.querySelector(".cell-bottom").appendChild(htmlOutput),res.result!=null){let val=await convertResult(res.result.display,res.result.value);if(val!==void 0)if(val instanceof HTMLElement)htmlOutput.appendChild(val),val.querySelectorAll('script[type|="text/javascript"]').forEach(function(e){e.textContent!==null&&eval(e.textContent)});else if(isPyProxy(val)){let hadHTMLOutput=!1;if(val._repr_html_!==void 0){let result=val._repr_html_();if(typeof result=="string"){let div=get_cl_element("div","rendered_html cell-output-html");div.appendChild(new DOMParser().parseFromString(result,"text/html").body.firstChild),htmlOutput.appendChild(div),div.querySelectorAll('script[type|="text/javascript"]').forEach(function(e){e.textContent!==null&&eval(e.textContent)}),hadHTMLOutput=!0}}hadHTMLOutput||consoleNotebookOutput(cell,[val])}else val instanceof Uint8Array?drawImageFromPython(val):consoleNotebookOutput(cell,[res.result.value])}else res.stderr!=null&&consoleNotebookOutput(cell,[res.stderr],"error")}}});return editor.addKeyMap({Backspace:function(t){const l=t.getCursor(),o=t.getLine(l.line),n=t.getOption("indentUnit"),a=o.slice(0,l.ch);if(/^\s*$/.test(a)&&l.ch>0){const i=Math.max(0,l.ch-n);t.setCursor({line:l.line,ch:i})}else t.execCommand("delCharBefore")}}),setTimeout(()=>{editor.refresh(),editor.setValue(content)},10),editor}async function convertResult(t,l){if(t==="default")return l;if(t==="html"){let o=get_cl_element("div","rendered_html cell-output-html");return o.appendChild(new DOMParser().parseFromString(l,"text/html").body.firstChild),o}else return l}let nanoid=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((l,o)=>(o&=63,o<36?l+=o.toString(36):o<62?l+=(o-26).toString(36).toUpperCase():o>62?l+="-":l+="_",l),"");const params=new URLSearchParams(window.location.search);let modelName=params.get("modelName");const container=document.getElementById("cellContainer");window.onload=async function(){let t=await executeQuery("init");if(!t||t.msg!="Success"){confirmBox("Alert!","Some error occured while initializing sqlite.");return}else if(!modelName)if((await fetchData("home","getUserModels")).some(c=>c[0]==="Default_DB"))modelName="Default_DB";else{let c=await addDefaultModel();if(c.length>0)modelName=c[0];else{confirmBox("Alert!","Model Name not found in the URL.");return}}const o=await executeQuery("fetchData",modelName,"SELECT CellId,CellContent FROM S_Notebook");for(let r of o)createCodeEditor(r[0],r[1]);const a=await executeQuery("fetchData",modelName,"SELECT FilePath,FileData FROM S_ExecutionFiles WHERE Filename is NOT NULL AND Status = 'Active' "),d=await executeQuery("fetchData",modelName,"SELECT FileName,FileBlob FROM S_DataFiles WHERE FileType = 'Input'"),s=await executeQuery("fetchData",modelName,"SELECT WheelName,WheelBlob FROM S_PackageWheels");document.getElementById("loadingOverlay").classList.remove("hidden"),await executePython("init","notebook","","Default",modelName,a,"",d,s),document.getElementById("loadingOverlay").classList.add("hidden")};function createCodeEditor(t,l=""){const o=nanoid(),n=get_cl_element("computelite-cell","cell-grid cell-container celltype-python",o);n.setAttribute("tabindex","0");const a=get_cl_element("div","cell-controls cell-controls-left cell-controls-left-top"),i=get_cl_element("button","btn cell-controls-button py-1");i.title="Run Cell";const d=get_cl_element("span","fa-regular fa-play-circle");d.style.fontSize="16px",i.appendChild(d),a.appendChild(i);const m=get_cl_element("div","cell-top flush");let s=get_cl_element("div");s.style="position: relative;width: 100%;height: 0;";const r=get_cl_element("div","computelite-text-editor-controls",null,get_cl_element("div"));r.firstChild.appendChild(get_cl_element("button","btn btn-small transparent p-1 px-1 me-1",null,get_cl_element("span","fa-solid fa-trash-alt"))),r.querySelector("button").title="Delete Cell",r.querySelector("span").style="color: #00000066;",r.querySelector("button").onclick=async function(){await executeQuery("deleteData",modelName,"DELETE FROM S_Notebook WHERE CellId = ?",[t])&&n.remove()};const u=get_cl_element("computelite-text-editor"),c=get_cl_element("div","computelite-text-editor");s.appendChild(r),u.appendChild(s),u.appendChild(c),m.appendChild(u),n.appendChild(a),n.appendChild(m);const p=get_cl_element("div","cell-bottom");n.appendChild(p),container.appendChild(n),createCodeMirrorEditor(o,modelName,t,l)}document.getElementById("addCell").onclick=async function(){if(!modelName){confirmBox("Alert!","Model Name not found in the URL.");return}const l=await executeQuery("insertData",modelName,"INSERT INTO S_Notebook (CellContent) VALUES (?)",[""]);createCodeEditor(l)};
