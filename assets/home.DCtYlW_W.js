import"./pixel.PHV1U_RE.js";import{e as f,c as m,y as Y,v as H,w as _,b as o,z as Z,A as J,u as K,d as X}from"./scc.BpBw4536.js";import{M as y}from"./bootstrap.esm.CkDf0L-y.js";const g=document.getElementById("scc-one-modal");let S={},A=null,D=null;const ee=new URLSearchParams(window.location.search),q=ee.get("modelName"),j={"Sample DB":"fas fa-database","Supply Planning":"fas fa-database"};function te(l,t){let a=l.replace(/\s/g,"_"),n=o("div","accordion-item border-light mb-0",null,o("h2","accordion-header",a+"_head",o("button","accordion-button collapsed",null,o("span","h6 mb-0 font-weight-bold",null,document.createTextNode(l)))));n.querySelector("button").setAttribute("type","button"),n.querySelector("button").setAttribute("data-bs-toggle","collapse"),n.querySelector("button").setAttribute("aria-expanded","false"),n.querySelector("button").setAttribute("data-bs-target","#"+a),n.querySelector("button").setAttribute("aria-controls",a);let d=o("div","accordion-collapse collapse",a,o("div","accordion-body",null,o("table","table table-hover",null,o("tbody",null,null,null))));d.setAttribute("aria-labelledby",a+"_head"),d.setAttribute("data-bs-parent","#tableGroup");for(let e of t){let i=o("tr",null,null,o("td",null,null,document.createTextNode(e[1])));i.onclick=function(){const c=document.getElementById("availableModal").querySelector("li.selectedValue");window.open(`/tableDisplay.html?tableName=${e[0]}&modelName=${c.innerText}`)},i.setAttribute("tableName",e[0]),d.querySelector("tbody").appendChild(i)}return n.appendChild(d),n}document.addEventListener("DOMContentLoaded",async function(){let l=await f("init");if(!l||l.msg!="Success"){m("Alert!","Some error occured while initializing sqlite.");return}if(q){await Y("/home/get-attached-model",{modelName:q});const n=window.location.origin+window.location.pathname;history.replaceState(null,"",n)}setTimeout(le,400);const t=document.getElementById("shareBtn");t.classList.add("blink"),document.querySelectorAll(".modal").forEach(n=>{y.getInstance(n)||new y(n)}),document.getElementById("modal-createView").addEventListener("hide.bs.modal",function(){document.getElementById("viewName").value="",document.getElementById("query-input").value=""}),document.getElementById("editorBtn").onclick=async function(){const n=document.getElementById("availableModal").querySelector("li.selectedValue").innerText;if(!n){m("Alert!","Please select a model");return}window.open(`/sqlEditor.html?tableName=V_TEMPV&modelName=${n}`)},document.getElementById("availInpFiles").onclick=function(){document.getElementById("modal-input-files").querySelector("h2").innerText="Input Files",L()},document.getElementById("availOutFiles").onclick=function(){document.getElementById("modal-input-files").querySelector("h2").innerText="Output Files",ge()},document.getElementById("shareBtn").onclick=function(){const n=document.getElementById("availableModal").querySelector("li.selectedValue");if(!n){m("Alert!","Please select a model");return}const d=n.innerText,e=n.getAttribute("project");window.open(`/editorPage.html?projectName=${e}&modelName=${d}`)},document.getElementById("closeOutput").onclick=function(){document.getElementById("outputDiv").style.display="none"},document.getElementById("ok-view").onclick=pe,document.getElementById("deleteModel").onclick=R.bind(null,!0),document.getElementById("removeModel").onclick=R.bind(null,!1),document.getElementById("addNew").onclick=oe.bind(null,"Add New Model",!1),document.getElementById("downloadAllFiles").onclick=Ee,document.getElementById("addExisting").onclick=ae,document.getElementById("saveAs").onclick=de,document.getElementById("uploadModel").onclick=ie,document.getElementById("downloadModel").onclick=ce,document.getElementById("uploadExcel").onclick=re,document.getElementById("downloadExcel").onclick=ue,document.getElementById("vacuum").onclick=me,document.getElementById("saveFiles").onclick=be,document.getElementById("uploadPackage").onclick=we,document.getElementById("downloadOutput").onclick=Te,await H("init","editor"),t.classList.remove("blink")});async function le(){document.getElementById("tableGroup").innerHTML="";let l=await _("home","getUserModels");l.length==0&&(await _("home","addNewModel",{model_name:"Default_DB",model_template:"Sample DB",project_name:"Default",db_user:"",password:"",host:"",port:0,db_type:"SQLITE"})).msg==="Success"&&l.push(["Default_DB","Sample DB","Default","SQLITE"]),ne(l)}function ne(l){let t=document.getElementById("availableModal");t.innerHTML="";for(let a of l)t.appendChild(N(a));q&&t.lastChild?t.lastChild.click():t.firstChild&&t.firstChild.click()}function N(l){let t=o("li","nav-item mb-0",null,null),a=o("a","nav-link p-2 rounded-0");return a.appendChild(o("span","d-block text-left",null,null)),a.firstChild.appendChild(o("span",`${j[l[1]]} pe-2`)),a.firstChild.appendChild(document.createTextNode(l[0])),t.appendChild(a),t.setAttribute("project",l[2]),t.setAttribute("template",l[1]),t.setAttribute("dbtype",l[3]),t.onclick=async function(n){if(t.getAttribute("project"),document.getElementById("outputTxt").innerHTML="",!this.classList.contains("selectedValue")){await _("home","getVersion",{model_name:this.innerText})!=="1.0.4"&&await ve(this.innerText,"1.0.4");for(let e of this.parentNode.querySelectorAll("li.selectedValue"))e.classList.remove("selectedValue");M(this.innerText,l[1]),this.classList.add("selectedValue"),n.preventDefault()}await ye(this.innerText)},t}async function M(l,t){document.getElementById("tableGroup").innerHTML="";const a=await _("home","fetchTableGroups",{model_name:l});for(let n in a)document.getElementById("tableGroup").appendChild(te(n,a[n]))}function Q(l,t="fa-server",a=null){let n=o("ul","tree");for(let d in l){n.appendChild(document.createElement("li"));let e=P(d,t);n.appendChild(e),e.onclick=function(){let i=e.nextElementSibling;if(e.firstChild.checked){e.firstChild.checked=!1;for(let c of i.childNodes)c.firstChild.checked&&(c.firstChild.checked=!1)}else{e.firstChild.checked=!0;for(let c of i.childNodes)c.firstChild.checked||(c.firstChild.checked=!0)}},n.appendChild(o("ul","childList TreeMembers"));for(let i of l[d]){let c=P(i[0],j[i[1]]);a||(c.onclick=function(r){if(c.firstChild.checked)c.firstChild.checked=!1,e.firstChild.checked&&(e.firstChild.checked=!1);else{c.firstChild.checked=!0,e.firstChild.checked=!0;for(let s of this.parentNode.childNodes)s.firstChild.checked||(e.firstChild.checked=!1)}}),n.lastChild.appendChild(c)}}return o("div","card-body scc-box",null,n)}function P(l,t){let a=o("li",null,null,o("input","inputcheckbox"));a.firstChild.setAttribute("type","checkbox");let n=o("label","checkBox-label",null,o("span",`fas ${t}`));return n.appendChild(document.createTextNode(l)),a.appendChild(n),a}function E(l,t){const a=g.querySelector(".modal-header h2");a.innerHTML="",a.innerText=l;const n=g.querySelector(".modal-body");n.innerHTML="";const d=g.querySelector(".modal-footer");d.innerHTML="";const e=o("button","btn btn-tertiary",null,document.createTextNode("Cancel"));e.setAttribute("type","button"),e.setAttribute("data-bs-dismiss","modal");const i=o("button","btn btn-primary ml-auto",null,document.createTextNode(t));return i.setAttribute("type","button"),d.appendChild(e),d.appendChild(i),[n,i]}function B(l,t,a,n,d=[],e="",i="",c="text"){let r;const s=o("div","row row-header align-items-center mb-4",l);let u=o("div","col-12 col-sm-4 align-self-center",null,o("label","my-2",null,document.createTextNode(t)));if(r=o("div","col-12 col-sm"),n=="select"){const p=o("select","form-select",a);(d.includes("Default")||d.length==0)&&p.appendChild(o("option",null,null,document.createTextNode("Default")));for(let h of d)if(h!="Default"){let b=o("option",null,null,document.createTextNode(h));p.appendChild(b)}p.firstChild&&(p.firstChild.setAttribute("selected",""),r.appendChild(p))}else{const p=o("div","input-group",null,o("input","form-control",a));p.firstChild.setAttribute("type",c),p.firstChild.setAttribute("placeholder",e),i.trim()!=""&&p.appendChild(o("span","input-group-text",null,o("span",i))),r.appendChild(p)}return s.appendChild(u),s.appendChild(r),s}function oe(l,t=!1){const[a,n]=E(l,"Add"),d=o("div","form-group");d.appendChild(B("name_div","Model Name","db_name","normal",[],"","fas fa-database")),t?d.appendChild(B("path_div","Model Path","db_path","normal")):d.appendChild(B("template_div","Model Template","model_template","select",["Sample DB"])),a.appendChild(d),n.onclick=async function(e){const i=document.getElementById("db_name").value;if(i.trim()==""||!$(i)){m("Alert!","Please enter valid model name");return}for(let b of document.getElementById("availableModal").querySelectorAll("li"))if(i.trim()==b.innerText){m("Alert!",`Model already active with same name ${i}`);return}let c=document.getElementById("model_template"),r="Sample DB";c&&(r=c.value);let s="Default";y.getInstance(g).hide();const h=await _("home","addNewModel",{model_name:i,model_template:r,project_name:s,db_user:"",password:"",host:"",port:0,db_type:"SQLITE"});if(h.msg==="Success"){let b=document.getElementById("availableModal");b.appendChild(N([i,r,s,"SQLITE"])),b.lastChild.click(),m("Success!","New Model added")}else m("Alert!",h.msg)}}async function ae(){const[l,t]=E("Add Existing Models","Add"),a=new Object,n=await _("home","getExistingModels");let d=new Object;for(let e of n){let i=e[1],c=e[0];a[c]=[i,e[2],e[3]],i in d?d[i].push([c,e[2]]):d[i]=[[c,e[2]]]}l.appendChild(Q(d)),t.onclick=async function(){let e=[];for(let r of document.getElementById("availableModal").querySelectorAll("li"))e.push(r.innerText);let i={},c=[];for(let r of l.querySelectorAll(".TreeMembers li"))if(r.parentNode.classList.contains("childList")&&r.firstChild.checked){if(e.includes(r.innerText)){m("Alert!",`Model Already Active with name ${r.innerText}`);return}let s=r.parentNode.previousElementSibling.innerText;if(s in i||(i[s]=[]),i[s].push(r.innerText),c.includes(r.innerText)){m("Alert!","You Cannot Add more than one model of same name");return}c.push(r.innerText)}if(Object.keys(i).length>0){y.getInstance(g).hide(),await _("home","addExistingModels",{model_list:c,projects_dict:i});let s=document.getElementById("availableModal");for(let u of c)s.appendChild(N([u,a[u][1],a[u][0],a[u][2]]))}else y.getInstance(g).hide()}}function R(l){let t="Hide",a="Hide Models";l&&(t="Delete",a="Delete Models");const[n,d]=E(a,t);let e=new Object;for(let i of document.getElementById("availableModal").childNodes){let c=i.getAttribute("project"),r=i.getAttribute("template"),s=i.innerText;c in e?e[c].push([s,r]):e[c]=[[s,r]]}n.appendChild(Q(e)),d.onclick=async function(){let i=[],c={};for(let r of n.querySelectorAll(".TreeMembers li"))if(r.parentNode.classList.contains("childList")&&r.firstChild.checked){i.push(r.innerText);let s=r.parentNode.previousElementSibling.innerText;s in c||(c[s]=[]),c[s].push(r.innerText)}if(Object.keys(c).length>0){y.getInstance(g).hide(),await _("home","deleteModel",{projects_dict:c,del_opt:l});let s=document.getElementById("availableModal");for(let u of s.querySelectorAll("li"))i.indexOf(u.innerText)>-1&&u.remove();s.firstChild?s.firstChild.click():document.getElementById("tableGroup").innerHTML="",m("Success!","Model removed successfully")}else m("Alert!","Please select atleast one model")}}function de(l){const t=document.getElementById("availableModal").querySelector("li.selectedValue");if(!t){m("Alert!","Please select a model");return}if(t.getAttribute("dbtype")!="SQLITE"){m("Alert!","Method is applicable only for SQLITE type models");return}else{const a=t.innerText,n=t.getAttribute("project"),d=t.getAttribute("template"),e=t.getAttribute("dbtype"),[i,c]=E("Save As","Save"),r=o("div","form-group mb-4");r.appendChild(B("new_modelName_div","New Model Name","new_model_name","normal",[],"","fas fa-database")),i.appendChild(r),c.onclick=async function(s){const u=document.getElementById("new_model_name").value;if(u.trim()==""||!$(u)){m("Alert!","Please enter valid model name");return}for(let I of document.getElementById("availableModal").querySelectorAll("li"))if(u.trim()==I.innerText){m("Alert!",`Model already active with same name ${u}`);return}y.getInstance(g).hide();const h=await _("home","saveAsModel",{new_model_name:u,new_model_template:d,project_name:n,model_name:a});if(h.message.indexOf("Invalid")>-1){m("Alert",h.message);return}let b=document.getElementById("availableModal");b.appendChild(N([u,d,n,e])),b.lastChild.click(),m("Success!","Save As Model added")}}}function ie(l){const t=document.getElementById("availableModal").querySelector("li.selectedValue");if(!t){m("Alert!","Please select a model");return}const a=t.innerText;t.getAttribute("template");const[n,d]=E("Restore Model","Upload"),e=o("input","form-control"),i=o("div","input-group",null,e);e.setAttribute("type","file"),e.setAttribute("accept",".db, .sqlite3"),n.appendChild(i),d.onclick=async function(c){e.files[0]?(d.setAttribute("disabled",""),d.innerHTML='<span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>',await Z("home","uploadModel",e.files[0],{model_name:a}),e.value=null,d.removeAttribute("disabled",""),d.innerHTML="Upload",y.getInstance(g).hide(),m("Success!","Model uploaded successfully"),M(a)):m("Alert!","Please choose a model")}}async function ce(l){let t=document.getElementById("data-loader");const a=document.getElementById("availableModal").querySelector("li.selectedValue");if(!a){m("Alert!","Please select a model");return}const n=a.innerText,d=a.getAttribute("project");t.style.display="",await _("home","downloadModel",{model_name:n,project_name:d}),t.style.display="none"}function re(l){const t=document.getElementById("availableModal").querySelector("li.selectedValue");if(!t){m("Alert!","Please select a model");return}const a=t.innerText,[n,d]=E("Upload Excel","Upload"),e=o("input","form-control"),i=o("div","input-group",null,e);e.setAttribute("type","file"),e.setAttribute("accept","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),n.appendChild(i),d.onclick=async function(c){A=e.files[0],A?(d.setAttribute("disabled",""),d.innerHTML='<span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>',S={},S=await J(a,[],A),y.getInstance(document.getElementById("scc-one-modal")).hide(),new y(document.getElementById("modal-uploadExcel-info")).show(),e.value=null,d.innerHTML="Upload",d.removeAttribute("disabled","")):m("Alert!","Please choose a file")}}document.getElementById("modal-uploadExcel-info").addEventListener("show.bs.modal",function(){const l=this.querySelector(".modal-body");l.innerHTML="";const t=o("tr"),a=o("div","form-group",null,o("table","table table-bordered table-sm",null,o("thead",null,null,t)));a.style.maxHeight="300px",a.style.overflowY="auto",t.appendChild(o("td","text-center",null,o("h6","m-0",null,document.createTextNode("Sheet Name")))),t.appendChild(o("td","text-center",null,o("h6","m-0",null,document.createTextNode("Upload Option"))));const n=o("tbody");a.firstChild.appendChild(n),l.appendChild(a);for(let d in S){let e=o("tr","");e.appendChild(o("td",null,null,document.createTextNode(d)));const i=o("select","form-select");i.style="line-height:1 !important;";const c=[{value:"purgeAndUpload",text:"Purge and Upload"},{value:"createAndUpload",text:"Drop Table and Upload"},{value:"ignore",text:"Ignore"}],r=[{value:"ignore",text:"Ignore"},{value:"createAndUpload",text:"Create and Upload"}];S[d][0]==="New"?r.forEach(u=>{const p=o("option");p.value=u.value,p.textContent=u.text,i.appendChild(p)}):c.forEach(u=>{const p=document.createElement("option");p.value=u.value,p.textContent=u.text,u.value=="ignore"&&S[d][1]!="Input"&&p.setAttribute("Selected",""),i.appendChild(p)});let s=o("td","text-center",null,i);e.appendChild(s),n.appendChild(e)}});document.getElementById("saveFileName").onclick=async function(){this.setAttribute("disabled",""),this.innerHTML='<span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>';const l=document.getElementById("availableModal").querySelector("li.selectedValue"),t=l.innerText;l.getAttribute("template");const a=document.getElementById("modal-uploadExcel-info").querySelector("tbody"),n={};for(let e of a.querySelectorAll("tr")){const i=e.firstElementChild.innerText,c=e.querySelector("select").value;n[i]=c}const d=await K(t,Object.keys(n),A,n);y.getInstance(document.getElementById("modal-uploadExcel-info")).hide(),m("Success!","Excel uploaded successfully"),se(d,n),M(t),this.innerText="Upload",this.removeAttribute("disabled")};function se(l,t){const[a,n]=E("Status","OK"),d=o("tr",null,null,o("td",null,null,document.createTextNode("SheetName"))),e=o("div","form-group mb-4",null,o("table","table table-bordered table-sm",null,o("thead",null,null,d)));e.style.maxHeight="300px",e.style.overflowY="auto",e.style.overflowX="auto",d.appendChild(o("td",null,null,document.createTextNode("Status"))),d.appendChild(o("td",null,null,document.createTextNode("Msg")));const i=o("tbody");e.firstChild.appendChild(i);for(let c in l){let r=o("tr");r.appendChild(o("td",null,null,document.createTextNode(c)));let s,u;!isNaN(l[c])&&t[c]=="createAndUpload"?(s="Create And Uploaded",u=`${l[c]} rows inserted`):isNaN(l[c]&&t[c]=="purgeAndUpload")?(s="Errored",u=l[c]):(s="Purge And Uploaded",u=`${l[c]} rows inserted`),r.appendChild(o("td",null,null,document.createTextNode(s))),r.appendChild(o("td",null,null,document.createTextNode(u))),i.appendChild(r)}a.appendChild(e),new y(document.getElementById("scc-one-modal")).show(),n.onclick=function(){y.getInstance(g).hide()}}function ue(l){const t=document.getElementById("availableModal").querySelector("li.selectedValue");if(!t){m("Alert!","Please select a model");return}const a=[];for(let r of document.getElementById("tableGroup").querySelectorAll("button.accordion-button"))a.push(r.innerText);const n=t.innerText,[d,e]=E("Download Excel","Download"),i=o("input","form-check-input round-check"),c=o("div","form-check",null,i);i.setAttribute("type","checkbox"),i.checked=!0,c.appendChild(o("label","form-check-label",null,document.createTextNode("Input Tables Only")));for(let r of a){let s=c.cloneNode(!0);s.lastChild.innerText=r,d.appendChild(s)}e.onclick=async function(r){let s=[];for(let h of d.querySelectorAll("input:checked"))s.push(h.parentNode.lastChild.innerText);y.getInstance(g).hide();let p=document.getElementById("dl_progress_div");p.querySelector("div").innerText="Downloading",p.style.display="",await X(n,[],s),p.querySelector("div").innerText="Running",p.style.display="none"}}async function me(l){let t=document.getElementById("data-loader");const a=document.getElementById("availableModal").querySelector("li.selectedValue");if(!a){m("Alert!","Please select a model");return}const n=a.innerText;t.style.display="",await f("executeQuery",n,"VACUUM"),t.style.display="none",m("Success!","Model vacuumed successfully")}async function pe(){const l=document.getElementById("viewName").value,t=document.getElementById("query-input").value,a=document.getElementById("availableModal").querySelector("li.selectedValue").innerText;if(!a){m("Alert!","Please select a model");return}(l.trim()==""||t.trim()=="")&&m("Alert!","Please make sure that View Name and Query was entered"),await _("home","checkOrCreateView",{view_name:l,view_query:t,model_name:a,isExist:!1}),y.getInstance(document.getElementById("modal-createView")).hide(),m("Success","View created successfully"),M(a)}function $(l){var t=/^[a-zA-Z0-9_]+$/;return t.test(l)}function fe(l){const t=document.getElementById("outputTxt");if(l){const a=document.createElement("div");a.textContent=`Error: ${l}`,a.style.color="red",t.appendChild(a)}}async function ye(l){const t=document.getElementById("taskDiv");t.innerHTML="";const n=await f("fetchData",l,"SELECT TaskId,TaskName,TaskDisplayName FROM S_TaskMaster");for(const[d,e,i]of n){const c=o("li",null,null,o("a","dropdown-item",null,document.createTextNode(i)));c.onclick=async function(){const r=document.getElementById("myCanvas");document.getElementById("loadingOverlay").classList.remove("hidden"),document.getElementById("outputDiv").style.display="",document.getElementById("outputTxt").innerHTML="",D=null;const s=document.getElementById("availableModal").querySelector("li.selectedValue"),u=s.getAttribute("project"),h=await f("fetchData",s.innerText,"SELECT FilePath,FileData,FileName FROM S_ExecutionFiles WHERE FileName IS NOT NULL AND Status = 'Active' ");let b=null;h.forEach(x=>{x[0]===e&&(b=x[1])});const C=await f("fetchData",s.innerText,"SELECT FileName,FileBlob FROM S_DataFiles WHERE FileType = 'Input'"),z=await f("fetchData",s.innerText,"SELECT WheelName,WheelBlob FROM S_PackageWheels");await f("updateData",s.innerText,"UPDATE S_Taskmaster SET TaskLastRunDate = ? WHERE TaskId = ? ",[he(),d]);const O=await F(e,"Started",null,null,d);let w=await H("executeScript","editor",b,u,s.innerText,h,null,C,z);if(w.stderr)F(e,"Errored",w.stderr,O);else{if(w.blob){const x=r.getContext("2d");x.clearRect(0,0,r.width,r.height),D=w.blob;const T=await createImageBitmap(w.blob),v=Math.min(r.width/T.width,r.height/T.height),U=(r.width-T.width*v)/2,G=(r.height-T.height*v)/2;x.drawImage(T,U,G,T.width*v,T.height*v),new y(document.getElementById("modal-show-output")).show()}F(e,"Completed",null,O),w.outputFiles&&w.outputFiles.length>0&&(await f("deleteData",s.innerText,"DELETE FROM S_DataFiles WHERE FileType = 'Output'"),w.outputFiles.forEach(async([T,v])=>{await f("insertData",s.innerText,`INSERT INTO S_DataFiles (FileName,FileType,FileBlob) 
                                            VALUES (?, ?, ?) ON CONFLICT (FileName,FileType) DO UPDATE SET FileBlob = ? `,[T,"Output",v,v])}))}document.getElementById("loadingOverlay").classList.add("hidden"),fe(w.stderr)},t.appendChild(c)}}function he(){const l=new Date,t=l.getFullYear(),a=String(l.getMonth()+1).padStart(2,"0"),n=String(l.getDate()).padStart(2,"0"),d=String(l.getHours()).padStart(2,"0"),e=String(l.getMinutes()).padStart(2,"0"),i=String(l.getSeconds()).padStart(2,"0");return`${t}-${a}-${n} ${d}:${e}:${i}`}async function F(l,t,a=null,n=null,d=null){const e=document.getElementById("availableModal").querySelector("li.selectedValue");if(n)await f("updateData",e.innerText,`UPDATE T_TaskLogs SET TaskStatus = ?,ErrorMsg = ?, EndDate = datetime('now', 'localtime')
                     WHERE TaskName = ? AND Id = ? `,[t,a,l,n]);else return await f("insertData",e.innerText,"INSERT INTO T_TaskLogs (TaskId,TaskName,TaskStatus,EndDate) VALUES (?, ?, ?, datetime('now', 'localtime'))",[d,l,t])}async function be(){this.setAttribute("disabled",""),this.innerHTML='<span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>';const l=document.getElementById("availableModal").querySelector("li.selectedValue"),t=document.getElementById("inpFiles");if(t.files.length>0){await f("executeQuery",l.innerText,"DELETE FROM S_DataFiles;",["script"]);for(const n of t.files){const d=await n.arrayBuffer();await f("insertData",l.innerText,`INSERT INTO S_DataFiles (FileName,FileType,FileBlob) 
                            VALUES (?, ?, ?) ON CONFLICT (FileName,FileType) DO UPDATE SET FileBlob = ? `,[n.name,"Input",new Uint8Array(d),new Uint8Array(d)])}this.removeAttribute("disabled",""),this.innerHTML="Upload",y.getInstance(document.getElementById("modal-upload-files")).hide(),m("Success","Files Upload Successfully.")}t.value=null}async function L(){const l=document.getElementById("modal-input-files").querySelector(".modal-body");l.innerHTML="";const t=document.getElementById("availableModal").querySelector("li.selectedValue"),n=await f("fetchData",t.innerText,"SELECT FileId,FileName FROM S_DataFiles WHERE FileType = 'Input' "),d=o("tr"),e=o("div","form-group",null,o("table","table table-bordered table-sm",null,o("thead",null,null,d)));e.style.maxHeight="300px",e.style.overflowY="auto";const i=o("tbody");e.firstChild.appendChild(i),l.appendChild(e);for(let s of n){const u=o("tr","d-flex align-items-center");u.appendChild(o("td","w-100",null,document.createTextNode(s[1])));const p=o("td","input-file-icon m-0 px-2");let h=o("span","fa fa-trash");h.onclick=_e.bind(null,s[1],s[0]),p.appendChild(h);const b=o("td","input-file-icon m-0 px-2");let I=o("span","fa fa-download");I.onclick=W.bind(null,s[1],s[0]),b.appendChild(I);const C=o("td","input-file-icon m-0 px-2");let k=o("span","fa fa-upload");k.onclick=V.bind(null,s[1],s[0]),C.appendChild(k),u.appendChild(p),u.appendChild(C),u.appendChild(b),i.appendChild(u)}const c=o("div","d-flex justify-content-end");let r=o("button","btn btn-primary",null,document.createTextNode("Add File"));c.appendChild(r),l.appendChild(c),r.onclick=V}async function ge(){const l=document.getElementById("modal-input-files").querySelector(".modal-body");l.innerHTML="";const t=document.getElementById("availableModal").querySelector("li.selectedValue"),n=await f("fetchData",t.innerText,"SELECT FileId,FileName FROM S_DataFiles WHERE FileType = 'Output' "),d=o("tr"),e=o("div","form-group",null,o("table","table table-bordered table-sm",null,o("thead",null,null,d)));e.style.maxHeight="300px",e.style.overflowY="auto";const i=o("tbody");e.firstChild.appendChild(i),l.appendChild(e);for(let c of n){const r=o("tr","d-flex align-items-center");r.appendChild(o("td","w-100",null,document.createTextNode(c[1])));const s=o("td","input-file-icon m-0 px-2");let u=o("span","fa fa-download");u.onclick=W.bind(null,c[1],c[0]),s.appendChild(u),r.appendChild(s),i.appendChild(r)}}async function _e(l,t){const a=document.getElementById("availableModal").querySelector("li.selectedValue");await f("deleteData",a.innerText,"DELETE FROM S_DataFiles WHERE FileType = 'Input' AND FileId = ? AND FileName = ? ",[t,l]),L()}async function W(l,t){let a=document.getElementById("modal-input-files").querySelector("h2").innerText.indexOf("Input")>-1?"Input":"Output";const n=document.getElementById("availableModal").querySelector("li.selectedValue"),e=await f("fetchData",n.innerText,"SELECT FileName,FileBlob FROM S_DataFiles WHERE FileType = ? AND FileID = ? AND FileName = ?",[a,t,l]);if(e){const c=new Blob([e[0][1]]);if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(c);return}const r=window.URL.createObjectURL(c);var i=document.createElement("a");i.href=r,i.download=l,i.click(),setTimeout(function(){window.URL.revokeObjectURL(r)},1e3)}else m("Alert!","No File Exists")}function V(l=null,t=null){y.getInstance(document.getElementById("modal-input-files")).hide();const a=document.getElementById("availableModal").querySelector("li.selectedValue"),[n,d]=E("Upload Excel","Upload"),e=o("input","form-control"),i=o("div","input-group",null,e);e.setAttribute("type","file"),n.appendChild(i),d.onclick=async function(c){if(e.files[0]){d.setAttribute("disabled",""),d.innerHTML='<span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>';const r=await e.files[0].arrayBuffer();l&&t?await f("updateData",a.innerText,"UPDATE S_DataFiles SET FileBlob = ? WHERE FileType = 'Input' AND FileName = ? AND FileId = ? ",[e.files[0].name,new Uint8Array(r),l,t]):await f("insertData",a.innerText,"INSERT INTO S_DataFiles (FileName,FileType,FileBlob) VALUES (?, ?, ?) ON CONFLICT (FileName,FileType) DO UPDATE SET FileBlob = ?",[e.files[0].name,"Input",new Uint8Array(r),new Uint8Array(r)]),y.getInstance(document.getElementById("scc-one-modal")).hide(),new y(document.getElementById("modal-input-files")).show(),e.value=null,d.innerHTML="Upload",d.removeAttribute("disabled",""),L()}else m("Alert!","Please choose a file")},new y(document.getElementById("scc-one-modal")).show()}async function Ee(){let l=document.getElementById("modal-input-files").querySelector("h2").innerText.indexOf("Input")>-1?"Input":"Output";const t=document.getElementById("availableModal").querySelector("li.selectedValue");try{const n=await f("fetchData",t.innerText,"SELECT FileName,FileBlob FROM S_DataFiles WHERE FileType = ?",[l]);if(!n||n.length===0){m("Alert!","No files found to download.");return}const d=new JSZip;n.forEach(c=>{d.file(c[0],c[1])});const e=await d.generateAsync({type:"blob"}),i=document.createElement("a");i.href=window.URL.createObjectURL(e),i.download="InputFiles.zip",i.click(),setTimeout(function(){window.URL.revokeObjectURL(i.href)},1e3)}catch(a){console.error("Error creating zip file for download:",a)}}async function we(l){const t=document.getElementById("availableModal").querySelector("li.selectedValue");if(!t){m("Alert!","Please select a model");return}const[a,n]=E("Upload Package","Upload"),d=o("input","form-control"),e=o("div","input-group",null,d);d.setAttribute("type","file"),d.setAttribute("accept",".whl"),a.appendChild(e),n.onclick=async function(i){if(d.files[0]){n.setAttribute("disabled",""),n.innerHTML='<span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>';const r=await d.files[0].arrayBuffer();try{await f("insertData",t.innerText,"INSERT INTO S_PackageWheels (WheelName,WheelBlob) VALUES (?, ?) ON CONFLICT (WheelName) DO UPDATE SET WheelBlob = ?",[d.files[0].name,new Uint8Array(r),new Uint8Array(r)]),m("Success","Package uploaded successfully!")}catch(s){console.error("Error saving file:",s)}y.getInstance(document.getElementById("scc-one-modal")).hide(),d.value=null,n.innerHTML="Upload",n.removeAttribute("disabled","")}else m("Alert!","Please choose a file")}}async function Te(){const l=document.createElement("a");l.href=window.URL.createObjectURL(D),l.download="output.jpg",l.click(),setTimeout(function(){window.URL.revokeObjectURL(l.href)},1e3)}document.getElementById("notebookBtn").onclick=function(){const l=document.getElementById("availableModal").querySelector("li.selectedValue");if(!l){m("Alert!","Please select a model");return}const t=l.innerText;window.open(`/S_Notebook.html?modelName=${t}`)};async function ve(l,t){let a="Success";try{const n=await fetch(`../sqlScripts/supplyPlanning/Version${t}.sql`);n.ok||(a=`Failed to load SQL script: ${n.statusText}`);const d=await n.text();try{await f("executeQuery",l,d,["script"]),await f("updateData",l,"UPDATE S_ModelParams SET ParamValue = ? WHERE ParamName = ?",[t,"DBVersion"])}catch(e){console.error("Error executing SQL script:",e),a=e}}catch(n){console.error(n)}return a}
