import"./pixel.CTdmvz-a.js";/* empty css              */import{e as executeQuery,v as executePython,b as get_cl_element,B as consoleNotebookOutput,C as drawImageFromPython,c as confirmBox}from"./scc.CvI6WV15.js";import{C as CodeMirror}from"./codemirror.DO_djx_r.js";import"./python.CCAAO0-i.js";const isPyProxy=function(t){return!!t&&t.$$!==void 0&&t.$$.type==="PyProxy"};function createCodeMirrorEditor(kernelId,modelName,CellId,content){const cell=document.getElementById(kernelId);var editor=CodeMirror(cell.querySelector("div.computelite-text-editor"),{lineNumbers:!0,lineWrapping:!0,mode:"python",autoRefresh:!0,autofocus:!0,tabSize:4,indentUnit:4,extraKeys:{"Ctrl-Enter":async cm=>{cm.getInputField().blur();const query=editor.getValue(),cell=document.getElementById(kernelId);cell.querySelector(".cell-bottom").innerHTML="",cell.querySelector(".sidebar-inner")&&(cell.querySelector(".sidebar-inner").innerHTML="");const btn=cell.querySelector("span.fa-regular");btn&&btn.classList.contains("fa-play-circle")&&(btn.classList.remove("fa-play-circle"),btn.classList.add("fa-hourglass"));const updateQuery="UPDATE S_Notebook SET CellContent = ? WHERE CellId = ?";await executeQuery("updateData",modelName,updateQuery,[query,CellId]);let res=await executePython("execute","notebook",query,"Default",modelName,[],null,[],[],kernelId);btn&&btn.classList.contains("fa-hourglass")&&(btn.classList.add("fa-play-circle"),btn.classList.remove("fa-hourglass"));const htmlOutput=get_cl_element("div");if(cell.querySelector(".cell-bottom").appendChild(htmlOutput),res.result!=null){let val=await convertResult(res.result.display,res.result.value);if(val!==void 0)if(val instanceof HTMLElement)htmlOutput.appendChild(val),val.querySelectorAll('script[type|="text/javascript"]').forEach(function(e){e.textContent!==null&&eval(e.textContent)});else if(isPyProxy(val)){let hadHTMLOutput=!1;if(val._repr_html_!==void 0){let result=val._repr_html_();if(typeof result=="string"){let div=get_cl_element("div","rendered_html cell-output-html");div.appendChild(new DOMParser().parseFromString(result,"text/html").body.firstChild),htmlOutput.appendChild(div),div.querySelectorAll('script[type|="text/javascript"]').forEach(function(e){e.textContent!==null&&eval(e.textContent)}),hadHTMLOutput=!0}}hadHTMLOutput||consoleNotebookOutput(cell,[val])}else val instanceof Uint8Array?drawImageFromPython(val):consoleNotebookOutput(cell,[res.result.value])}else res.stderr!=null&&consoleNotebookOutput(cell,[res.stderr],"error")}}});return editor.addKeyMap({Backspace:function(t){const l=t.getCursor(),n=t.getLine(l.line),o=t.getOption("indentUnit"),i=n.slice(0,l.ch);if(/^\s*$/.test(i)&&l.ch>0){const a=Math.max(0,l.ch-o);t.setCursor({line:l.line,ch:a})}else t.execCommand("delCharBefore")}}),setTimeout(()=>{editor.refresh(),editor.setValue(content)},10),editor}async function convertResult(t,l){if(t==="default")return l;if(t==="html"){let n=get_cl_element("div","rendered_html cell-output-html");return n.appendChild(new DOMParser().parseFromString(l,"text/html").body.firstChild),n}else return l}let nanoid=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((l,n)=>(n&=63,n<36?l+=n.toString(36):n<62?l+=(n-26).toString(36).toUpperCase():n>62?l+="-":l+="_",l),"");const params=new URLSearchParams(window.location.search),modelName=params.get("modelName"),container=document.getElementById("cellContainer");window.onload=async function(){if(!modelName){confirmBox("Alert!","Model Name not found in the URL.");return}let t=await executeQuery("init");if(!t||t.msg!="Success"){confirmBox("Alert!","Some error occured while initializing sqlite.");return}else{const c=await executeQuery("fetchData",modelName,"SELECT CellId,CellContent FROM S_Notebook");for(let r of c)createCodeEditor(r[0],r[1])}const n=await executeQuery("fetchData",modelName,"SELECT FilePath,FileData FROM S_ExecutionFiles WHERE Filename is NOT NULL AND Status = 'Active' "),i=await executeQuery("fetchData",modelName,"SELECT FileName,FileBlob FROM S_DataFiles WHERE FileType = 'Input'"),s=await executeQuery("fetchData",modelName,"SELECT WheelName,WheelBlob FROM S_PackageWheels");document.getElementById("loadingOverlay").classList.remove("hidden"),await executePython("init","notebook","","Default",modelName,n,"",i,s),document.getElementById("loadingOverlay").classList.add("hidden")};function createCodeEditor(t,l=""){const n=nanoid(),o=get_cl_element("computelite-cell","cell-grid cell-container celltype-python",n);o.setAttribute("tabindex","0");const i=get_cl_element("div","cell-controls cell-controls-left cell-controls-left-top"),a=get_cl_element("button","btn cell-controls-button py-1");a.title="Run Cell";const s=get_cl_element("span","fa-regular fa-play-circle");s.style.fontSize="16px",a.appendChild(s),i.appendChild(a);const d=get_cl_element("div","cell-top flush");let c=get_cl_element("div");c.style="position: relative;width: 100%;height: 0;";const r=get_cl_element("div","computelite-text-editor-controls",null,get_cl_element("div"));r.firstChild.appendChild(get_cl_element("button","btn btn-small transparent p-1 px-1 me-1",null,get_cl_element("span","fa-solid fa-trash-alt"))),r.querySelector("button").title="Delete Cell",r.querySelector("span").style="color: #00000066;",r.querySelector("button").onclick=async function(){await executeQuery("deleteData",modelName,"DELETE FROM S_Notebook WHERE CellId = ?",[t])&&o.remove()};const u=get_cl_element("computelite-text-editor"),m=get_cl_element("div","computelite-text-editor");c.appendChild(r),u.appendChild(c),u.appendChild(m),d.appendChild(u),o.appendChild(i),o.appendChild(d);const p=get_cl_element("div","cell-bottom");o.appendChild(p),container.appendChild(o),createCodeMirrorEditor(n,modelName,t,l)}document.getElementById("addCell").onclick=async function(){if(!modelName){confirmBox("Alert!","Model Name not found in the URL.");return}const l=await executeQuery("insertData",modelName,"INSERT INTO S_Notebook (CellContent) VALUES (?)",[""]);createCodeEditor(l)};
