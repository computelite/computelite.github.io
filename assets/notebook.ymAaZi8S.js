import"./pixel.PHV1U_RE.js";/* empty css              */import{e as executeQuery,y as executePython,b as get_cl_element,E as consoleNotebookOutput,F as drawImageFromPython,v as fetchSchema,c as confirmBox,w as fetchData,x as addDefaultModel}from"./scc.o4pBj1XV.js";import{C as CodeMirror}from"./codemirror.BeiFTLV5.js";import"./python.CRxt_0kd.js";import{n as nanoid}from"./index.browser.vcSNLBTf.js";const isPyProxy=t=>{var l;return!!t&&((l=t.$$)==null?void 0:l.type)==="PyProxy"};function createCodeMirrorEditor(t,l,c,d,o){const n=document.getElementById(t);var a=CodeMirror(n.querySelector("div.computelite-text-editor"),{lineNumbers:!0,lineWrapping:!0,mode:"python",autoRefresh:!0,autofocus:!0,tabSize:4,indentUnit:4,extraKeys:{"Ctrl-Enter":async r=>executeCode(a,n,l,c,t,o)}});return a.addKeyMap({Backspace:function(r){const i=r.getCursor(),u=r.getLine(i.line),s=r.getOption("indentUnit"),m=u.slice(0,i.ch);if(/^\s*$/.test(m)&&i.ch>0){const y=Math.max(0,i.ch-s);r.setCursor({line:i.line,ch:y})}else r.execCommand("delCharBefore")}}),n.querySelector("button.cell-controls-button").onclick=function(){executeCode(a,n,l,c,t)},setTimeout(()=>{a.refresh(),d&&a.setValue(d)},10),a}async function executeCode(editor,cell,modelName,CellId,kernelId,notebookId){editor.getInputField().blur();const query=editor.getValue();cell.querySelector(".cell-bottom").innerHTML="",cell.querySelector(".sidebar-inner")&&(cell.querySelector(".sidebar-inner").innerHTML="");const btn=cell.querySelector("span.fa-regular");btn!=null&&btn.classList.contains("fa-play-circle")&&btn.classList.replace("fa-play-circle","fa-hourglass");const updateQuery="UPDATE S_NotebookContent SET CellContent = ? WHERE CellId = ? AND CellType = ? AND NotebookId = ?";await executeQuery("updateData",modelName,updateQuery,[query,CellId,"python",notebookId]);let res=await executePython("execute","notebook",query,"Default",modelName,[],null,[],[],kernelId);btn!=null&&btn.classList.contains("fa-hourglass")&&btn.classList.replace("fa-hourglass","fa-play-circle");const htmlOutput=get_cl_element("div");if(cell.querySelector(".cell-bottom").appendChild(htmlOutput),res.result!==void 0){let val=await convertResult(res.result.display,res.result.value);if(val!==void 0)if(val instanceof HTMLElement)htmlOutput.appendChild(val),val.querySelectorAll('script[type|="text/javascript"]').forEach(function(e){e.textContent!==null&&eval(e.textContent)});else if(isPyProxy(val)){let hadHTMLOutput=!1;if(val._repr_html_!==void 0){let result=val._repr_html_();if(typeof result=="string"){let div=get_cl_element("div","rendered_html cell-output-html");div.appendChild(new DOMParser().parseFromString(result,"text/html").body.firstChild),htmlOutput.appendChild(div),div.querySelectorAll('script[type|="text/javascript"]').forEach(function(e){e.textContent!==null&&eval(e.textContent)}),hadHTMLOutput=!0}}hadHTMLOutput||consoleNotebookOutput(cell,[val])}else val instanceof Uint8Array?drawImageFromPython(val):consoleNotebookOutput(cell,[res.result.value])}else res.stderr!=null&&consoleNotebookOutput(cell,[res.stderr],"error")}async function convertResult(t,l){if(t==="html"){let c=get_cl_element("div","rendered_html cell-output-html");return c.appendChild(new DOMParser().parseFromString(l,"text/html").body.firstChild),c}return l}let schema={};const params=new URLSearchParams(window.location.search);let modelName=params.get("modelName");const container=document.getElementById("cellContainer");window.onload=async function(){schema=await fetchSchema();let t=await executeQuery("init");if(!t||t.msg!="Success"){confirmBox("Alert!","Some error occured while initializing sqlite.");return}else if(!modelName)if((await fetchData("home","getUserModels")).some(s=>s[0]==="Default_DB"))modelName="Default_DB";else{let s=await addDefaultModel(schema);if(s.length>0)modelName=s[0];else{confirmBox("Alert!","Model Name not found in the URL.");return}}await fetchNotebookName();let l=document.getElementById("jsListDiv").querySelector("li.selectedValue");await populateCells(l.innerText);const d=await executeQuery("fetchData",modelName,"SELECT FilePath,FileData FROM S_ExecutionFiles WHERE Filename is NOT NULL AND Status = 'Active' "),n=await executeQuery("fetchData",modelName,"SELECT FileName,FileBlob FROM S_DataFiles WHERE FileType = 'Input'"),r=await executeQuery("fetchData",modelName,"SELECT WheelName,WheelBlob FROM S_PackageWheels");document.getElementById("loadingOverlay").classList.remove("hidden"),await executePython("init","notebook","","Default",modelName,d,"",n,r),document.getElementById("loadingOverlay").classList.add("hidden")};async function populateCells(t){try{(await executeQuery("fetchData",modelName,"SELECT CellId,CellContent,NotebookId FROM S_NotebookContent WHERE Name = ? AND CellType = ?",[t,"python"])).forEach(([d,o,n])=>createCodeEditor(d,n,o))}catch(l){console.error("Error populating cells:",l)}}function createCodeEditor(t,l,c=""){const d=nanoid(),o=get_cl_element("computelite-cell","cell-grid cell-container celltype-python",d);o.setAttribute("tabindex","0");const n=get_cl_element("div","cell-controls cell-controls-left cell-controls-left-top"),a=get_cl_element("button","btn cell-controls-button py-1");a.title="Run Cell";const r=get_cl_element("span","fa-regular fa-play-circle");r.style.fontSize="16px",a.appendChild(r),n.appendChild(a);const i=get_cl_element("div","cell-top flush");let u=get_cl_element("div");u.style="position: relative;width: 100%;height: 0;";const s=get_cl_element("div","computelite-text-editor-controls",null,get_cl_element("div"));s.firstChild.appendChild(get_cl_element("button","btn btn-small transparent p-1 px-1 me-1",null,get_cl_element("span","fa-solid fa-trash-alt"))),s.querySelector("button").title="Delete Cell",s.querySelector("span").style="color: #00000066;",s.querySelector("button").onclick=async function(){await executeQuery("deleteData",modelName,"DELETE FROM S_NotebookContent WHERE CellId = ? AND CellType = ? AND NotebookId = ?",[t,"python",l])&&o.remove()};const m=get_cl_element("computelite-text-editor"),y=get_cl_element("div","computelite-text-editor");u.appendChild(s),m.appendChild(u),m.appendChild(y),i.appendChild(m),o.appendChild(n),o.appendChild(i);const p=get_cl_element("div","cell-bottom");o.appendChild(p),container.appendChild(o),createCodeMirrorEditor(d,modelName,t,c,l)}document.getElementById("addCell").onclick=async function(){let t=document.getElementById("jsListDiv").querySelector("li.selectedValue"),l=t.getAttribute("id");if(!modelName){confirmBox("Alert!","Model Name not found in the URL.");return}try{const d=await executeQuery("insertData",modelName,"INSERT INTO S_NotebookContent (CellContent, Name, NotebookId, CellType) VALUES (?, ?, ?, ?)",["",t.innerText,l,"python"]);createCodeEditor(d,l)}catch(c){console.error("Error adding cell:",c)}};async function fetchNotebookName(){try{let t=document.getElementById("jsListDiv"),c=await executeQuery("fetchData",modelName,"SELECT Name, NotebookId FROM S_Notebooks WHERE Status = 'Active' AND Type = 'Python'"),d=new Set;if(c.length>0){for(let o of c)if(o[0]&&!d.has(o[0])){d.add(o[0]);let n=get_cl_element("li","py-0 ps-1",o[1],null),a=get_cl_element("label","checkBox-label",null,get_cl_element("span","fas fa-file-alt"),null);a.appendChild(document.createTextNode(o[0])),n.appendChild(a),t.appendChild(n),n.onclick=async function(r){for(let i of document.getElementById("jsListDiv").querySelectorAll("li.selectedValue"))i.classList.remove("selectedValue");this.classList.add("selectedValue"),container.innerHTML="",await populateCells(this.innerText)}}t.firstElementChild.classList.add("selectedValue")}else{let n=await executeQuery("insertData",modelName,"INSERT INTO S_Notebooks (Name,Type,Status) VALUES (?, ?, ?) RETURNING NotebookId",["Default","Python","Active"]);await executeQuery("insertData",modelName,"INSERT INTO S_NotebookContent (Name,CellContent,CellType,NotebookId) VALUES (?, ?, ?, ?)",["Default","","python",n]);let r=get_cl_element("li","py-0 ps-1",n,null),i=get_cl_element("label","checkBox-label",null,get_cl_element("span","fas fa-file-alt"),null);i.appendChild(document.createTextNode("Default")),r.appendChild(i),t.appendChild(r),r.classList.add("selectedValue"),container.innerHTML="",r.onclick=async function(u){for(let s of t.querySelectorAll("li.selectedValue"))s.classList.remove("selectedValue");this.classList.add("selectedValue"),container.innerHTML="",await populateCells(this.innerText)}}}catch(t){confirmBox("Alert!",`Error during execution:, ${t}`),console.error("Error during execution:",t);return}}document.getElementById("addNotebook").onclick=async function(){document.getElementById("inputDiv").classList.remove("d-none"),document.getElementById("notebookName").focus()};document.getElementById("notebookName").onkeydown=async function(t){try{if(t.key==="Enter"){t.preventDefault();const l=t.target.value.trim();if(l===""){confirmBox("Alert!","Please enter Notebook Name.");return}if(!/^[^\s]+$/.test(l)){confirmBox("Alert!","Please enter a valid Notebook Name.");return}if((await executeQuery("fetchData",modelName,"SELECT name FROM S_Notebooks WHERE name = ? AND Type = 'Python'",[l])).length>0){confirmBox("Alert!","Notebook Name Already Exists");return}let a=await executeQuery("insertData",modelName,"INSERT INTO S_Notebooks (Name,Type,Status) VALUES (?, ?, ?) RETURNING NotebookId",[l,"Python","Active"]);await executeQuery("insertData",modelName,"INSERT INTO S_NotebookContent (CellContent, Name, NotebookId, CellType) VALUES (?, ?, ?, ?)",["",l,a,"python"]),document.getElementById("inputDiv").classList.add("d-none");let i=document.getElementById("jsListDiv"),u=get_cl_element("li","py-0 ps-1",a,null),s=get_cl_element("label","checkBox-label",null,get_cl_element("span","fas fa-file-alt"),null);s.appendChild(document.createTextNode(l)),u.appendChild(s),i.appendChild(u);for(let m of i.querySelectorAll("li.selectedValue"))m.classList.remove("selectedValue");u.classList.add("selectedValue"),container.innerHTML="",await populateCells(l),t.target.value="",u.onclick=async function(m){for(let y of i.querySelectorAll("li.selectedValue"))y.classList.remove("selectedValue");this.classList.add("selectedValue"),container.innerHTML="",await populateCells(this.innerText)}}}catch(l){console.error("Error adding notebook:",l)}};document.getElementById("deleteNotebook").onclick=function(){let t=document.getElementById("jsListDiv").querySelector("li.selectedValue");t?confirmBox("",`Are You Sure Want to Delete ${t.innerText}`,deleteNoteBookLi.bind(null,t),1):confirmBox("Alert!","No Notebook Selected to delete")};async function deleteNoteBookLi(t){let l=t.getAttribute("id");await executeQuery("deleteData",modelName,"DELETE FROM S_Notebooks WHERE NotebookId = ? AND Type = 'Python'",[l]);const o=await executeQuery("deleteData",modelName,"DELETE FROM S_NotebookContent WHERE NotebookId = ? AND CellType = 'python'",[l]);for(let a of document.querySelectorAll("computelite-cell"))o&&a.remove();document.getElementById("jsListDiv").innerHTML="",await fetchNotebookName();let n=document.getElementById("jsListDiv").querySelector("li.selectedValue");await populateCells(n.innerText)}document.getElementById("toggleSidebar").onclick=function(){document.getElementById("sidebarMenu").classList.toggle("contracted"),container.classList.toggle("cell-position"),document.getElementById("inputDiv").classList.add("d-none")};
