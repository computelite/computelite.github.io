import"./pixel.CTdmvz-a.js";import{f as te}from"./flatpickr.min.Cwadf_CE.js";import{e as Me,f as Te,d as qe,u as Oe,c as y,s as oe,g as De,a as Pe,b as m,h as Re,i as $e,j as Fe,p as Ee,k as je,r as le,l as ue,m as Ve,n as Ue,o as He,q as Ye,t as Xe,v as ze}from"./scc.Dvg64kKt.js";import{M as D,D as se}from"./bootstrap.esm.CkDf0L-y.js";const A=document.getElementById("currentPage"),g=document.getElementById("displayTable"),J=1e3;var Q=!1,B=new Object,x=new Object,T=new Object,$=[],c=new Object;let Ie={};var H,O=1,r,F=[],V=0,U={};const me=new URLSearchParams(window.location.search),_=me.get("modelName"),E=me.get("tableName");E&&(document.title=E);let ie={},X=null,j;dt();document.addEventListener("DOMContentLoaded",async function(){let t=await Me("init");t&&t.msg=="Success"&&Le(),document.querySelectorAll(".modal").forEach(e=>{D.getInstance(e)||new D(e)})});async function Le(){document.getElementById("resetSort").onclick=nt;const t=await Te(_,E);c=t[0][0],j=t[0][2],t[0][1]&&(document.getElementById("viewQuery").style.display="",document.getElementById("queryInput").value=t[0][1]),t[1]&&(H=!0,g.classList.add("no_user_select")),xe(),de(),H||(document.getElementById("deleteRecordsBtn").parentNode.style.display="none",document.getElementById("excelUploadBtn").parentNode.style.display="none",document.getElementById("addNewColBtn").parentNode.style.display="none",document.getElementById("delNewColBtn").parentNode.style.display="none",document.getElementById("multiUpdate").parentNode.style.display="none")}function Ze(t){Qe(t),r=t.reduce((o,i)=>o.concat(i[0]),[]),t[0][1].toLowerCase()=="primary"&&(Q=!0),q(r);const l=g.querySelector("thead");l.innerHTML="";const e=m("tr","headers",null,null),n=m("tr","lovRow",null,null);for(let o of t){Ie[o[0]]=o[1];let i=m("th",null,null,null);t.indexOf(o)<j&&(i.classList.add("ZDX_H"),i.classList.add(`C${t.indexOf(o)}`)),i.setAttribute("nowrap","");const d=m("input","form-control p-1",null,null),a=m("th",null,null,m("div","input-group",null,d));d.setAttribute("type","text"),d.addEventListener("keydown",function(p){const v=this.nextElementSibling,w=v.nextElementSibling;if(v.classList.contains("show")){if(p.keyCode=="27")new se(v).toggle();else if(p.keyCode=="40"){let L=w.querySelector("a.selected");if(L)if(L.parentNode.tagName=="FORM"){const N=w.querySelector("div.lov-values a");N&&(L.classList.remove("selected"),N.classList.add("selected"))}else{const N=L.nextElementSibling;N&&(L.classList.remove("selected"),N.classList.add("selected"))}else w.querySelector("a.dropdown-item").classList.add("selected")}else if(p.keyCode=="38"){let L=w.querySelector("a.selected");if(L&&L.parentNode.tagName!="FORM"){const N=L.previousElementSibling;N?(L.classList.remove("selected"),N.classList.add("selected")):(L.classList.remove("selected"),w.firstChild.firstChild.classList.add("selected"))}}else p.keyCode=="32"&&(w.querySelector("a.selected").firstChild.click(),p.preventDefault());return p.key==="Enter"&&(ge(a,o[0]),new se(v).toggle(),p.preventDefault()),!1}else{if(p.key==="Enter")return Ge()&&q(r),!1;if(p.altKey&&p.keyCode=="40")return new se(v).toggle(),w.querySelector("a.dropdown-item").classList.add("selected"),!1}});const s=m("span","input-group-text dropdown-toggle px-1",null,m("span","fas fa-chevron-down",null,null));s.addEventListener("show.bs.dropdown",async function(){const p=a.querySelector("div.lov-values");o[0]in B||(B[o[0]]=[]),o[0]in x||(x[o[0]]=[]),B[o[0]].length==0&&x[o[0]].length==0&&(p.parentNode.querySelector("input").checked=!0),p.innerHTML="";let v=Object.assign({},B),w=Object.assign({},x);delete v[o[0]],delete w[o[0]],document.getElementById("data-loader").style.display="";const L=await ue(_,E,[o[0]],{...v,...ie},w,T,1,[],!0,!0);document.getElementById("data-loader").style.display="none";const N=L[0].length;for(let z of L[0]){let M=m("a","dropdown-item",null,m("input","form-check-input",null,null));M.firstChild.setAttribute("type","checkbox"),B[o[0]].length>0?z[0]!==null?B[o[0]].indexOf(z[0].toString())>-1&&(M.firstChild.checked=!0):B[o[0]].indexOf("null")>-1&&(M.firstChild.checked=!0):x[o[0]].length>0?z[0]!==null?x[o[0]].indexOf(z[0].toString())==-1&&(M.firstChild.checked=!0):x[o[0]].indexOf("null")==-1&&(M.firstChild.checked=!0):M.firstChild.checked=!0,M.appendChild(m("label","form-check-label",null,document.createTextNode(Y(o[0],z[0])))),M.querySelector("label").setAttribute("value",z[0]),p.appendChild(M),M.firstChild.onchange=function(yt){!M.firstChild.checked&&p.parentNode.querySelector("input").checked?p.parentNode.querySelector("input").checked=!1:M.firstChild.checked&&!p.parentNode.querySelector("input").checked&&p.querySelectorAll("input:checked").length==N&&(p.parentNode.querySelector("input").checked=!0)}}p.querySelectorAll("input:checked").length==N&&(p.parentNode.querySelector("input").checked=!0)}),s.setAttribute("type","button"),s.setAttribute("data-bs-toggle","dropdown"),s.setAttribute("aria-haspopup","true"),s.setAttribute("aria-expanded","false"),a.querySelector("div").appendChild(s);const u=m("div","multiselect-container dropdown-menu dropdown",null,m("form",null,null,m("a","dropdown-item",null,m("input","form-check-input",null,null))));u.querySelector("a").appendChild(m("label","form-check-label",null,document.createTextNode("Select All"))),u.querySelector("input").setAttribute("type","checkbox"),u.firstChild.appendChild(m("div","dropdown-divider")),u.firstChild.appendChild(m("div","lov-values")),u.firstChild.appendChild(m("div","dropdown-divider"));const h=u.querySelector("input");h.onchange=function(p){if(h.checked)for(let v of a.querySelectorAll("div.lov-values input"))v.checked||(v.checked=!0);else for(let v of a.querySelectorAll("div.lov-values input"))v.checked&&(v.checked=!1)};const f=m("button","btn btn-sm btn-primary",null,document.createTextNode("OK")),I=m("button","btn btn-sm btn-tertiary",null,document.createTextNode("CLEAR"));u.firstChild.appendChild(m("div","dropdown-item",null,f)),f.parentNode.appendChild(I),I.style.float="left",I.setAttribute("type","button"),f.setAttribute("type","button"),a.querySelector("div").appendChild(u),f.addEventListener("mousedown",function(p){let v=a.querySelectorAll("div.lov-values input:checked").length,w=a.querySelectorAll("div.lov-values input").length;setTimeout(function(){v==w?s.childNodes[1]&&(s.removeChild(s.childNodes[0]),s.firstChild.style=""):!v==0&&(s.childNodes[1]||(s.firstChild.style="position:relative;top:4px;",s.insertBefore(m("span","fas fa-filter"),s.childNodes[0])))},600),ge(a,o[0])}),I.addEventListener("mousedown",function(p){let v=!1;B[o[0]].length>0?(v=!0,B[o[0]]=[]):x[o[0]].length>0&&(v=!0,x[o[0]]=[]),v&&q(r),setTimeout(function(){s.childNodes[1]&&(s.removeChild(s.childNodes[0]),s.firstChild.style="")},200)});let b=ct(o[0]);if(Q&&t.indexOf(o)==0){let p=m("input","form-check-input","selectAll",null);p.setAttribute("type","checkbox"),i.appendChild(p),i.id=o[0],n.appendChild(m("th","ZDX_H",null,null)),p.onchange=function(v){for(let w of g.querySelectorAll("tbody tr"))w.firstChild.firstChild&&(w.firstChild.firstChild.checked=p.checked)}}else if(o[2]==1){i.classList.add("min-width");let p=m("u",null,null,document.createTextNode(o[0]));p.appendChild(m("span",`fa ${b}`,null,null)),i.appendChild(p),n.appendChild(a)}else i.classList.add("min-width"),i.appendChild(document.createTextNode(o[0])),i.appendChild(m("span",`fa ${b}`,null,null)),n.appendChild(a);t.indexOf(o)<j&&(a.classList.add("ZDX_H"),a.classList.add(`C${t.indexOf(o)}`));const S=i.querySelector(`span.${b}`);S&&(S.addEventListener("click",function(){const p=$.reduce((w,L)=>w.concat(L[0]),[]);let v=p.indexOf(o[0]);v<0&&(v=p.length),this.classList.contains("fa-sort-down")?($[v]=[o[0],"desc"],this.classList.remove("fa-sort-down"),this.classList.add("fa-sort-up")):(this.classList.remove("fa-sort-up"),this.classList.remove("fa-sort"),this.classList.add("fa-sort-down"),$[v]=[o[0],"asc"]),q(r)}),i.addEventListener("click",function(p){if(p.target.classList.contains("fa"))return!1;{const v=r.indexOf(this.firstChild.textContent);if(this.classList.contains("selected_col"))for(let w of g.querySelectorAll("tr"))w.childNodes[v].classList.remove("selected_col");else{const w=this.parentNode.querySelector(".selected_col");if(w){const L=r.indexOf(w.firstChild.textContent);for(let N of g.querySelectorAll("tr"))N.childNodes[L].classList.remove("selected_col")}for(let L of g.querySelectorAll("tr"))L.childNodes[v].classList.add("selected_col")}}})),e.appendChild(i)}l.appendChild(e),l.appendChild(n)}async function q(t,l=1){V=0,F=[],O=l;let e=!1;Q&&document.getElementById("selectAll")&&(e=document.getElementById("selectAll").checked);const n=g.querySelector("thead .selected_col");let o=0;n&&(o=t.indexOf(n.firstChild.textContent)),document.getElementById("data-loader").style.display="";const i=await ue(_,E,t,{...B,...ie},x,T,l,$);document.getElementById("data-loader").style.display="none";const d=g.querySelector("tbody"),a=i[0].length;d.innerHTML="";for(let h of i[0]){let f=Z(h,o,e,l);d.appendChild(f)}if(Ae(),H&&d.appendChild(W()),a>-5){let h=m("tr","footer");for(let f of t){let I=document.createElement("td");h.appendChild(I)}h.style.display="none",d.appendChild(h)}let s="",u="";i[1]>=J?(s=((l-1)*J+1).toString()+"-"+Math.min(l*J,i[1]).toString()+" of "+i[1],u="of "+(parseInt(i[1]/J)+1).toString()):(s="1-"+i[1].toString()+" of "+i[1].toString(),u="of 1"),document.getElementById("totalRecordsPanel").innerText=s,A.parentNode.childNodes[2].textContent=u,A.setAttribute("maxPages",parseInt(i[1]/J)+1),A.value=O}const ee=function(t,l){if(t.length!==l.length)return!0;for(let e of t)if(l.indexOf(e)==-1)return!0;return!1};function Ge(){let t=0;Q&&(t=1);let l=!1;for(let[e,n]of document.querySelectorAll("tr.lovRow th input[type=text]").entries()){let o=n.value,i=r[e+t];if(i in T)T[i]!=o&&(l=!0,o==""?delete T[i]:T[i]=o);else{if(o=="")continue;T[i]=o}}return Object.keys(T).length>0&&(l=!0),l}A.addEventListener("keyup",function(t){if(t.key==="Enter"){const l=A.value;if(isNaN(l))A.value=O;else{const e=parseInt(A.getAttribute("maxPages"));let n=parseInt(A.value);n<=1?n=1:n>=e&&(n=e),A.value=n,n!==O&&q(r,n)}}});document.getElementById("firstPageBtn").onclick=function(t){O>1&&(A.value=1,q(r,1))};document.getElementById("prevPageBtn").onclick=function(t){O>1&&(A.value=O-1,q(r,O-1))};document.getElementById("nextPageBtn").onclick=function(t){const l=parseInt(A.getAttribute("maxPages"));O<l&&(A.value=O+1,q(r,O+1))};document.getElementById("lastPageBtn").onclick=function(t){const l=parseInt(A.getAttribute("maxPages"));O<l&&(A.value=l,q(r,l))};document.getElementById("refreshBtn").parentNode.onclick=function(t){Promise.resolve(xe()).then(K)};function K(){Je(),B=new Object,x=new Object,T=new Object,document.getElementById("selectAll")&&(document.getElementById("selectAll").checked=!1),q(r,1);for(let e of g.querySelectorAll(".lovRow input.form-control"))e.value="";let l=g.querySelector("thead").querySelectorAll("span.input-group-text");for(let e of l)e.childNodes[1]&&(e.removeChild(e.childNodes[0]),e.firstChild.style="")}function Je(){for(let t of g.querySelectorAll("thead span.fa-sort-down"))Object.keys(U).includes(t.parentNode.innerText.trim())?U[t.parentNode.innerText.trim()]=="desc"&&(t.classList.remove("fa-sort-down"),t.classList.add("fa-sort-up")):(t.classList.add("fa-sort"),t.classList.remove("fa-sort-down"));for(let t of g.querySelectorAll("thead span.fa-sort-up"))Object.keys(U).includes(t.parentNode.innerText.trim())?U[t.parentNode.innerText.trim()]=="asc"&&(t.classList.remove("fa-sort-up"),t.classList.add("fa-sort-down")):(t.classList.add("fa-sort"),t.classList.remove("fa-sort-up"));for(let t of g.querySelectorAll("th.selected_col"))t.classList.remove("selected_col")}function ge(t,l){const e=[],n=[];for(let i of t.querySelectorAll("div.lov-values input"))i.checked?e.push(i.nextElementSibling.getAttribute("value")):n.push(i.nextElementSibling.getAttribute("value"));let o=!1;e.length>n.length?(ee(B[l],[])&&(o=!0,B[l]=[]),ee(x[l],n)&&(o=!0,x[l]=n)):(ee(B[l],e)&&(o=!0,B[l]=e),ee(x[l],[])&&(o=!0,x[l]=[])),o&&q(r)}document.getElementById("excelDownloadBtn").onclick=async function(t){document.getElementById("data-loader").style.display="",await qe(_,[E]),document.getElementById("data-loader").style.display="none"};document.getElementById("importExcel").onclick=async function(t){if(document.getElementById("fileUpload").files[0]){document.getElementById("data-loader").style.display="";const e=await document.getElementById("fileUpload").files[0].arrayBuffer(),n=await Oe(_,[E.toLowerCase()],e);document.getElementById("data-loader").style.display="none";let o=Object.keys(n),d=o.map(a=>a.toLowerCase()).indexOf(E.toLowerCase());d>-1?isNaN(n[o[d]])?y("Error!",n[o[d]]):(K(),y("Success!","Total Rows: "+n[o[d]]+" Imported")):y("Error!","No sheet matches with table name")}else y("Alert!","Please choose a file to upload")};document.getElementById("importCSV").onclick=function(t){const l=document.getElementById("selectDelimeter").value;document.getElementById("textfileUpload").files[0]?(document.getElementById("data-loader").style.display="",postFile("/grid/upload-csv",document.getElementById("textfileUpload").files[0],{delimiter:l}).then(e=>{document.getElementById("data-loader").style.display="none";let n=Object.keys(e),o=n.indexOf(sessionStorage.table_name.toLowerCase());o>-1?isNaN(e[n[o]])?y("Error!",e[n[o]]):(K(),y("Success!","Total Rows: "+e[n[o]]+" Imported")):y("Error!","No sheet matches with table name")})):y("Alert!","Please choose a file to upload")};async function Qe(t){let l=["NUMERIC","INTEGER"],e={decimals:2,comma:0,locale:0,currency:0,aggregate:"SUM"};const n={};for(let i in e){n[i]=new Object;for(let d of t){let a=d[0];if(l.indexOf(d[1])>-1)if(i in c)if(a in c[i]){let s=c[i][a];!isNaN(s)&&parseInt(s)>-1?n[i][a]=parseInt(s):["locale","currency","aggregate"].indexOf(i)>-1?n[i][a]=s:n[i][a]=e[i]}else i.toLowerCase()==="decimals"&&d[1]==="INTEGER"?n[i][a]=0:n[i][a]=e[i];else i.toLowerCase()==="decimals"&&d[1]==="INTEGER"?n[i][a]=0:n[i][a]=e[i]}}r=t.reduce((i,d)=>i.concat(d[0]),[]);for(let i in e)c[i]=n[i];"autofiller"in c||(c.autofiller=new Object),"query"in c||(c.query=new Object),"lov"in c||(c.lov=new Object),c.date=new Object,c.datetime=new Object;const o=Object.keys(c.lov);for(let i of o){let d=r.indexOf(i);if(d>-1&&!Array.isArray(c.lov[i])){let a=c.lov[i].split("|");const s=t[d][0];if(a[0].trim().toLowerCase()=="select")if(a[1].trim().toLowerCase().substring(0,6)=="select"){delete c.lov[i];let u=a.slice(1).join("_").trim();c.query[s]=u;const h=await le(_,u);c.lov[s]=h}else{let u=a[1].trim().split(";"),h=[];for(let f of u)f.trim().length>0&&h.push(f.trim());delete c.lov[i],c.lov[s]=h}else if(a[0].trim().toLowerCase()=="autofiller")if(a[1].trim().toLowerCase().substring(0,6)=="select"){delete c.lov[i];let u=a.slice(1).join("|").trim(),h=g.querySelector("tbody");c.query[s]=u;const f=await le(_,u);c.autofiller[s]=f,document.getElementById("dataList_div").appendChild(ne(`${s}_dataList`,f));let I=h.getElementsByClassName("insert");I&&I[0]&&(I[0].remove(),h.appendChild(W()))}else{let u=a[1].trim().split(";"),h=[];for(let I of u)I.trim().length>0&&h.push(I.trim());delete c.lov[i],c.autofiller[s]=h;let f=document.getElementById(`${s}_dataList`);f&&f.remove(),document.getElementById("dataList_div").appendChild(ne(`${s}_dataList`,h))}else a[0].trim().toLowerCase()=="date"?(delete c.lov[i],c.date[s]=1):a[0].trim().toLowerCase()=="datetime"?(delete c.lov[i],c.datetime[s]=1):console.log("Neither LOV nor Autofiller, please check")}}}document.getElementById("incrDecimals").onclick=async function(t){const l=g.querySelector("thead .selected_col");if(l){const e=l.innerText;if(e in c.decimals){c.decimals[e]+=1,await oe(_,E,e,{Decimals:c.decimals[e]});for(let n of g.querySelectorAll("td.selected_col")){let o=parseFloat(n.getAttribute("title"));isNaN(o)||(n.innerText=Y(e,o))}}else y("Alert!","Please select a numeric column")}else y("Alert!","Please select a column")};document.getElementById("decrDecimals").onclick=async function(t){const l=g.querySelector("thead .selected_col");if(l){const e=l.innerText;if(e in c.decimals){const n=c.decimals[e]-1;if(n>-1){c.decimals[e]=n,await oe(_,E,e,{Decimals:n});for(let o of g.querySelectorAll("td.selected_col")){let i=parseFloat(o.getAttribute("title"));isNaN(i)||(o.innerText=Y(e,i))}}}else y("Alert!","Please select a numeric column")}else y("Alert!","Please select a column")};document.getElementById("showSummaryBtn").onclick=async function(t){const l=Object.keys(c.decimals);let e=g.querySelector("tr.footer");if(l.length>0)if(e.style.display==="none"){document.getElementById("data-loader").style.display="";const n=await De(_,E,l,B,x,T);document.getElementById("data-loader").style.display="none";for(let o of l){let i=n[l.indexOf(o)],d=1;H||(d=0);let a=r.indexOf(o,d);e.childNodes[a].innerText=Y(o,i),e.childNodes[a].setAttribute("title",i)}e.style.removeProperty("display")}else e.style.display="none"};document.getElementById("thousandSepBtn").onclick=async function(t){const l=g.querySelector("thead .selected_col");if(l){const e=l.innerText;if(e in c.decimals){c.comma[e]=1-c.comma[e],await oe(_,E,e,{Comma:c.comma[e]});for(let n of g.querySelectorAll("td.selected_col")){let o=parseFloat(n.getAttribute("title"));isNaN(o)||(n.innerText=Y(e,o))}}else y("Alert!","Please select a numeric column")}else y("Alert!","Please select a column")};function ce(t,l,e){if(t=="all")for(let n of document.getElementById(l).querySelectorAll("li"))document.getElementById(e).appendChild(n);else if(t=="one")for(let n of document.getElementById(l).querySelectorAll("li.selectedValue"))document.getElementById(e).appendChild(n),n.classList.remove("selectedValue")}document.getElementById("allLeft").onclick=function(t){ce(this.getAttribute("bttype"),this.getAttribute("src"),this.getAttribute("dest"))};document.getElementById("allRight").onclick=function(t){ce(this.getAttribute("bttype"),this.getAttribute("src"),this.getAttribute("dest"))};document.getElementById("selectedLeft").onclick=function(t){ce(this.getAttribute("bttype"),this.getAttribute("src"),this.getAttribute("dest"))};document.getElementById("selectedRight").onclick=function(t){ce(this.getAttribute("bttype"),this.getAttribute("src"),this.getAttribute("dest"))};function Ke(t,l){document.getElementById("availableColumn").innerHTML="",document.getElementById("selectedColumn").innerHTML="";for(let e of t)document.getElementById("availableColumn").appendChild(ve(e));for(let e of l)document.getElementById("selectedColumn").appendChild(ve(e))}function ve(t){let l=m("li","dropzone",null,document.createTextNode(t));return l.setAttribute("draggable",!0),l.onclick=function(e){if(!e.ctrlKey)for(let n of this.parentNode.querySelectorAll("li.selectedValue"))n.classList.remove("selectedValue");this.classList.add("selectedValue"),e.preventDefault()},l.ondblclick=function(){let e=this.parentNode.getAttribute("dest");document.getElementById(e).appendChild(this),this.classList.remove("selectedValue")},l}async function de(){const t=await Pe(_,E);if(t.length==0||t[1].length==0){y("Alert!",`No table exists with tablename ${E} `);return}Ze(t[1]);let l;H?l=t[1].reduce((o,i)=>o.concat(i[0]),[]).splice(1):l=t[1].reduce((o,i)=>o.concat(i[0]),[]),Ke(t[0],l);let e=document.getElementById("removeColumnSelect");e.innerHTML="";let n=m("option",null,null,document.createTextNode("Select a Column to Remove"));n.setAttribute("value",0),n.setAttribute("selected",""),e.appendChild(n);for(const[o,i]of l.entries())if(t[1][o][1]!="PRIMARY"||t[1][o][2]!=1||t[1][o][3]!=1){let d=m("option",null,null,document.createTextNode(i));e.appendChild(d)}for(let o of t[0]){let i=m("option",null,null,document.createTextNode(o));e.appendChild(i)}}document.getElementById("saveColumnSelection").onclick=async function(t){const l=[];for(let n of document.getElementById("selectedColumn").childNodes)l.push(n.innerText);await Re(_,E,l)&&de()};document.getElementById("addNewColumn").onclick=async function(t){const l=document.getElementById("newColName").value,e=document.getElementById("addColumnSelect").value,n="*|,\":<>[]{} `';()@&$#%",o=r;if(l){const d=l.length;if(d==0){y("Alert!","Please Enter Column Name");return}if(d>=50){y("Alert!","Please Enter Column Name upto 50 characters");return}for(var i=0;i<d;i++){if(n.indexOf(l.charAt(i))>-1){y("Alert!","Please remove special characters from column name");return}if(e==0){y("Alert!","Please Select valid column type");return}}for(let s of document.getElementById("availableColumn").childNodes)o.push(s.innerText);if(o.indexOf(l)>-1){y("Alert!","Column name already exist, please choose another name");return}await $e(_,E,l,e)&&(de(),D.getInstance(document.getElementById("modal-add-column")).hide())}else{y("Alert!","Please Enter Column Name");return}};document.getElementById("removeColumn").onclick=async function(t){const l=document.getElementById("removeColumnSelect").value;if(l==0)y("Alert!","Please Select a column to proceed");else{const e=await Fe(_,E,l);e&&(e.message=="Success"?de():y("Alert!",e.message)),D.getInstance(document.getElementById("modal-remove-column")).hide()}};document.getElementById("delNewColBtn").onclick=function(t){const l=g.querySelector("thead .selected_col");if(l){const e=r.indexOf(l.firstChild.textContent);for(let i of g.querySelectorAll("tr"))i.childNodes[e].remove();r.splice(e,1);let n=document.getElementById("selectedColumn").childNodes[e-1];document.getElementById("availableColumn").appendChild(n);const o=r.filter(function(i,d,a){return d>0});Ee("/grid/set-columns",{col_list:o})}else new D(document.getElementById("modal-remove-column")).show()};const ae=async function(t){const[l,e]=Ce(),n=await Xe(_,E,B,x,T,e,l,document.getElementById("selectAll").parentNode.id);n&&(K(),y("Success!",`Total of ${n} rows deleted`))};document.getElementById("deleteRecordsBtn").onclick=function(t){if(H)if(document.getElementById("selectAll").checked)y("Alert!","Are you sure, you want to delete all the records?",ae,1);else{const e=g.querySelector("tbody"),n=e.childNodes.length-2,o=e.querySelectorAll("input:checked").length;if(o==0)y("Alert!","Please select atleast one row to proceed?");else if(o<n/2)y("Alert!",`This will delete ${o} records`,ae,1);else{const i=parseInt(document.getElementById("totalRecordsPanel").innerText.split(" ").pop());y("Alert!",`This will delete ${i-n+o} records except ${n-o} not selected records`,ae,1)}}};document.getElementById("multiUpdate").onclick=function(t){if(document.getElementById("modal-update-column").style.display=="none"){const l=g.querySelector("thead .selected_col");l?Se(l.innerText):y("Alert!","Please select a column")}};document.getElementById("updateColumn").onclick=async function(t){const l=document.getElementById("ColValueLabel").innerText;let e=document.getElementById("colValue").value;if(l in c.lov)e=document.getElementById("colSelectValue").value;else if(l in c.decimals){if(isNaN(e)){y("Alert!","Please enter numeric value");return}}else if(c.date&&l in c.date){let d=e.split(" ");d[1]==="00:00:00"&&(e=d[0])}e.trim()==""&&(e=null);const[n,o]=Ce(),i=await je(_,E,B,x,T,o,n,document.getElementById("selectAll").parentNode.id,l,e);if(i){let d=!1;o.length==0&&(d=!0);for(let s of g.querySelectorAll("td.selected_col"))!s.parentNode.classList.contains("insert")&&!s.parentNode.classList.contains("footer")&&(d||s.parentNode.firstChild.firstChild.checked)&&(s.setAttribute("title",e),l in c.decimals?s.innerText=Y(l,e):s.innerText=e);D.getInstance(document.getElementById("modal-update-column")).hide(),y("Success!",`Total of ${i} rows updated`)}};function Ce(){const t=document.getElementById("selectAll").checked;let l=[],e=!1;if(!t){const n=g.querySelector("tbody"),o=n.childNodes.length-1;if(n.querySelectorAll("input:checked").length<o/2){e=!0;for(let d of n.querySelectorAll("input:checked"))l.push(d.parentNode.id)}else{e=!1;for(let d of n.childNodes)d.firstChild.firstChild&&(d.firstChild.firstChild.checked||l.push(d.firstChild.id))}}return[e,l]}document.addEventListener("keydown",We);function We(t){if(t.key=="F2"&&H){const l=g.querySelector("thead .selected_col");l?document.getElementById("modal-update-column").style.display=="none"&&(Se(l.innerText),t.preventDefault()):y("Alert!","Please select a column")}}function Se(t){let l=document.getElementById("colValue");if(l.setAttribute("Autocomplete","off"),l.style.borderBottomRightRadius=0,l.style.borderTopRightRadius=0,l.parentNode.classList.contains("awesomplete")){let n=l.cloneNode(!0),o=l.parentNode.parentNode;l.parentNode.remove(),o.insertBefore(n,o.firstChild),l=n}if(l.value="",X&&(X.destroy(),X=null),l.classList.remove("datepicker-input"),l.removeAttribute("list"),l.parentNode.style.display="flex",document.getElementById("colSelectValue").parentNode.style.display="none",document.getElementById("ColValueLabel").innerText=t,t in c.autofiller)l.setAttribute("list",`${t}_dataList`),l.parentNode.style.flex=1;else if(t in c.lov){let n=document.getElementById("colSelectValue");if(l.parentNode.style.display="none",n.parentNode.style.display="flex",n.innerHTML="",c.lov[t].length>0){for(let o of c.lov[t]){let i=m("option",null,null,document.createTextNode(o));n.appendChild(i)}n.firstChild.setAttribute("selected","")}else l.setAttribute("list",`${t}_dataList`)}else t in c.decimals?l.type="number":c.date&&t in c.date?X=te(l,{dateFormat:"Y-m-d H:i:S",allowInput:!0}):l.type="text";new D(document.getElementById("modal-update-column")).show()}function be(t){F=[];let l=t.parentNode;for(const[e,n]of l.childNodes.entries()){let o=!1;if(e==0)V=n.id,F.push(n.id);else{let i,d;if(n.innerText==""?i=null:r[e]in c.decimals&&!(r[e]in c.date)&&!(r[e]in c.datetime)?n.getAttribute("title")===null?i="":isNaN(parseFloat(n.getAttribute("title")))?i=n.getAttribute("title"):i=parseFloat(n.getAttribute("title")):i=n.innerText,n.firstChild&&n.firstChild.remove(),F.push(i),r[e]in c.lov){d=m("select","form-select p-1",null);let a=!1;for(let s of c.lov[r[e]]){let u=m("option",null,null,document.createTextNode(s));d.appendChild(u),s==i&&(u.setAttribute("selected",""),a=!0)}if(!a){let s=m("option",null,null,document.createTextNode(i));d.appendChild(s)}}else r[e]in c.autofiller?(d=m("input","form-control p-1",null),o=!0):r[e]in c.decimals&&!(r[e]in c.date)&&!r[e]in c.datetime?(d=m("input","form-control p-1",null),d.type="number"):c.datetime&&r[e]in c.datetime?(d=m("input","form-control datepicker-input p-1",null),X=te(d,{dateFormat:"Y-m-d H:i:S",allowInput:!0,defaultDate:i}),d.type="text"):c.date&&r[e]in c.date?(d=m("input","form-control datepicker-input p-1",null),d.value=i,X=te(d,{dateFormat:"Y-m-d",allowInput:!0,defaultDate:i}),d.type="text"):(d=m("input","form-control p-1",null),d.type="text");d.addEventListener("keydown",function(a){a.keyCode=="27"?fe(l):a.keyCode=="13"&&(et(l),a.preventDefault())}),d.value=i,n.appendChild(d),o&&d.setAttribute("list",`${r[e]}_dataList`)}}t.firstChild.focus()}function ne(t,l){let e=m("datalist",null,t);for(let n of l){let o=m("option");o.setAttribute("value",n),e.appendChild(o)}return e}function fe(t){t.parentNode.replaceChild(Z(F),t),F=[],V=0}function we(t){return JSON.stringify(t)!=JSON.stringify(F)}async function et(t){let l=pe(t);if(l&&l.length>0)if(we(l)){let o=new Object;for(const[a,s]of l.entries())if(s!==F[a])if(c.date&&r[a]in c.date){let u=st(s);o[r[a]]=u}else if(c.datetime&&r[a]in c.datetime){let u=at(s);o[r[a]]=u}else o[r[a]]=s;F=[],V=0,await ze(_,E,l[0],o,document.getElementById("selectAll").parentNode.id);const i=g.querySelector("table");let d=Z(l);for(var e=0,n=0;n<j;n++){e+=i.rows[0].cells[n].clientWidth+1;for(let a of d.cells)n==0&&a.classList.contains(`C${n}`)?a.style.left="0px":a.classList.contains(`C${n+1}`)&&(a.style.left=e+"px")}t.parentNode.replaceChild(d,t)}else fe(t)}function W(){let t=m("tr","insert"),l;for(const[e,n]of r.entries()){let o=!1,i=document.createElement("td");if(t.appendChild(i),e==0)i.id=0;else if(e>0){if(n in c.lov&&c.lov[n].toLowerCase()!="freetext"){l=m("select","form-select p-1",null);for(let d of c.lov[n]){let a=m("option",null,null,document.createTextNode(d));l.appendChild(a)}}else n in c.autofiller?(l=m("input","form-control p-1",null),o=!0):n in c.decimals?(l=m("input","form-control p-1",null),l.type="number"):c.date&&n in c.date?(l=m("input","form-control datepicker-input p-1",null),X=te(l,{dateFormat:"Y-m-d H:i:S",allowInput:!0}),l.type="text"):(l=m("input","form-control p-1",null),l.type="text");l.addEventListener("keydown",function(d){if(d.keyCode=="27")for(let a of this.parentNode.parentNode.childNodes){let s=a.firstChild;s&&s.classList.contains("form-control")&&(s.value="")}else d.keyCode=="13"&&(tt(this.parentNode.parentNode),d.preventDefault())}),i.appendChild(l),o&&l.setAttribute("list",`${n}_dataList`)}}return t}async function tt(t){let l={};const e=pe(t);if(e){for(const[o,i]of e.entries())o>0&&(l[r[o]]=i);const n=await Ye(_,E,l);if("Success"in n){e[0]=n.Success;const o=t.parentNode,i=o.lastChild,d=Z(e);t.remove(),o.appendChild(d),o.appendChild(W()),o.appendChild(i)}else y("Error!",`Error:  ${n.Error}`)}}function Z(t,l,e=!1,n=1){let o=m("tr");const i=g.querySelector("tbody");let d;for(const[a,s]of t.entries()){if(Q&&a==0){let u=m("input","form-check-input");u.setAttribute("type","checkbox"),e&&(u.checked=!0),n>1?u.disabled=!0:u.onchange=function(){const h=document.getElementById("selectAll");if(!this.checked&&h.checked)h.checked=!1;else if(this.checked&&!h.checked){h.checked=!0;for(let f of i.querySelectorAll("input[type=checkbox]"))if(!f.checked){h.checked=!1;break}}},d=m("td",null,s,u),o.appendChild(d)}else s===null?d=m("td"):r[a]in c.decimals&&!(r[a]in c.date)&&!(r[a]in c.datetime)?(d=m("td"),d.style="text-align:right;",isNaN(s)?(d.appendChild(document.createTextNode(s)),d.style.backgroundColor="red",d.setAttribute("title","Expecting Numeric Value")):(d.appendChild(document.createTextNode(Y(r[a],s))),d.setAttribute("title",s))):(d=m("td",null,null,document.createTextNode(s)),d.setAttribute("title",s)),d.ondblclick=function(u){H&&(V==0?be(this):V!==this.parentNode.firstChild.id&&(we(pe(document.getElementById(V).parentNode))?y("Alert!","You have unsaved changes"):(fe(document.getElementById(V).parentNode),be(this))))},o.appendChild(d);a<j&&(d.classList.add(`C${a}`),d.classList.add("ZDX_R"),d.classList.add("STX"),d.classList.add("FXC"))}return l>0&&l<t.length&&o.childNodes[l].classList.add("selected_col"),o}document.getElementById("formatColumn").onclick=function(t){const l=g.querySelector("thead .selected_col");if(l){const e=document.getElementById("decimalPlaces"),n=document.getElementById("commaSeparator"),o=document.getElementById("localeString"),i=document.getElementById("displayCurrency"),d=document.getElementById("aggregateFunction"),a=document.getElementById("fieldType"),s=l.innerText;s in c.decimals?lovText.style.display="none":lovText.style.display="",e.parentElement.style.display="none",n.parentElement.style.display="none",o.parentElement.style.display="none",i.parentElement.style.display="none",d.parentElement.style.display="none",a.parentElement.style.display="";const u={freetext:"Free Text",autofiller:"Auto Filler",date:"Date",datetime:"Date Time",lov:"LOV",numeric:"Numeric"};if(a.innerHTML="",s in c.decimals&&!(s in c.date)&&!(s in c.datetime))a.add(new Option(u.numeric,"numeric")),a.add(new Option(u.date,"date")),a.add(new Option(u.datetime,"datetime"));else for(let f in u)f!=="numeric"&&a.add(new Option(u[f],f));if(s in c.date||s in c.datetime)a.add(new Option("Numeric","numeric")),a.value="date",s in c.datetime&&(a.value="datetime"),lovText.style.display="none";else if(s in c.decimals){e.parentElement.style.display="",n.parentElement.style.display="",o.parentElement.style.display="",i.parentElement.style.display="",d.parentElement.style.display="",a.value="numeric";const f=c.decimals[s],I=c.comma[s],b=c.locale[s],S=c.currency[s],p=c.aggregate[s];e.value=f,n.value=I,o.value=b,i.value=S,d.value=p}else{let f=[];s in c.lov&&c.lov[s].toLowerCase()!="freetext"?(a.value="lov",f=c.lov[s]):s in c.autofiller?(a.value="autofiller",f=c.autofiller[s]):s in c.date?(a.value="date",lovText.style.display="none"):(a.value="freetext",lovText.style.display="none"),c.query&&s in c.query?(lovText.value=c.query[s],lovText.style.display=""):f.length>0?(lovText.value=f.join(";"),lovText.style.display=""):lovText.value=""}new D(document.getElementById("modal-format-column")).show()}else y("Alert!","Please select a column")};const lt=document.querySelector("#fieldType"),_e=document.querySelector("#lovText");lt.addEventListener("change",t=>{decimalPlaces.parentElement.style.display="none",commaSeparator.parentElement.style.display="none",localeString.parentElement.style.display="none",displayCurrency.parentElement.style.display="none",aggregateFunction.parentElement.style.display="none",t.target.value=="date"||t.target.value=="datetime"||t.target.value=="freetext"||t.target.value=="numeric"?(_e.style.display="none",t.target.value=="numeric"&&(decimalPlaces.parentElement.style.display="",commaSeparator.parentElement.style.display="",localeString.parentElement.style.display="",displayCurrency.parentElement.style.display="",aggregateFunction.parentElement.style.display="")):_e.style.display=""});document.getElementById("updateFormats").onclick=async function(t){const l=new Object,e=g.querySelector("thead .selected_col").innerText,n=parseInt(document.getElementById("decimalPlaces").value),o=document.getElementById("aggregateFunction").value,i=parseInt(document.getElementById("commaSeparator").value),d=document.getElementById("fieldType").value,a=document.getElementById("lovText").value;let s=document.getElementById("localeString").value,u=document.getElementById("displayCurrency").value;if(u=="0"&&(u=0),s=="0"&&(s=0),d=="date"||d=="datetime")e in c.decimals&&(delete c.decimals[e],delete c.comma[e],delete c.locale[e],delete c.currency[e],delete c.aggregate[e]),l.LOV=d[0].toUpperCase()+d.slice(1),e in c.lov&&delete c.lov[e],e in c.autofiller&&delete c.autofiller[e],e in c.query&&delete c.query[e],e in c.date&&d!="date"?delete c.date[e]:e in c.datetime&&d!="date"&&delete c.datetime[e],c[d][e]=1;else if(d=="autofiller"){if(a!=="")if(l.LOV=`Autofiller | ${a}`,e in c.lov&&delete c.lov[e],c.query[e]=a,a.trim().toLowerCase().substring(0,6)=="select"){const b=await le(_,a);c.autofiller[e]=b;let S=document.getElementById(`${e}_dataList`);S&&S.remove(),document.getElementById("dataList_div").appendChild(ne(`${e}_dataList`,b))}else{let b=[];for(let p of a.trim().split(";"))p.trim().length>0&&b.push(p.trim());c.autofiller[e]=b;let S=document.getElementById(`${e}_dataList`);S&&S.remove(),document.getElementById("dataList_div").appendChild(ne(`${e}_dataList`,b))}}else if(d=="lov"){if(a!=="")if(l.LOV=`Select | ${a}`,e in c.lov&&delete c.lov[e],a.trim().toLowerCase().substring(0,6)=="select"){c.query[e]=a;const b=await le(_,a);c.lov[e]=b}else{let b=[];for(let S of a.trim().split(";"))S.trim().length>0&&b.push(S.trim());delete c.lov[e],c.lov[e]=b}}else if(d=="freetext")l.LOV="Freetext",e in c.lov&&delete c.lov[e],e in c.autofiller&&delete c.autofiller[e],e in c.date&&delete c.date[e],e in c.datetime&&delete c.datetime[e],e in c.query&&delete c.query[e];else if(Ie[e]=="NUMERIC")e in c.lov&&delete c.lov[e],e in c.autofiller&&delete c.autofiller[e],e in c.date&&delete c.date[e],e in c.datetime&&delete c.datetime[e],e in c.query&&delete c.query[e],l.Decimals=n,l.Comma=i,l.Locale=s,l.Currency=u,l.Aggregate=o,c.decimals[e]=n,c.comma[e]=i,c.locale[e]=s,c.currency[e]=u,c.aggregate[e]=o;else{y("Alert","You can't convert text column to Numeric.");return}D.getInstance(document.getElementById("modal-format-column")).hide(),await oe(_,E,e,l),K(),g.querySelector("tr.insert").remove(),g.querySelector("tbody").appendChild(W());for(let b of g.querySelectorAll("td.selected_col"))if(b.firstChild&&b.firstChild.tagName!=="INPUT")if(e in c.decimals){let S=parseFloat(b.getAttribute("title"));b.innerText=Y(e,S)}else{let S=b.getAttribute("title");b.innerText=S}};function Y(t,l){if(l==null)return"";const e=c.decimals[t],n={maximumFractionDigits:e,minimumFractionDigits:e,useGrouping:!1};let o=c.currency[t];const i=c.comma[t],d=c.locale[t];return o&&(n.style="currency",n.currency=o),i&&(n.useGrouping=!0),l.toLocaleString(d,n)}function pe(t){let l=[],e=g.querySelector("tr.headers").childNodes;for(const[n,o]of t.childNodes.entries())if(n==0)l.push(o.id);else{let i=o.firstChild.value;if(o.firstChild.classList.contains("awesomplete")&&(i=o.firstChild.firstChild.value),r[n]in c.decimals&&isNaN(i)&&!(r[n]in c.date)&&!(r[n]in c.datetime)){y("Alert!",`Please enter numeric value in ${r[n]} Column`);return}else if(i.trim()==""&&e[n].querySelector("u")){y("Alert!",`Please enter not null value in ${r[n]} Column`);return}else if(c.date&&r[n]in c.date){let d=i.split(" ");d[1]==="00:00:00"&&(i=d[0])}i.trim()==""||i.trim()=="null"&&r[n]in c.lov?i=null:r[n]in c.decimals&&!(r[n]in c.date)&&!(r[n]in c.datetime)&&(i=parseFloat(i)),l.push(i)}return l}function nt(){let t=!1;for(let l of document.querySelector(".headers").childNodes){let e=l.querySelector("span");e&&(e.classList.contains("fa-sort")||(t=!0,e.classList.contains("fa-sort-down")?e.classList.remove("fa-sort-down"):e.classList.contains("fa-sort-up")&&e.classList.remove("fa-sort-up"),e.classList.add("fa-sort")))}t&&($=[],U={},q(r),Be())}document.getElementById("ok-query").onclick=function(){const t=document.getElementById("queryInput").value;t.trim()==""&&y("Alert!","Please enter a query"),Ee("/home/check-or-createview",{view_name:sessionStorage.table_name,view_query:t,is_exist:!0}).then(l=>{document.getElementById("queryInput").value=t,D.getInstance(document.getElementById("modal-get-viewQuery")).hide(),Le(),y("Success","View updated successfully")})};document.getElementById("copyTable").onclick=async function(){document.getElementById("data-loader").style.display="";const t=await ue(_,E,r,ie,{},{},1,[],!1);if(t){if(document.getElementById("data-loader").style.display="none",t[1]>1e5){y("Alert!","Sorry! , Data exceeded maximum Limit");return}it(t[0])}};function ot(t){navigator.clipboard.writeText(t).then(function(){document.getElementById("data-loader").style.display="none",y("Success","Copied to clipboard")},function(l){document.getElementById("data-loader").style.display="none",y("Alert!",`Error occured : ${l}`)})}function it(t){var l="",e,n;for(e=0;e<t.length;e++){for(n=0;n<t[e].length;n++)l+=(t[e][n]+"").replace(/[\n\t]+/g," "),n+1<t[e].length&&(l+="	");e+1<t.length&&(l+=`
`)}ot(l)}document.getElementById("modal-file-upload").addEventListener("show.bs.modal",function(){document.getElementById("fileUpload").value=""});function ct(t){let l="fa-sort";for(let e of $)if(t===e[0]){e[1]==="asc"?l="fa-sort-down":l="fa-sort-up";break}return l}document.getElementById("saveSort").onclick=Be;async function Be(){await Ve(_,E,$),U={};for(let t of $)U[t[0]]=t[1];this&&y("Success","Sort saved successfully")}async function xe(){let t=await Ue(_,E);$=t;for(let l of t)U[l[0]]=l[1]}function dt(){for(let t of me.entries())["tablename","modelname"].includes(t[0].toLowerCase())||(ie[t[0]]=t[1].split(","))}function Ae(){const t=g.querySelector("table");for(var l=0,e=0;e<j;e++){l+=t.rows[0].cells[e].clientWidth+1;for(let n of t.rows)for(let o of n.cells)e==0&&o.classList.contains(`C${e}`)?o.style.left="0px":o.classList.contains(`C${e+1}`)&&(o.style.left=l+"px")}}document.getElementById("saveFreeze").onclick=async function(){const t=g.querySelector("thead .selected_col");if(t){const l=t.innerText;let e=r.indexOf(l)+1;e==j&&(e=0),await He(_,E,e),j=e;for(let n of g.querySelectorAll("tr")){n.childNodes[r.indexOf(l)].classList.remove("selected_col");for(let[o,i]of n.childNodes.entries())o<j?(i.classList.add(`C${o}`),n.classList.contains("headers")||n.classList.contains("lovRow")?i.classList.add("ZDX_H"):i.classList.add("ZDX_R","STX","FXC")):n.classList.contains("headers")||n.classList.contains("lovRow")?(i.style.left="",i.classList.remove(`C${o}`,"ZDX_H")):i.classList.remove("ZDX_R","STX","FXC")}Ae()}else y("Alert!","Please select a column")};function st(t){t=new Date(t);const l=new Date(1899,11,30),n=(t-l)/(1e3*60*60*24);return Math.floor(n)}function at(t){t=new Date(t),t.setHours(0,0,0,0);const l=new Date(1899,11,30),e=(t-l)/(1e3*60*60*24);return Math.floor(e+1)}const ye=document.getElementById("displayTable");let k=[],he={searchSelectedPeriodMembers:"selectedPeriodMembers",searchAvailablePeriodMembers:"availablePeriodMembers",searchSelectedModeMembers:"selectedModeMembers",searchAvailableModeMembers:"availableModeMembers",searchSelectedSrcLocationMembers:"selectedSrcLocationMembers",searchAvailableSrcLocationMembers:"availableSrcLocationMembers",searchSelectedDestLocationMembers:"selectedDestLocationMembers",searchAvailableDestLocationMembers:"availableDestLocationMembers",searchSelectedItemMembers:"selectedItemMembers",searchAvailableItemMembers:"availableItemMembers"};const P=function(t){let l=t.target,e=l.getAttribute("colname"),n=he[l.id],o=l.value;if(e)for(let i of document.getElementById(n).querySelectorAll(`tr[colname="${e}"]`))i.firstChild.innerText.toLowerCase().indexOf(o.toLowerCase())>-1?i.style.display="":i.style.display="none";else{let i=0;for(let d of document.getElementById(n).childNodes)d.firstChild.innerText.toLowerCase().indexOf(o.toLowerCase())>-1?(i==0&&(i=1,d.click()),d.style.display=""):d.style.display="none"}};document.getElementById("buttonSelectedItemMembers").onclick=R.bind(null,"searchSelectedItemMembers","selectedItemLevel");document.getElementById("buttonAvailableItemMembers").onclick=R.bind(null,"searchAvailableItemMembers","selectedItemLevel");document.getElementById("buttonSelectedSrcLocationMembers").onclick=R.bind(null,"searchSelectedSrcLocationMembers","selectedSrcLocationLevel");document.getElementById("buttonAvailableSrcLocationMembers").onclick=R.bind(null,"searchAvailableSrcLocationMembers","selectedSrcLocationLevel");document.getElementById("buttonSelectedDestLocationMembers").onclick=R.bind(null,"searchSelectedDestLocationMembers","selectedDestLocationLevel");document.getElementById("buttonAvailableDestLocationMembers").onclick=R.bind(null,"searchAvailableDestLocationMembers","selectedDestLocationLevel");document.getElementById("buttonSelectedPeriodMembers").onclick=R.bind(null,"searchSelectedPeriodMembers","selectedPeriodLevel");document.getElementById("buttonAvailablePeriodMembers").onclick=R.bind(null,"searchAvailablePeriodMembers","selectedPeriodLevel");document.getElementById("buttonSelectedModeMembers").onclick=R.bind(null,"searchSelectedModeMembers","selectedModeLevel");document.getElementById("buttonAvailableModeMembers").onclick=R.bind(null,"searchAvailableModeMembers","selectedModeLevel");document.getElementById("Item_allLeft").onclick=C.bind(null,"selectedItemMembers","availableItemMembers","all");document.getElementById("Item_oneLeft").onclick=C.bind(null,"selectedItemMembers","availableItemMembers","one");document.getElementById("Item_oneRight").onclick=C.bind(null,"availableItemMembers","selectedItemMembers","one");document.getElementById("Item_allRight").onclick=C.bind(null,"availableItemMembers","selectedItemMembers","all");document.getElementById("srcLocation_allLeft").onclick=C.bind(null,"selectedSrcLocationMembers","availableSrcLocationMembers","all");document.getElementById("srcLocation_oneLeft").onclick=C.bind(null,"selectedSrcLocationMembers","availableSrcLocationMembers","one");document.getElementById("srcLocation_oneRight").onclick=C.bind(null,"availableSrcLocationMembers","selectedSrcLocationMembers","one");document.getElementById("srcLocation_allRight").onclick=C.bind(null,"availableSrcLocationMembers","selectedSrcLocationMembers","all");document.getElementById("destLocation_allLeft").onclick=C.bind(null,"selectedDestLocationMembers","availableDestLocationMembers","all");document.getElementById("destLocation_oneLeft").onclick=C.bind(null,"selectedDestLocationMembers","availableDestLocationMembers","one");document.getElementById("destLocation_oneRight").onclick=C.bind(null,"availableDestLocationMembers","selectedDestLocationMembers","one");document.getElementById("destLocation_allRight").onclick=C.bind(null,"availableDestLocationMembers","selectedDestLocationMembers","all");document.getElementById("Period_allLeft").onclick=C.bind(null,"selectedPeriodMembers","availablePeriodMembers","all");document.getElementById("Period_oneLeft").onclick=C.bind(null,"selectedPeriodMembers","availablePeriodMembers","one");document.getElementById("Period_oneRight").onclick=C.bind(null,"availablePeriodMembers","selectedPeriodMembers","one");document.getElementById("Period_allRight").onclick=C.bind(null,"availablePeriodMembers","selectedPeriodMembers","all");document.getElementById("Mode_allLeft").onclick=C.bind(null,"selectedModeMembers","availableModeMembers","all");document.getElementById("Mode_oneLeft").onclick=C.bind(null,"selectedModeMembers","availableModeMembers","one");document.getElementById("Mode_oneRight").onclick=C.bind(null,"availableModeMembers","selectedModeMembers","one");document.getElementById("Mode_allRight").onclick=C.bind(null,"availableModeMembers","selectedModeMembers","all");document.getElementById("removeAllItemFilters").onclick=C.bind(null,"selectedItemLevel","availableItemLevel","removeAll");document.getElementById("removeAllSrcLocationFilters").onclick=C.bind(null,"selectedSrcLocationLevel","availableSrcLocationLevel","removeAll");document.getElementById("removeAllDestLocationFilters").onclick=C.bind(null,"selectedDestLocationLevel","availableDestLocationLevel","removeAll");document.getElementById("removeAllPeriodFilters").onclick=C.bind(null,"selectedPeriodLevel","availablePeriodLevel","removeAll");document.getElementById("removeAllModeFilters").onclick=C.bind(null,"selectedModeLevel","availableModeLevel","removeAll");document.getElementById("searchSelectedItemMembers").onkeyup=P;document.getElementById("searchAvailableItemMembers").onkeyup=P;document.getElementById("searchSelectedSrcLocationMembers").onkeyup=P;document.getElementById("searchAvailableSrcLocationMembers").onkeyup=P;document.getElementById("searchSelectedDestLocationMembers").onkeyup=P;document.getElementById("searchAvailableDestLocationMembers").onkeyup=P;document.getElementById("searchSelectedPeriodMembers").onkeyup=P;document.getElementById("searchAvailablePeriodMembers").onkeyup=P;document.getElementById("searchSelectedModeMembers").onkeyup=P;document.getElementById("searchAvailableModeMembers").onkeyup=P;function ke(t){let e=Ne(t).getAttribute("dest");if(t.parentNode.tagName=="UL")if(t.firstChild.checked){t.firstChild.checked=!1;for(let n of document.getElementById(e).querySelectorAll("li"))if(n.firstChild.value==t.firstChild.value){document.getElementById(e).removeChild(n);break}for(let n of layout_el){let o=document.getElementById(n);for(let i of o.querySelectorAll("li"))i.getAttribute("value")==t.firstChild.value&&i.remove()}}else{t.firstChild.checked=!0;let n=t.cloneNode(!0);n.style.paddingLeft="15px",n.onclick=function(){ke(this)},document.getElementById(e).appendChild(n);let o=get_scc_element("li");o.appendChild(t.querySelector("span").cloneNode(!0)),o.appendChild(document.createTextNode(t.innerText)),o.setAttribute("value",t.firstChild.value),document.getElementById("layoutY").appendChild(o)}else if(t.parentNode.tagName=="DIV"){t.parentNode.removeChild(t);for(let n of document.getElementById(e).querySelectorAll("input.inputcheckbox"))n.checked&&n.value==t.firstChild.value&&(n.checked=!1);for(let n of layout_el){let o=document.getElementById(n);for(let i of o.querySelectorAll("li"))i.getAttribute("value")==t.firstChild.value&&i.remove()}}}function Ne(t){let l=null;return t.classList.contains("parent-div")?t:(l=Ne(t.parentNode),l)}function C(t,l,e){if(e=="all"){for(let n of document.getElementById(t).querySelectorAll("tr"))n.style.display!=="none"&&document.getElementById(l).appendChild(n);re()}else if(e=="one")for(let n of document.getElementById(t).querySelectorAll("tr.selectedValue"))document.getElementById(l).appendChild(n),n.classList.remove("selectedValue");else if(e=="addAll")for(let n of document.getElementById(t).querySelectorAll("input.inputcheckbox"))n.checked||ke(n.parentNode);else if(e=="removeAll")for(let n of document.getElementById(l).querySelectorAll("input.inputcheckbox"))n.checked&&n.parentNode.click()}function R(t,l){let e=document.getElementById(he[t]),n=document.getElementById(t);if(n.style.display=="none"){if(re(),e.childNodes.length>0){const o=document.getElementById(l).querySelector("li.selectedValue");if(o!==null){const i=o.firstChild.value;n.setAttribute("colname",i),n.style.display="",n.focus()}}}else re()}function re(){let t=["searchAvailablePeriodMembers","searchSelectedPeriodMembers","searchAvailableModeMembers","searchSelectedModeMembers","searchAvailableSrcLocationMembers","searchSelectedSrcLocationMembers","searchAvailableDestLocationMembers","searchSelectedDestLocationMembers","searchAvailableItemMembers","searchSelectedItemMembers"];for(let l of t){let e=document.getElementById(l);if(e.style.display!=="none"){e.style.display="none";let n=document.getElementById(he[l]),o=e.getAttribute("colname");for(let i of n.querySelectorAll(`tr[colname="${o}"]`))i.style.display="";e.value=""}}}function rt(){const t=ye.querySelector("tbody");let l=t.querySelector("input:checked"),e=!1;l?l=l.parentNode.parentNode.childNodes:(e=!0,l=t.querySelector("tr.insert").childNodes),k=[];let n=["SOURCETYPE","SOURCELOCATION","DESTINATIONTYPE","DESTINATIONLOCATION","ITEMTYPE","ITEM","PERIODTYPE","PERIODNAME","MODETYPE","MODE"];const o=document.getElementById("columns-div");o.innerHTML="";for(const[i,d]of l.entries()){let a=get_scc_element("div","row align-items-center py-2 mt-2"),s=!1,u;if(i==0)k.push(d.id);else if(i>0&&!n.includes(r[i])){let h=get_scc_element("div","col-5",null,get_scc_element("label",null,null,document.createTextNode(r[i])));a.appendChild(h);let f;d.innerText==""?u=null:r[i]in c.decimals?d.getAttribute("title")===null?u="":isNaN(parseFloat(d.getAttribute("title")))?u=d.getAttribute("title"):u=parseFloat(d.getAttribute("title")):u=d.innerText,k.push(u);let I=get_scc_element("div","col-7");if(r[i]in c.lov){f=get_scc_element("select","form-select",null);for(let b of c.lov[r[i]]){let S=get_scc_element("option",null,null,document.createTextNode(b));f.appendChild(S)}}else r[i]in c.autofiller?(I.style.display="flex",f=get_scc_element("input","form-control",null),s=!0):r[i]in c.decimals?f=get_scc_element("input","form-control",null):c.date&&r[i]in c.date?(f=get_scc_element("input","form-control datepicker-input",null),new Datepicker(f,{format:"yyyy-mm-dd",autohide:!0}),f.type="text"):(f=get_scc_element("input","form-control",null),f.type="text");e||(f.value=u),I.appendChild(f),a.appendChild(I),o.appendChild(a),s&&(new Awesomplete(f,{list:c.autofiller[r[i]],tabSelect:!0}),f.parentNode.style.flex=1)}else d.innerText==""?u=null:u=d.innerText,k.push(u)}}function ut(){let t={ITEM:"item-new",SOURCELOCATION:"src-location-new",DESTINATIONLOCATION:"dest-location-new",PERIODNAME:"period-new",MODE:"mode-new"},l=0;for(let e in t)r.indexOf(e)>-1?(document.getElementById(t[e]).parentNode.style.display="",l==0&&(document.getElementById(t[e]).click(),l+=1)):document.getElementById(t[e]).parentNode.style.display="none"}document.getElementById("modal-flow-constraint").addEventListener("show.bs.modal",function(){const t=ye.querySelector("tbody");let l={ITEMTYPE:"itemType",SOURCETYPE:"srcType",DESTINATIONTYPE:"destType",PERIODTYPE:"prdType",MODETYPE:"modeType"};rt(),ut();let e=t.querySelector("input:checked");for(let n in l){let o=document.getElementById(l[n]);if(o.innerHTML="",r.indexOf(n)>-1){for(let i of c.lov[n]){let d=get_scc_element("option",null,null,document.createTextNode(i));d.setAttribute("value",i),o.appendChild(d)}e&&(o.value=k[r.indexOf(n)])}}});document.getElementById("item-new").onclick=function(){G("itmTypeRow")};document.getElementById("src-location-new").onclick=function(){G("srcTypeRow")};document.getElementById("dest-location-new").onclick=function(){G("destTypeRow")};document.getElementById("period-new").onclick=function(){G("prdTypeRow")};document.getElementById("mode-new").onclick=function(){G("modeTypeRow")};document.getElementById("details-new").onclick=function(){G()};function G(t){let l=document.getElementById(t);for(let e of document.getElementById("headerDiv").querySelectorAll("div.row"))e.style.display="none";if(l){let e=l.querySelector("h6").innerText;r.indexOf(e)>-1&&(l.style.display="")}}document.getElementById("ok-constraint").onclick=function(){let t={};t.SelectedLvlFilterData={};let l=[["availableItemLevel","selectedItemLevel","availableItemMembers","selectedItemMembers","ITEM"],["availableSrcLocationLevel","selectedSrcLocationLevel","availableSrcLocationMembers","selectedSrcLocationMembers","SOURCELOCATION"],["availableDestLocationLevel","selectedDestLocationLevel","availableDestLocationMembers","selectedDestLocationMembers","DESTINATIONLOCATION"],["availablePeriodLevel","selectedPeriodLevel","availablePeriodMembers","selectedPeriodMembers","PERIODNAME"],["availableModeLevel","selectedModeLevel","availableModeMembers","selectedModeMembers","MODE"]];for(let o of l){const i=o[4];let d=document.getElementById(o[2]),a=document.getElementById(o[3]),s=document.getElementById(o[1]).childNodes;for(let u of s){let h=u.querySelector("input").value,f=d.querySelectorAll(`tr[colname=${h.trim()}]`),I=a.querySelectorAll(`tr[colname=${h}]`),b=document.getElementById(o[0]).querySelector("li.head-selector"),S=!1;if(b&&(S=b.querySelector("input").checked),S&&s.length==1&&I.length==1)t[i]=I[0].firstChild.innerText;else if(I.length>f.length&&f.length>0)for(let p of f)if(Object.keys(t.SelectedLvlFilterData).indexOf(h)>-1)t.SelectedLvlFilterData[h].where_not_in.push(p.firstChild.innerText);else{let v={where_in:[],where_not_in:[p.firstChild.innerText]};t.SelectedLvlFilterData[h]=v}else for(let p of I)if(Object.keys(t.SelectedLvlFilterData).indexOf(h)>-1)t.SelectedLvlFilterData[h].where_in.push(p.firstChild.innerText);else{let v={where_in:[p.firstChild.innerText],where_not_in:[]};t.SelectedLvlFilterData[h]=v}}}for(let o of document.getElementById("columns-div").childNodes){let i=o.firstChild.firstChild.innerText,d=o.lastChild.firstChild.value;t[i]=d}for(let o of document.getElementById("headerDiv").querySelectorAll("div.row")){let i=o.querySelector("h6").innerText,d=o.querySelector("select").value;t[i]=d}let e=mt(t);if(ft(e)){const o=ye.querySelector("tbody");let i=o.querySelector("input:checked"),d=!1;i?i=i.parentNode.parentNode:(d=!0,i=o.querySelector("tr.insert"));let a=new Object;for(const[s,u]of e.entries())u!==k[s]&&(a[r[s]]=u);d?postData("/grid/insert_row",{insert_dict:a}).then(s=>{if("Success"in s){e[0]=s.Success,k=[];const u=o.lastChild;let h=Z(e);i.remove(),o.appendChild(h),o.appendChild(W()),o.appendChild(u)}else confirmBox("Error!",`Error:  ${s.Error}`)}):postData("/grid/update_row",{rowid:k[0],primary_col:document.getElementById("selectAll").parentNode.id,update_dict:a}).then(s=>{k=[];let u=Z(e);i.parentNode.replaceChild(u,i),u.querySelector("input.form-check-input").checked=!0})}bootstrap.Modal.getInstance(document.getElementById("modal-flow-constraint")).hide()};function mt(t){let l=[];for(let[e,n]of r.entries()){let o;if(e==0)l.push(k[0]);else if(n in t){if(o=t[n],n in c.decimals&&isNaN(o)){confirmBox("Alert!",`Please enter numeric value in ${n} Column`);return}o.trim()==""||o.trim()=="null"&&n in c.lov?o=null:n in c.decimals&&(o=parseFloat(o)),l.push(o)}else{let i={itm:"item",dl:"destinationlocation",sl:"sourcelocation",prd:"periodname",tp:"mode"};o="<";for(let d in t.SelectedLvlFilterData)if(i[d.split("_",1)[0]].toLowerCase()==n.toLowerCase())if(o.length==1?o+=`${d.split("_")[1]}`:o+=` and ${d.split("_")[1]}`,t.SelectedLvlFilterData[d].where_in.length>0){for(let[s,u]of t.SelectedLvlFilterData[d].where_in.entries())s==0?o+=` in ('${u}'`:o+=`,'${u}'`;o+=")"}else{for(let[s,u]of t.SelectedLvlFilterData[d].where_not_in.entries())s==0?o+=` not in ('${u}'`:o+=`,'${u}'`;o+=")"}o+=">",o.length>2?l.push(o):l.length==0?l.push(k[r.indexOf(n)]):k[r.indexOf(n)]&&k[r.indexOf(n)].trim().charAt(0)=="<"?l.push("All"):l.push(k[r.indexOf(n)])}}return l}function ft(t){return JSON.stringify(t)!=JSON.stringify(k)}
