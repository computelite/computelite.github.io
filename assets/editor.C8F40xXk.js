import"./pixel.CTdmvz-a.js";import{r as se,C as de}from"./codemirror.DO_djx_r.js";import{e as F,c as k,w as V,b as _}from"./scc.Dvg64kKt.js";import{M as B}from"./bootstrap.esm.CkDf0L-y.js";(function(e,i){(function(l){l(se())})(function(l){function o(u){return new RegExp("^(("+u.join(")|(")+"))\\b")}var a=o(["and","or","not","is"]),s=["as","assert","break","class","continue","def","del","elif","else","except","finally","for","from","global","if","import","lambda","pass","raise","return","try","while","with","yield","in","False","True"],h=["abs","all","any","bin","bool","bytearray","callable","chr","classmethod","compile","complex","delattr","dict","dir","divmod","enumerate","eval","filter","float","format","frozenset","getattr","globals","hasattr","hash","help","hex","id","input","int","isinstance","issubclass","iter","len","list","locals","map","max","memoryview","min","next","object","oct","open","ord","pow","property","range","repr","reversed","round","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","vars","zip","__import__","NotImplemented","Ellipsis","__debug__"];l.registerHelper("hintWords","python",s.concat(h).concat(["exec","print"]));function f(u){return u.scopes[u.scopes.length-1]}l.defineMode("python",function(u,c){for(var y="error",b=c.delimiters||c.singleDelimiters||/^[\(\)\[\]\{\}@,:`=;\.\\]/,v=[c.singleOperators,c.doubleOperators,c.doubleDelimiters,c.tripleDelimiters,c.operators||/^([-+*/%\/&|^]=?|[<>=]+|\/\/=?|\*\*=?|!=|[~!@]|\.\.\.)/],T=0;T<v.length;T++)v[T]||v.splice(T--,1);var I=c.hangingIndent||u.indentUnit,D=s,A=h;c.extra_keywords!=null&&(D=D.concat(c.extra_keywords)),c.extra_builtins!=null&&(A=A.concat(c.extra_builtins));var H=!(c.version&&Number(c.version)<3);if(H){var q=c.identifiers||/^[_A-Za-z\u00A1-\uFFFF][_A-Za-z0-9\u00A1-\uFFFF]*/;D=D.concat(["nonlocal","None","aiter","anext","async","await","breakpoint","match","case"]),A=A.concat(["ascii","bytes","exec","print"]);var $=new RegExp(`^(([rbuf]|(br)|(rb)|(fr)|(rf))?('{3}|"{3}|['"]))`,"i")}else{var q=c.identifiers||/^[_A-Za-z][_A-Za-z0-9]*/;D=D.concat(["exec","print"]),A=A.concat(["apply","basestring","buffer","cmp","coerce","execfile","file","intern","long","raw_input","reduce","reload","unichr","unicode","xrange","None"]);var $=new RegExp(`^(([rubf]|(ur)|(br))?('{3}|"{3}|['"]))`,"i")}var ie=o(D),le=o(A);function Q(t,n){var p=t.sol()&&n.lastToken!="\\";if(p&&(n.indent=t.indentation()),p&&f(n).type=="py"){var r=f(n).offset;if(t.eatSpace()){var w=t.indentation();return w>r?Z(n):w<r&&j(t,n)&&t.peek()!="#"&&(n.errorToken=!0),null}else{var S=z(t,n);return r>0&&j(t,n)&&(S+=" "+y),S}}return z(t,n)}function z(t,n,p){if(t.eatSpace())return null;if(!p&&t.match(/^#.*/))return"comment";if(t.match(/^[0-9\.]/,!1)){var r=!1;if(t.match(/^[\d_]*\.\d+(e[\+\-]?\d+)?/i)&&(r=!0),t.match(/^[\d_]+\.\d*/)&&(r=!0),t.match(/^\.\d+/)&&(r=!0),r)return t.eat(/J/i),"number";var w=!1;if(t.match(/^0x[0-9a-f_]+/i)&&(w=!0),t.match(/^0b[01_]+/i)&&(w=!0),t.match(/^0o[0-7_]+/i)&&(w=!0),t.match(/^[1-9][\d_]*(e[\+\-]?[\d_]+)?/)&&(t.eat(/J/i),w=!0),t.match(/^0(?![\dx])/i)&&(w=!0),w)return t.eat(/L/i),"number"}if(t.match($)){var S=t.current().toLowerCase().indexOf("f")!==-1;return S?(n.tokenize=re(t.current(),n.tokenize),n.tokenize(t,n)):(n.tokenize=oe(t.current(),n.tokenize),n.tokenize(t,n))}for(var m=0;m<v.length;m++)if(t.match(v[m]))return"operator";return t.match(b)?"punctuation":n.lastToken=="."&&t.match(q)?"property":t.match(ie)||t.match(a)?"keyword":t.match(le)?"builtin":t.match(/^(self|cls)\b/)?"variable-2":t.match(q)?n.lastToken=="def"||n.lastToken=="class"?"def":"variable":(t.next(),p?null:y)}function re(t,n){for(;"rubf".indexOf(t.charAt(0).toLowerCase())>=0;)t=t.substr(1);var p=t.length==1,r="string";function w(m){return function(N,R){var G=z(N,R,!0);return G=="punctuation"&&(N.current()=="{"?R.tokenize=w(m+1):N.current()=="}"&&(m>1?R.tokenize=w(m-1):R.tokenize=S)),G}}function S(m,N){for(;!m.eol();)if(m.eatWhile(/[^'"\{\}\\]/),m.eat("\\")){if(m.next(),p&&m.eol())return r}else{if(m.match(t))return N.tokenize=n,r;if(m.match("{{"))return r;if(m.match("{",!1))return N.tokenize=w(0),m.current()?r:N.tokenize(m,N);if(m.match("}}"))return r;if(m.match("}"))return y;m.eat(/['"]/)}if(p){if(c.singleLineStringErrors)return y;N.tokenize=n}return r}return S.isString=!0,S}function oe(t,n){for(;"rubf".indexOf(t.charAt(0).toLowerCase())>=0;)t=t.substr(1);var p=t.length==1,r="string";function w(S,m){for(;!S.eol();)if(S.eatWhile(/[^'"\\]/),S.eat("\\")){if(S.next(),p&&S.eol())return r}else{if(S.match(t))return m.tokenize=n,r;S.eat(/['"]/)}if(p){if(c.singleLineStringErrors)return y;m.tokenize=n}return r}return w.isString=!0,w}function Z(t){for(;f(t).type!="py";)t.scopes.pop();t.scopes.push({offset:f(t).offset+u.indentUnit,type:"py",align:null})}function ae(t,n,p){var r=t.match(/^[\s\[\{\(]*(?:#|$)/,!1)?null:t.column()+1;n.scopes.push({offset:n.indent+I,type:p,align:r})}function j(t,n){for(var p=t.indentation();n.scopes.length>1&&f(n).offset>p;){if(f(n).type!="py")return!0;n.scopes.pop()}return f(n).offset!=p}function ce(t,n){t.sol()&&(n.beginningOfLine=!0,n.dedent=!1);var p=n.tokenize(t,n),r=t.current();if(n.beginningOfLine&&r=="@")return t.match(q,!1)?"meta":H?"operator":y;if(/\S/.test(r)&&(n.beginningOfLine=!1),(p=="variable"||p=="builtin")&&n.lastToken=="meta"&&(p="meta"),(r=="pass"||r=="return")&&(n.dedent=!0),r=="lambda"&&(n.lambda=!0),r==":"&&!n.lambda&&f(n).type=="py"&&t.match(/^\s*(?:#|$)/,!1)&&Z(n),r.length==1&&!/string|comment/.test(p)){var w="[({".indexOf(r);if(w!=-1&&ae(t,n,"])}".slice(w,w+1)),w="])}".indexOf(r),w!=-1)if(f(n).type==r)n.indent=n.scopes.pop().offset-I;else return y}return n.dedent&&t.eol()&&f(n).type=="py"&&n.scopes.length>1&&n.scopes.pop(),p}var ue={startState:function(t){return{tokenize:Q,scopes:[{offset:t||0,type:"py",align:null}],indent:t||0,lastToken:null,lambda:!1,dedent:0}},token:function(t,n){var p=n.errorToken;p&&(n.errorToken=!1);var r=ce(t,n);return r&&r!="comment"&&(n.lastToken=r=="keyword"||r=="punctuation"?t.current():r),r=="punctuation"&&(r=null),t.eol()&&n.lambda&&(n.lambda=!1),p?r+" "+y:r},indent:function(t,n){if(t.tokenize!=Q)return t.tokenize.isString?l.Pass:0;var p=f(t),r=p.type==n.charAt(0)||p.type=="py"&&!t.dedent&&/^(else:|elif |except |finally:)/.test(n);return p.align!=null?p.align-(r?1:0):p.offset-(r?I:0)},electricInput:/^\s*([\}\]\)]|else:|elif |except |finally:)$/,closeBrackets:{triples:`'"`},lineComment:"#",fold:"indent"};return ue}),l.defineMIME("text/x-python","python");var d=function(u){return u.split(" ")};l.defineMIME("text/x-cython",{name:"python",extra_keywords:d("by cdef cimport cpdef ctypedef enum except extern gil include nogil property public readonly struct union DEF IF ELIF ELSE")})})})();const X=new URLSearchParams(window.location.search),g=X.get("modelName"),Y=X.get("projectName");var L=null;let E=null,x=null,M=null;window.onload=async function(){document.querySelectorAll(".modal").forEach(d=>{B.getInstance(d)||new B(d)}),L=de.fromTextArea(document.getElementById("editorText"),{lineNumbers:!0,lineWrapping:!0,mode:"python",theme:"dracula",autoRefresh:!0,autofocus:!0,tabSize:4,indentUnit:4}),L.addKeyMap({Backspace:function(d){const u=d.getCursor(),c=d.getLine(u.line),y=d.getOption("indentUnit"),b=c.slice(0,u.ch);if(/^\s*$/.test(b)&&u.ch>0){const v=Math.max(0,u.ch-y);d.setCursor({line:u.line,ch:v})}else d.execCommand("delCharBefore")}});let i=await F("init");if(!i||i.msg!="Success"){k("Alert!","Some error occured while initializing sqlite.");return}O();const o=await F("fetchData",g,"SELECT FileName,FileData FROM S_ExecutionFiles WHERE FilePath = ? AND Status = 'Active' ",["requirements.txt"]),s=await F("fetchData",g,"SELECT WheelName,WheelBlob FROM S_PackageWheels");let h=await V("init","",Y,g,o,"",[],s),f=document.getElementById("packageIndicator");W(h.stderr),f.classList.remove("spinner-loading"),f.classList.add("spinner-complete"),document.getElementById("downloadZip").onclick=we,document.getElementById("downloadOutput").onclick=Se,document.getElementById("getText").onclick=fe,document.getElementById("uploadZip").onclick=pe,document.getElementById("hideCanvas").onclick=ye,document.getElementById("addFile").onclick=me,document.getElementById("addFolder").onclick=Ee,document.getElementById("deleteFile").onclick=Fe,document.getElementById("addToHome").onclick=be,document.getElementById("saveFileName").onclick=ve};function P(e){L.setValue(e),setTimeout(function(){L.refresh(),L.focus()},200)}async function fe(){M=null,document.getElementById("loadingOverlay").classList.remove("hidden"),document.getElementById("outputTxt").innerHTML="";const e=document.getElementById("myCanvas");let i=L.getValue();const o=await F("fetchData",g,"SELECT FilePath,FileData FROM S_ExecutionFiles WHERE Filename is NOT NULL AND Status = 'Active' ");let a="";E&&(a=E.getAttribute("filepath"),await ee());const h=await F("fetchData",g,"SELECT FileName,FileBlob FROM S_DataFiles WHERE FileType = 'Input'"),d=await F("fetchData",g,"SELECT WheelName,WheelBlob FROM S_PackageWheels"),u=await U("Started");let c=await V("execute",i,Y,g,o,a,h,d);if(document.getElementById("loadingOverlay").classList.add("hidden"),c.stderr)U("Errored",c.stderr,u);else{U("Completed",null,u);const y=e.getContext("2d");if(y.clearRect(0,0,e.width,e.height),c.blob){M=c.blob;const b=await createImageBitmap(c.blob),v=Math.min(e.width/b.width,e.height/b.height),T=(e.width-b.width*v)/2,I=(e.height-b.height*v)/2;y.drawImage(b,T,I,b.width*v,b.height*v);const D=document.getElementById("canvasDiv");D.style.width!="500px"&&(D.style.width="500px",document.getElementById("mainDiv").style.marginRight="513px")}c.outputFiles&&c.outputFiles.length>0&&(await F("deleteData",g,"DELETE FROM S_DataFiles WHERE FileType = 'Output'"),c.outputFiles.forEach(async([v,T])=>{await F("insertData",g,`INSERT INTO S_DataFiles (FileName,FileType,FileBlob) 
                              VALUES (?, ?, ?) ON CONFLICT (FileName,FileType) DO UPDATE SET FileBlob = ? `,[v,"Output",T,T])}))}W(c.stderr)}function W(e){const i=document.getElementById("outputTxt");if(e){const l=document.createElement("div");l.textContent=`Error: ${e}`,l.style.color="red",i.appendChild(l)}}async function ee(){const e=document.getElementById("filesDiv").querySelector("li.selectedValue");if(e){const i=e.getAttribute("filepath"),l=e.innerText,o=L.getValue();if(l==="requirements.txt"){const s=await V("loadPackages",o);s.stderr&&W(s.stderr)}await F("insertData",g,`INSERT INTO S_ExecutionFiles (FileName,FilePath,FileData) VALUES (?, ?, ?) ON CONFLICT (FilePath)
                  DO UPDATE SET FileData = ? `,[l,i,o,o])}}async function pe(){const e=document.getElementById("zipFile").files[0];if(e){this.setAttribute("disabled",""),this.innerHTML='<span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>',await F("deleteData",g,"DELETE FROM S_ExecutionFiles");const l=new FileReader;l.onload=async function(o){const a=await JSZip.loadAsync(o.target.result),s=[];a.forEach(function(d,u){if(d.includes("__pycache__"))return;const c=u.async("string").then(async function(y){if(y){const b=d.split("/").slice(-1)[0];await F("insertData",g,`INSERT INTO S_ExecutionFiles (FileName,FilePath,FileData) VALUES (?, ?, ?) 
                         ON CONFLICT (FilePath) DO UPDATE SET FileData = ?, FilePath = ?`,[b,d,y,y,d])}});s.push(c)}),await Promise.all(s);const h=document.getElementById("uploadZip");h.removeAttribute("disabled"),h.innerHTML="",h.innerText="Upload",P(""),O(),B.getInstance(document.getElementById("modal-file-upload")).hide(),k("Success","File Uploaded Successfully")},l.readAsArrayBuffer(e)}}function te(e,i=!1,l=null,o=null,a="",s="fa-solid fa-folder"){let h=_("ul","tree");for(let f in e)if(h.appendChild(document.createElement("li")),e[f]&&typeof e[f]=="object"){a+=a?`/${f}`:f;let d=J(f,s);d.setAttribute("folderPath",a),d.onclick=function(c){if(!this.classList.contains("selectedFolder")){for(let y of document.getElementById("filesDiv").querySelectorAll("li.selectedFolder"))y.classList.remove("selectedFolder");for(let y of document.getElementById("filesDiv").querySelectorAll("li.selectedValue"))y.classList.remove("selectedValue");this.classList.add("selectedFolder"),c.preventDefault(),x=this,E=null}};let u=_("ul","childList TreeMembers");u.appendChild(te(e[f],!1,l,o,a)),h.appendChild(d),h.appendChild(u),a=a.replace(/\/[^\/]+$/,"")}else{if(!e[f])continue;let d=J(f,"fa-file-alt",e[f],o,l);d.onclick=async function(u){if(!this.classList.contains("selectedValue")){document.getElementById("outputTxt").innerHTML="",document.getElementById("loadingOverlay").classList.remove("hidden"),await ee(),document.getElementById("loadingOverlay").classList.add("hidden");const c=document.getElementById("bottomButtons");c.style.display="";for(let I of document.getElementById("filesDiv").querySelectorAll("li.selectedValue"))I.classList.remove("selectedValue");for(let I of document.getElementById("filesDiv").querySelectorAll("li.selectedFolder"))I.classList.remove("selectedFolder");this.classList.add("selectedValue"),u.preventDefault(),x=null,E=this;const y=this.getAttribute("filepath");y.slice(-4)===".txt"&&(c.style.display="none");const T=await F("fetchData",g,"SELECT FileName,ifnull(FileData,'') FROM S_ExecutionFiles WHERE FilePath = ? AND Status = 'Active' ",[y]);T&&T[0]&&P(T[0][1])}},h.appendChild(d)}return i?_("div","card-body scc-box",null,h):_("div",null,null,h)}function J(e,i,l=null,o=null,a=null){let s=_("li",null,null);o&&a&&l&&e==a&&l==o&&s.classList.add("selectedValue"),s.setAttribute("title",e),l&&s.setAttribute("filepath",l);let h=_("label","checkBox-label",null,_("span",`fas ${i}`));return h.appendChild(document.createTextNode(e)),s.appendChild(h),s}async function O(e=null,i=null){const o=await F("fetchData",g,"SELECT FilePath FROM S_ExecutionFiles"),a={};o.forEach(h=>{const f=h[0].split("/");let d=a;f.forEach((u,c)=>{u&&(c===f.length-1?/^[^\s]+\.(py|txt)$/.test(u)?d[u]=h[0]:d[u]={}:(d[u]=d[u]||{},d=d[u]))})});const s=ne(a);document.getElementById("filesDiv").innerHTML="",document.getElementById("filesDiv").appendChild(te(s,!0,e,i))}function ne(e){const i={},l=Object.keys(e).filter(a=>typeof e[a]=="object"),o=Object.keys(e).filter(a=>typeof e[a]!="object");if(l.sort().forEach(a=>{i[a]=ne(e[a])}),o.sort().forEach(a=>{i[a]=e[a]}),i["requirements.txt"]){const a=i["requirements.txt"];delete i["requirements.txt"],i["requirements.txt"]=a}return i}function ye(){const e=document.getElementById("canvasDiv");e.style.width=="500px"&&(e.style.width="0",document.getElementById("mainDiv").style.marginRight="0px")}function he(){let e=_("div","input-group mb-2"),i=_("input","form-control small-input");return i.type="text",i.addEventListener("keydown",async function(l){if(l.keyCode=="13"){const o=l.target.value;if(l.preventDefault(),/^[^\s]+\.(py|txt)$/.test(o)){let s=o;if(E?s=E.getAttribute("filepath").replace(E.innerText,o):x&&(s=x.getAttribute("folderpath")+`/${o}`),(await F("fetchData",g,"Select FileName FROM S_ExecutionFiles WHERE FileName = ? AND FilePath = ? ",[o,s])).length>0){k("Alert!","Filename Already Exists");return}await F("insertData",g,"INSERT INTO S_ExecutionFiles (FileName,FilePath) VALUES (?, ?) ",[o,s]),C(),await O(o,s);const u=document.getElementById("filesDiv").querySelector("li.selectedValue");if(u){E=u;const c=u.getAttribute("filepath"),b=await F("fetchData",g,"SELECT FileName,ifnull(FileData,'') FROM S_ExecutionFiles WHERE FilePath = ? AND Status = 'Active' ",[c]);b&&b[0]&&P(b[0][1])}}else k("Alert!","Invalid Filename")}}),e.appendChild(i),e}function me(){C();let e=document.querySelector(".tree");E?e=E.parentNode:x&&(e=x.nextElementSibling.querySelector(".tree"));let i=he();e.insertBefore(i,e.firstChild),i.querySelector("input").focus()}function C(){const e=document.querySelector("div.scc-box").querySelector(".input-group");e&&e.parentNode.removeChild(e)}function ge(){let e=_("div","input-group mb-2"),i=_("input","form-control small-input");return i.type="text",i.addEventListener("keydown",async function(l){if(l.keyCode=="13"){const o=l.target.value;if(l.preventDefault(),/^[^\s]+$/.test(o)){let s=o;if(E?s=E.getAttribute("filepath").replace(E.innerText,o):x&&(s=x.getAttribute("folderpath")+`/${o}`),(await F("fetchData",g,"Select FilePath FROM S_ExecutionFiles WHERE FileName IS NULL AND FilePath = ? ",[s])).length>0){k("Alert!","Folder with same name already exists");return}await F("insertData",g,"INSERT INTO S_ExecutionFiles (FilePath) VALUES (?) ",[s]),C(),await O(o,s)}else k("Alert!","Invalid Folder name")}}),e.appendChild(i),e}function Ee(){C();let e=document.querySelector(".tree");E?e=E.parentNode:x&&(e=x.nextElementSibling.querySelector(".tree"));let i=ge();e.insertBefore(i,e.firstChild),i.querySelector("input").focus()}async function Fe(){if(!E&&!x){k("Alert!","No File Or Folder Selected to delete");return}let e=null;if(E){e=E.getAttribute("filepath"),k("Alert",`Are you sure want to delete '${E.innerText}'`,K.bind(null,e),1);return}else if(x){e=x.getAttribute("folderpath"),k("Alert",`Are you sure you want to permanently delete the '${x.innerText}' folder and all of its contents, including subfolders and files?`,K.bind(null,e),1);return}}async function K(e){await F("deleteData",g,"DELETE FROM S_ExecutionFiles WHERE FilePath Like ? OR FilePath = ?",[`%${e}%`,e]),P(""),E=null,x=null,await O()}async function we(){try{const i=await F("fetchData",g,"SELECT FilePath,FileData FROM S_ExecutionFiles");if(!i||i.length===0)return;const l=new JSZip;i.forEach(s=>{l.file(s[0],s[1],{binary:!0})});const o=await l.generateAsync({type:"blob"}),a=document.createElement("a");a.href=window.URL.createObjectURL(o),a.download="files.zip",a.click(),setTimeout(function(){window.URL.revokeObjectURL(a.href)},1e3)}catch(e){console.error("Error creating zip file for download:",e)}}async function be(){if(document.getElementById("fileName").value="",!E){k("Alert!","No file selected");return}new B(document.getElementById("modal-fileDisplayName")).show()}async function ve(){const e=E.getAttribute("filepath"),i=document.getElementById("fileName").value;if(i.trim()==""){k("Alert","Please enter File Display Name");return}let l="INSERT INTO S_TaskMaster (TaskName,TaskDisplayName) VALUES (?, ?)";try{const o=await F("insertData",g,l,[e,i]);B.getInstance(document.getElementById("modal-fileDisplayName")).hide(),k("Success","File added to Home Page Successfully")}catch{k("Alert!","This File Name is already exists")}}async function Se(){const e=document.createElement("a");e.href=window.URL.createObjectURL(M),e.download="output.jpg",e.click(),setTimeout(function(){window.URL.revokeObjectURL(e.href)},1e3)}async function U(e,i=null,l=null){if(E){const o=E.innerText.trim();if(l)await F("updateData",g,`UPDATE T_TaskLogs SET TaskStatus = ?,ErrorMsg = ?, EndDate = datetime('now', 'localtime')
                     WHERE TaskName = ? AND Id = ? `,[e,i,o,l]);else return await F("insertData",g,"INSERT INTO T_TaskLogs (TaskName,TaskStatus,EndDate) VALUES (?, ?, datetime('now', 'localtime'))",[o,e])}}
